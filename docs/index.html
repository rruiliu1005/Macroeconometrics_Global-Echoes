<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rui Liu">

<title>Macroeconometrics Research Report - Global Echoes: Analyzing the Interplay of Economic Indicators Across Leading Economies</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Macroeconometrics Research Report</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-question-objective-and-motivation" id="toc-the-question-objective-and-motivation" class="nav-link active" data-scroll-target="#the-question-objective-and-motivation">1. The Question Objective, and Motivation</a></li>
  <li><a href="#data-and-their-properties" id="toc-data-and-their-properties" class="nav-link" data-scroll-target="#data-and-their-properties">2. Data and their properties</a>
  <ul class="collapse">
  <li><a href="#data-plots" id="toc-data-plots" class="nav-link" data-scroll-target="#data-plots">Data Plots</a></li>
  <li><a href="#stationarity-check" id="toc-stationarity-check" class="nav-link" data-scroll-target="#stationarity-check">Stationarity Check</a></li>
  </ul></li>
  <li><a href="#the-model-and-hypothesis" id="toc-the-model-and-hypothesis" class="nav-link" data-scroll-target="#the-model-and-hypothesis">3. The Model and Hypothesis</a>
  <ul class="collapse">
  <li><a href="#model-1-standard-bvarp-model" id="toc-model-1-standard-bvarp-model" class="nav-link" data-scroll-target="#model-1-standard-bvarp-model">3.1 Model 1: Standard BVAR(p) Model</a>
  <ul class="collapse">
  <li><a href="#model-specification" id="toc-model-specification" class="nav-link" data-scroll-target="#model-specification">3.1.1 Model Specification</a></li>
  <li><a href="#prior-settings" id="toc-prior-settings" class="nav-link" data-scroll-target="#prior-settings">3.1.2 Prior Settings</a></li>
  <li><a href="#posterior-distributions" id="toc-posterior-distributions" class="nav-link" data-scroll-target="#posterior-distributions">3.1.3 Posterior Distributions</a></li>
  <li><a href="#estimation-procedure" id="toc-estimation-procedure" class="nav-link" data-scroll-target="#estimation-procedure">3.1.4 Estimation Procedure</a></li>
  <li><a href="#test-for-granger-causality" id="toc-test-for-granger-causality" class="nav-link" data-scroll-target="#test-for-granger-causality">3.1.5 Test for Granger Causality</a></li>
  </ul></li>
  <li><a href="#model-2-large-bvar-model-with-ma1-gaussian-innovations" id="toc-model-2-large-bvar-model-with-ma1-gaussian-innovations" class="nav-link" data-scroll-target="#model-2-large-bvar-model-with-ma1-gaussian-innovations">3.2 Model 2: Large BVAR model with MA(1) Gaussian Innovations</a>
  <ul class="collapse">
  <li><a href="#model-specification-1" id="toc-model-specification-1" class="nav-link" data-scroll-target="#model-specification-1">3.2.1 Model Specification</a></li>
  <li><a href="#prior-specification" id="toc-prior-specification" class="nav-link" data-scroll-target="#prior-specification">3.2.2 Prior Specification</a></li>
  <li><a href="#posterior-distributions-1" id="toc-posterior-distributions-1" class="nav-link" data-scroll-target="#posterior-distributions-1">3.2.3 Posterior Distributions</a></li>
  <li><a href="#estimation-procedure-1" id="toc-estimation-procedure-1" class="nav-link" data-scroll-target="#estimation-procedure-1">3.2.4 Estimation Procedure</a></li>
  </ul></li>
  <li><a href="#model-3-large-bvar-model-with-common-stochastic-volatility" id="toc-model-3-large-bvar-model-with-common-stochastic-volatility" class="nav-link" data-scroll-target="#model-3-large-bvar-model-with-common-stochastic-volatility">3.3 Model 3: Large BVAR model with common Stochastic Volatility</a></li>
  <li><a href="#model-4-large-bvar-model-with-ma1-gaussian-innovations-and-common-stochastic-volatility" id="toc-model-4-large-bvar-model-with-ma1-gaussian-innovations-and-common-stochastic-volatility" class="nav-link" data-scroll-target="#model-4-large-bvar-model-with-ma1-gaussian-innovations-and-common-stochastic-volatility">3.4 Model 4: Large BVAR model with MA(1) Gaussian innovations and Common Stochastic Volatility</a>
  <ul class="collapse">
  <li><a href="#model-specification-2" id="toc-model-specification-2" class="nav-link" data-scroll-target="#model-specification-2">3.4.1 Model Specification</a></li>
  <li><a href="#prior-specification-1" id="toc-prior-specification-1" class="nav-link" data-scroll-target="#prior-specification-1">3.4.2 Prior Specification</a></li>
  <li><a href="#posterior-distribution" id="toc-posterior-distribution" class="nav-link" data-scroll-target="#posterior-distribution">3.4.3 Posterior Distribution</a></li>
  <li><a href="#estimation-procedure-2" id="toc-estimation-procedure-2" class="nav-link" data-scroll-target="#estimation-procedure-2">3.4.4 Estimation Procedure</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#model-estimation" id="toc-model-estimation" class="nav-link" data-scroll-target="#model-estimation">4. Model Estimation</a>
  <ul class="collapse">
  <li><a href="#standard-bayesian-var" id="toc-standard-bayesian-var" class="nav-link" data-scroll-target="#standard-bayesian-var">4.1 Standard Bayesian VAR</a>
  <ul class="collapse">
  <li><a href="#model-building-code-and-validation" id="toc-model-building-code-and-validation" class="nav-link" data-scroll-target="#model-building-code-and-validation">4.1.1 Model Building Code and Validation</a></li>
  <li><a href="#empirical-result" id="toc-empirical-result" class="nav-link" data-scroll-target="#empirical-result">4.1.2 Empirical Result</a></li>
  </ul></li>
  <li><a href="#large-bvar-model-with-ma1-gaussian-innovations" id="toc-large-bvar-model-with-ma1-gaussian-innovations" class="nav-link" data-scroll-target="#large-bvar-model-with-ma1-gaussian-innovations">4.2 Large BVAR model with MA(1) Gaussian Innovations</a>
  <ul class="collapse">
  <li><a href="#model-building-code-and-validation-1" id="toc-model-building-code-and-validation-1" class="nav-link" data-scroll-target="#model-building-code-and-validation-1">4.2.1 Model Building Code and Validation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">5. Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Global Echoes: Analyzing the Interplay of Economic Indicators Across Leading Economies</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Rui Liu </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="the-question-objective-and-motivation" class="level1">
<h1>1. The Question Objective, and Motivation</h1>
<p><strong>Objective:</strong> Construct a Bayesian Vector Autoregression model to forecast major macroeconomic indicators for the United States, Australia, Japan, and China to facilitate an investigation into the prospective interdependencies between the economies of these nations.</p>
<p><strong>Question:</strong> This research project will examine how trade relationships, investment flows, monetary policy environments, and economic performances within the United States, Australia, Japan and China mutually influence each other, and assess the implications of these interactions for predicting future values of these economic indicators.</p>
<p><strong>Motivation:</strong> Since the onset of the COVID-19 pandemic, the global economic landscape has witnessed a series of unprecedented shifts in key macroeconomic indicators, spurred by governments’ adoption of varied expansionary monetary policies. Initially, to buffer their economies, many nations implemented expansive monetary strategies, later swiftly transitioning to interest rate hikes in a bid to manage surging inflation rates—a scenario not seen in decades. The pandemic’s disruption to trade further exacerbated inflationary pressures for some economies, highlighting the intricate interdependencies among major economies with significant trade and financial ties. This period recorded stark contrast in inflation levels, with unprecedented highs in the US and Australia and notably low inflation in China and Japan. Amidst this turmoil, a divergence in economic paths also became apparent, thei9 United States and Australia have witness robust economic rebounds, whereas China and Japan saw more tepid recoveries. This research aims to dissect the nuanced web of economic interdependencies between the United States, Australia, Japan, and China, analyzing how their trade relationships, investment flows, and monetary policy environments have mutually influenced their economic performances. Additionally, it seeks to understand the ramifications of these dynamics for the predictive accuracy of future economic indicators, offering insights into the evolving global economic order.</p>
</section>
<section id="data-and-their-properties" class="level1">
<h1>2. Data and their properties</h1>
<p><strong>Proposed Dataset:</strong> This study is uses data from the International Monetary Fund’s (IMF) database. The IMF data offers a comprehensive collection of global economic information; including several key databases such as the World Economic Outlook Databases, International Financial Statistics (IFS), Government Finance Statistics. This analysis will predominantly focus on the IFS database, which is composed of a sizeable collection of financial and economic data from across the global, featuring 1,681 distinct indicators such as consumer price index, interest rates, exchange rates, national accounts, government finance statistics. The data is available in various frequencies – annual, semi-annual, quarterly, monthly, daily, and weekly. As this research is primarily focused on analyzing macroeconomic data that are published on a monthly or quarterly basis, quarterly data from Q1 1994 to Q3 2023 will be used. The analysis will examine key macroeconomic variables including consumer price indexes, foreign direct investments, exchange rates, balance of payments, interest rates and the national gross domestic product of the United States, Australia, Japan, and China. sf <strong>Variables and Motivation:</strong></p>
<table class="table">
<colgroup>
<col style="width: 45%">
<col style="width: 19%">
<col style="width: 18%">
<col style="width: 6%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th>Variables</th>
<th>Original Unit</th>
<th>Final Unit</th>
<th>Mnemonic</th>
<th>Code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Prices, Consumer Price Index, All items, Previous period</td>
<td>% Change</td>
<td>% Change</td>
<td>% Change</td>
<td>CPI</td>
</tr>
<tr class="even">
<td>Exchange Rates, Domestic Currency per U.S. Dollar, Period Average</td>
<td>per US dollar</td>
<td>per US dollar</td>
<td>XCH</td>
<td>ENDA_XDC_USD_R</td>
</tr>
<tr class="odd">
<td>Gross Domestic Product, Nominal, Seasonally Adjusted</td>
<td>Domestic Currency (millions)</td>
<td>log(US dollar)</td>
<td>GDP</td>
<td>NGDP_NSA_XDC</td>
</tr>
</tbody>
</table>
<p>The variables included in this study were chosen with the objective to include key economic indicators that are susceptible to changes in other nations while also ensuring relatively consistent measures exist for all four nations. These variables were chosen not only for their ability to provide insights into the trade relations, investment dynamics and monetary policy frameworks, but also for their roles as barometers of overall economic health and performance. Exchange rates directly impact trade balances and investment flows, influencing economic performances. By examining the volatility and trends in exchange rates, insights can be gleaned into how monetary policies and economic conditions in one country can affect its trade partners. GDP is the ultimate measure of economic performance, encapsulating the outcome of various economic activities and policies. Analyzing GDP allows for assessing economic momentum and comparing growth rates across countries and over time, offering a clear picture of economic health and trends. CPI was included because it is a crucial indicator of inflation, reflecting changes in the cost of living and purchasing power, and thus, is helpful in quantifying economic stability and monetary policy effectiveness in each nation. The presence of cyclical trends in the variables, alongside the observed impact of lagged values on future outcomes, highlights the suitability of the Bayesian Vector Autoregression model for our analysis. This model can well capture the temporal dynamics and interdependencies inherent in these economic indicators, offering a robust framework for understanding the nuanced interactions and feedback loops that characterize their behavior over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(IMFData)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(progress)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(truncnorm)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extraDistr)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HDInterval)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MCMCpack)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rmpfr)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Download Data </span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#devtools::install_github('mingjerli/IMFData')</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/mingjerli/IMFData</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#find out available dataset in IMF data</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>availableDB <span class="ot">&lt;-</span> <span class="fu">DataflowMethod</span>()</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#availableDB$DatabaseID</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Findout how many dimensions are available in a given dataset. </span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Available dimension code</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>IFS.available.codes <span class="ot">&lt;-</span> <span class="fu">DataStructureMethod</span>(<span class="st">"IFS"</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#names(IFS.available.codes)</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Possible code in the first dimension</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#IFS.available.codes[[1]]</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>IFS.data.category <span class="ot">&lt;-</span>  IFS.available.codes[[<span class="dv">3</span>]]</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Search possible code to use in each dimension. </span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Here, we want to search code related to GDP in CL_INDICATOR_IFS dimension</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">#CodeSearch(IFS.available.codes, "CL_INDICATOR_IFS", "CPI")</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Make API call to get data</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>databaseID <span class="ot">&lt;-</span> <span class="st">"IFS"</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>startdate <span class="ot">=</span> <span class="st">"1950-01-01"</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>enddate <span class="ot">=</span> <span class="st">"2024-05-01"</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>checkquery <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="co">#Interest rate data </span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co">#China</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co"># queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "CN", CL_INDICATOR_IFS = 'FIDR_PA') #Financial, Interest Rates, Deposit, Percent per annum</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co"># CN.IR.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate, </span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">#                                   checkquery)</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="co">#US</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co">#queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "US", CL_INDICATOR_IFS = 'FICPR_PA') #</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co">#queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "US", CL_INDICATOR_IFS = 'FID_PA') #</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co">#queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "US", CL_INDICATOR_IFS = 'FIGBY_SM_PA') #</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co">#queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "US", CL_INDICATOR_IFS = 'FIGB_PA') #</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co">#queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "US", CL_INDICATOR_IFS = 'FITB_3M_PA') #</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co">#queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "US", CL_INDICATOR_IFS = 'FITB_PA') </span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="co">#queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "US", CL_INDICATOR_IFS = 'FIH_HH_L_CC_1Y_PA') </span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co">#queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "US", CL_INDICATOR_IFS = 'FILR_PA') </span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Sys.sleep(0.5)</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="co"># queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "US", CL_INDICATOR_IFS = 'FPOLM_PA') #Financial, Interest Rates, Monetary Policy-Related Interest Rate, Percent per annum</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co"># US.IR.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate,  </span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  checkquery)</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="co">#AU</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Sys.sleep(0.5)</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a><span class="co"># queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "AU", CL_INDICATOR_IFS = 'FPOLM_PA') #Financial, Interest Rates, Monetary Policy-Related Interest Rate, Percent per annum</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a><span class="co"># AU.IR.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate,  </span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  checkquery)</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a><span class="co">#J{} #starts 2006 Q2</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="do">##################################################################</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Sys.sleep(0.5)</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="co"># queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "JP", CL_INDICATOR_IFS = 'FPOLM_PA') #Financial, Interest Rates, Monetary Policy-Related Interest Rate, Percent per annum</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="co"># JP.IR.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate,  </span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  checkquery)</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a><span class="co">#International Investment Positions Data</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a><span class="co">#China</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"CN"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'IAD_BP6_USD'</span>)</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>CN.FDI.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="co">#CN.FDI.query$Obs[[1]]</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="co">#Japan</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"JP"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'IAD_BP6_USD'</span>)</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>JP.FDI.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a><span class="co">#JP.FDI.query$Obs[[1]]</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="co">#United States</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"US"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'IAD_BP6_USD'</span>)</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>US.FDI.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a><span class="co">#US.FDI.query$Obs[[1]]</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a><span class="co">#Australia</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"AU"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'IAD_BP6_USD'</span>)</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>AU.FDI.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="co">#Exchange Rate</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="co">#China</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"CN"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'ENDA_XDC_USD_RATE'</span>)</span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>CN.XCH.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="co">#CN.XCH.query$Obs[[1]]</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="co">#Japan</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"JP"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'ENDA_XDC_USD_RATE'</span>)</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>JP.XCH.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a><span class="co">#JP.XCH.query$Obs[[1]]</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="co">#United States</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"US"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'ENDA_XDC_USD_RATE'</span>)</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>US.XCH.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a><span class="co">#Australia</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"AU"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'ENDA_XDC_USD_RATE'</span>)</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>AU.XCH.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a><span class="co">#Pause for 5 seconds before continue execution </span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a><span class="co">#Balance of Payments </span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a><span class="co">#China</span></span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"CN"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'BGS_BP6_USD'</span>)</span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>CN.BOP.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a><span class="co">#CN.BOP.query$Obs[[1]]</span></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a><span class="co">#Japan</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"JP"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'BGS_BP6_USD'</span>)</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>JP.BOP.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a><span class="co">#JP.BOP.query$Obs[[1]]</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a><span class="co">#United States</span></span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"US"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'BGS_BP6_USD'</span>)</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>US.BOP.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a><span class="co">#US.BOP.query$Obs[[1]]</span></span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a><span class="co">#Australia</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"AU"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'BGS_BP6_USD'</span>)</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>AU.BOP.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a><span class="co">#AU.BOP.query$Obs[[1]]</span></span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a><span class="co">#Bond Yield</span></span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a><span class="co">#China</span></span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a><span class="co"># queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "CN", CL_INDICATOR_IFS = 'FITBBE_PA')</span></span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a><span class="co"># CN.IR.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate, </span></span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  checkquery)</span></span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a><span class="co">#CN.IR.query$Obs[[1]]</span></span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a><span class="co">#Japan</span></span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################</span></span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a><span class="co">#Pause for 5 seconds before continue execution </span></span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################</span></span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a><span class="co"># Sys.sleep(5)</span></span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a><span class="co"># queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "JP", CL_INDICATOR_IFS = 'FIGB_PA')</span></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a><span class="co"># JP.IR.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate, </span></span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  checkquery)</span></span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a><span class="co">#JP.IR.query$Obs[[1]]</span></span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a><span class="co">#United States</span></span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a><span class="co"># queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "US", CL_INDICATOR_IFS = 'FIGB_PA')</span></span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a><span class="co"># US.IR.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate, </span></span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  checkquery)</span></span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a><span class="co"># #US.IR.query$Obs[[1]]</span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a><span class="co">#Australia</span></span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a><span class="co"># queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "AU", CL_INDICATOR_IFS = 'FIGB_PA')</span></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a><span class="co"># AU.IR.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate, </span></span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a><span class="co">#                                  checkquery)</span></span>
<span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a><span class="co">#AU.IR.query$Obs[[1]]</span></span>
<span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a><span class="co">#GDP</span></span>
<span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a><span class="co">#China</span></span>
<span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"CN"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'NGDP_NSA_XDC'</span>)</span>
<span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>CN.GDP.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate,</span>
<span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>CN.GDP.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]]</span>
<span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a><span class="co">#Japan</span></span>
<span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"JP"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'NGDP_NSA_XDC'</span>)</span>
<span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>JP.GDP.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate,</span>
<span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a><span class="co">#JP.GDP.query$Obs[[1]]</span></span>
<span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################</span></span>
<span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a><span class="co">#Pause for five seconds before continue execution </span></span>
<span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a><span class="do">########################################################################</span></span>
<span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a><span class="co">#United States</span></span>
<span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"US"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'NGDP_NSA_XDC'</span>)</span>
<span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>US.GDP.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a><span class="co">#US.GDP.query$Obs[[1]]</span></span>
<span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a><span class="co">#Australia</span></span>
<span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"AU"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'NGDP_NSA_XDC'</span>)</span>
<span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>AU.GDP.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a><span class="co">#AU.GDP.query$Obs[[1]]</span></span>
<span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a><span class="co">#CPI</span></span>
<span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a><span class="co">#China</span></span>
<span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"CN"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'PCPI_PC_PP_PT'</span>)</span>
<span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>CN.CPI.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a><span class="co">#CN.CPI.query$Obs[[1]]</span></span>
<span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a><span class="co">#Japan</span></span>
<span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"JP"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'PCPI_PC_PP_PT'</span>)</span>
<span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>JP.CPI.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a><span class="co">#JP.CPI.query$Obs[[1]]</span></span>
<span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a><span class="co">#United States</span></span>
<span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"US"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'PCPI_PC_PP_PT'</span>)</span>
<span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>US.CPI.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a><span class="co">#US.CPI.query$Obs[[1]]</span></span>
<span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a><span class="co">#Australia</span></span>
<span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>queryfilter <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">CL_FREA =</span> <span class="st">"Q"</span>, <span class="at">CL_AREA_IFS =</span> <span class="st">"AU"</span>, <span class="at">CL_INDICATOR_IFS =</span> <span class="st">'PCPI_PC_PP_PT'</span>)</span>
<span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>AU.CPI.query <span class="ot">&lt;-</span> <span class="fu">CompactDataMethod</span>(databaseID, queryfilter, startdate, enddate, </span>
<span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>                                  checkquery)</span>
<span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a><span class="co">#AU.CPI.query$Obs[[1]]</span></span>
<span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a><span class="co"># #Unemployment Rate</span></span>
<span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a><span class="co"># #China</span></span>
<span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a><span class="co"># queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "CN", CL_INDICATOR_IFS = 'LUR_PT')</span></span>
<span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a><span class="co"># CN.UMR.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate, </span></span>
<span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a><span class="co">#                                   checkquery)</span></span>
<span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a><span class="co"># #CN.UMR.query$Obs[[1]]</span></span>
<span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a><span class="co"># #Japan</span></span>
<span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a><span class="co"># queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "JP", CL_INDICATOR_IFS = 'LUR_PT')</span></span>
<span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a><span class="co"># JP.UMR.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate, </span></span>
<span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a><span class="co">#                                   checkquery)</span></span>
<span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a><span class="co"># #JP.UMR.query$Obs[[1]]</span></span>
<span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a><span class="co"># #United States</span></span>
<span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a><span class="co"># queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "US", CL_INDICATOR_IFS = 'LUR_PT')</span></span>
<span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a><span class="co"># US.UMR.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate, </span></span>
<span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a><span class="co">#                                   checkquery)</span></span>
<span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a><span class="co"># #US.UMR.query$Obs[[1]]</span></span>
<span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a><span class="co"># #Australia</span></span>
<span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a><span class="co"># queryfilter &lt;- list(CL_FREA = "Q", CL_AREA_IFS = "AU", CL_INDICATOR_IFS = 'LUR_PT')</span></span>
<span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a><span class="co"># AU.UMR.query &lt;- CompactDataMethod(databaseID, queryfilter, startdate, enddate, </span></span>
<span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a><span class="co">#                                   checkquery)</span></span>
<span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a><span class="co"># #AU.UMR.query$Obs[[1]]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot Data</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available interest rate data fo China: ')</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(CN.IR.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available interest rate data fo Australia: ')</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(AU.IR.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available interest rate data fo Japan: ')</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(JP.IR.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available interest rate data fo US: ')</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(US.IR.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available interest rate data fo China: ')</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(CN.IR.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available interest rate data fo Australia: ')</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(AU.IR.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available interest rate data fo Japan: ')</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(JP.IR.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available interest rate data fo US: ')</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(US.IR.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># years &lt;- 2006:2023</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># quarters &lt;- paste(rep(years, each = 4), rep(c("-Q1", "-Q2", "-Q3", "-Q4"), times = length(years)), sep = "")</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># all_quarters &lt;- data.frame(Time = quarters[quarters &gt;= "2006-Q2" &amp; quarters &lt;= "2023-Q4"])</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># IR_data = data.frame(JP.IR.query$Obs[[1]])</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># IR_data = IR_data[,1:2]</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(IR_data) = c('Time', 'JP_IR')</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co"># #IR_data$Time &lt;- as.character(as.yearqtr(IR_data$Time))</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co"># IR_data = left_join(all_quarters,  IR_data, by = "Time")</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="co"># IR_data &lt;- IR_data %&gt;%</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   fill(JP_IR, .direction = "down")</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = data.frame(CN.IR.query$Obs[[1]])</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = tmp[,1:2]</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(tmp) = c('Time', 'CN_IR')</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co"># IR_data = left_join(IR_data,  tmp, by = "Time")</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = data.frame(US.IR.query$Obs[[1]])</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = tmp[,1:2]</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(tmp) = c('Time', 'US_IR')</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co"># IR_data = left_join(IR_data,  tmp, by = "Time")</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = data.frame(AU.IR.query$Obs[[1]])</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = tmp[,1:2]</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(tmp) = c('Time', 'AU_IR')</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co"># IR_data = left_join(IR_data,  tmp, by = "Time")</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="co"># IR_data$Time = as.yearqtr(IR_data$Time, format = "%Y-Q%q")</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co"># IR_data &lt;- IR_data %&gt;%</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="co">#     JP_IR = as.numeric(JP_IR),</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="co">#     CN_IR = as.numeric(CN_IR),</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a><span class="co">#     US_IR = as.numeric(US_IR),</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="co">#     AU_IR = as.numeric(AU_IR)</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a><span class="co"># IR_data_long &lt;- pivot_longer(IR_data,</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a><span class="co">#                               cols = colnames(IR_data)[2:5],</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a><span class="co">#                               names_to = "Country",</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a><span class="co">#                               values_to = "IR")</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="co"># IR_plot &lt;- ggplot(data = IR_data_long, aes(x = Time, y = IR, color = Country)) +</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line() +</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(values = c(</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a><span class="co">#     "CN_IR" = "#3498db",  # Blue</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a><span class="co">#     "JP_IR" = "#e74c3c",  # Red</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a><span class="co">#     "US_IR" = "#2ecc71",  # Green</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="co">#     "AU_IR" = "#f39c12"   # Orange</span></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a><span class="co">#   )) +</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Time", y = "IR (%)", title = "IR Trends", color = "Country") +</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="co">#     legend.title = element_blank(),  # Removes the legend title for a cleaner look</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="co">#     legend.position = "bottom"       # Moves the legend to the bottom</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="do">###################################CPI##########################################</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available consumer price index data fo China: ')</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(CN.CPI.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available consumer price index data fo Australia: ')</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(AU.CPI.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available consumer price index data fo Japan: ')</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(JP.CPI.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available consumer price index data fo US: ')</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(US.CPI.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'newest available consumer price index data fo China: '</span>)</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">max</span>(CN.CPI.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]]<span class="sc">$</span><span class="st">`</span><span class="at">@TIME_PERIOD</span><span class="st">`</span>))</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'newest available consumer price index data fo Australia: '</span>)</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">max</span>(AU.CPI.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]]<span class="sc">$</span><span class="st">`</span><span class="at">@TIME_PERIOD</span><span class="st">`</span>))</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'newest available consumer price index data fo Japan: '</span>)</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">max</span>(JP.CPI.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]]<span class="sc">$</span><span class="st">`</span><span class="at">@TIME_PERIOD</span><span class="st">`</span>))</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'newest available consumer price index data fo US: '</span>)</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">max</span>(US.CPI.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]]<span class="sc">$</span><span class="st">`</span><span class="at">@TIME_PERIOD</span><span class="st">`</span>))</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="dv">1986</span><span class="sc">:</span><span class="dv">2024</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>quarters <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">rep</span>(years, <span class="at">each =</span> <span class="dv">4</span>), <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"-Q1"</span>, <span class="st">"-Q2"</span>, <span class="st">"-Q3"</span>, <span class="st">"-Q4"</span>), <span class="at">times =</span> <span class="fu">length</span>(years)), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>all_quarters <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> quarters[quarters <span class="sc">&gt;=</span> <span class="st">"1986-Q2"</span> <span class="sc">&amp;</span> quarters <span class="sc">&lt;=</span> <span class="st">"2024-Q1"</span>])</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>CPI_data <span class="ot">=</span> <span class="fu">data.frame</span>(JP.CPI.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]])</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>CPI_data <span class="ot">=</span> CPI_data[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(CPI_data) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Time'</span>, <span class="st">'JP_CPI'</span>)</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a><span class="co">#CPI_data$Time &lt;- as.character(as.yearqtr(CPI_data$Time))</span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>CPI_data <span class="ot">=</span> <span class="fu">left_join</span>(all_quarters,  CPI_data, <span class="at">by =</span> <span class="st">"Time"</span>)</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">data.frame</span>(CN.CPI.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]])</span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> tmp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmp) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Time'</span>, <span class="st">'CN_CPI'</span>)</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>CPI_data <span class="ot">=</span> <span class="fu">left_join</span>(CPI_data,  tmp, <span class="at">by =</span> <span class="st">"Time"</span>)</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">data.frame</span>(US.CPI.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]])</span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> tmp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmp) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Time'</span>, <span class="st">'US_CPI'</span>)</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>CPI_data <span class="ot">=</span> <span class="fu">left_join</span>(CPI_data,  tmp, <span class="at">by =</span> <span class="st">"Time"</span>)</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">data.frame</span>(AU.CPI.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]])</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> tmp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmp) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Time'</span>, <span class="st">'AU_CPI'</span>)</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>CPI_data <span class="ot">=</span> <span class="fu">left_join</span>(CPI_data,  tmp, <span class="at">by =</span> <span class="st">"Time"</span>)</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>CPI_data<span class="sc">$</span>Time <span class="ot">=</span> <span class="fu">as.yearqtr</span>(CPI_data<span class="sc">$</span>Time, <span class="at">format =</span> <span class="st">"%Y-Q%q"</span>)</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>CPI_data <span class="ot">&lt;-</span> CPI_data <span class="sc">%&gt;%</span></span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>    <span class="at">JP_CPI =</span> <span class="fu">as.numeric</span>(JP_CPI),</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">CN_CPI =</span> <span class="fu">as.numeric</span>(CN_CPI),</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">US_CPI =</span> <span class="fu">as.numeric</span>(US_CPI),</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">AU_CPI =</span> <span class="fu">as.numeric</span>(AU_CPI)</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>CPI_data_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(CPI_data,</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>                              <span class="at">cols =</span> <span class="fu">colnames</span>(CPI_data)[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_to =</span> <span class="st">"Country"</span>,</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>                              <span class="at">values_to =</span> <span class="st">"CPI"</span>)</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>CPI_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> CPI_data_long, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> CPI, <span class="at">color =</span> Country)) <span class="sc">+</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CN_CPI"</span> <span class="ot">=</span> <span class="st">"#3498db"</span>,  <span class="co"># Blue</span></span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>    <span class="st">"JP_CPI"</span> <span class="ot">=</span> <span class="st">"#e74c3c"</span>,  <span class="co"># Red</span></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>    <span class="st">"US_CPI"</span> <span class="ot">=</span> <span class="st">"#2ecc71"</span>,  <span class="co"># Green</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AU_CPI"</span> <span class="ot">=</span> <span class="st">"#f39c12"</span>   <span class="co"># Orange</span></span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"CPI (%)"</span>, <span class="at">title =</span> <span class="st">"CPI Trends"</span>, <span class="at">color =</span> <span class="st">"Country"</span>) <span class="sc">+</span></span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),  <span class="co"># Removes the legend title for a cleaner look</span></span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>       <span class="co"># Moves the legend to the bottom</span></span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a><span class="do">###############################################FDI###############################</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available foreign direct investment data fo China: ')</span></span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(CN.FDI.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available foreign direct investment data fo Australia: ')</span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(AU.FDI.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available foreign direct investment data fo Japan: ')</span></span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(JP.FDI.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available foreign direct investment data fo US: ')</span></span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(US.FDI.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available foreign direct investment data fo China: ')</span></span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(CN.FDI.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available foreign direct investment data fo Australia: ')</span></span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(AU.FDI.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available foreign direct investment data fo Japan: ')</span></span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(JP.FDI.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available foreign direct investment data fo US: ')</span></span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(US.FDI.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a><span class="co"># years &lt;- 2010:2023</span></span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a><span class="co"># quarters &lt;- paste(rep(years, each = 4), rep(c("-Q1", "-Q2", "-Q3", "-Q4"), times = length(years)), sep = "")</span></span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a><span class="co"># all_quarters &lt;- data.frame(Time = quarters[quarters &gt;= "2010-Q4" &amp; quarters &lt;= "2023-Q3"])</span></span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a><span class="co"># FDI_data = data.frame(JP.FDI.query$Obs[[1]])</span></span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a><span class="co"># FDI_data = FDI_data[,1:2]</span></span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(FDI_data) = c('Time', 'JP_FDI')</span></span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a><span class="co"># #FDI_data$Time &lt;- as.character(as.yearqtr(FDI_data$Time))</span></span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a><span class="co"># FDI_data = left_join(all_quarters,  FDI_data, by = "Time")</span></span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = data.frame(CN.FDI.query$Obs[[1]])</span></span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = tmp[,1:2]</span></span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(tmp) = c('Time', 'CN_FDI')</span></span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a><span class="co"># FDI_data = left_join(FDI_data,  tmp, by = "Time")</span></span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = data.frame(US.FDI.query$Obs[[1]])</span></span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = tmp[,c(1, 3)]</span></span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(tmp) = c('Time', 'US_FDI')</span></span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a><span class="co"># FDI_data = left_join(FDI_data,  tmp, by = "Time")</span></span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = data.frame(AU.FDI.query$Obs[[1]])</span></span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = tmp[,1:2]</span></span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(tmp) = c('Time', 'AU_FDI')</span></span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a><span class="co"># FDI_data = left_join(FDI_data,  tmp, by = "Time")</span></span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a><span class="co"># FDI_data$Time = as.yearqtr(FDI_data$Time, format = "%Y-Q%q")</span></span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a><span class="co"># FDI_data &lt;- FDI_data %&gt;%</span></span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a><span class="co">#     JP_FDI = as.numeric(JP_FDI),</span></span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a><span class="co">#     CN_FDI = as.numeric(CN_FDI),</span></span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a><span class="co">#     US_FDI = as.numeric(US_FDI),</span></span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a><span class="co">#     AU_FDI = as.numeric(AU_FDI)</span></span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a><span class="co"># FDI_data_long &lt;- pivot_longer(FDI_data,</span></span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a><span class="co">#                               cols = colnames(FDI_data)[2:5],</span></span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a><span class="co">#                               names_to = "Country",</span></span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a><span class="co">#                               values_to = "FDI")</span></span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a><span class="co"># FDI_plot &lt;- ggplot(data = FDI_data_long, aes(x = Time, y = FDI, color = Country)) +</span></span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line() +</span></span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(values = c(</span></span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a><span class="co">#     "CN_FDI" = "#3498db",  # Blue</span></span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a><span class="co">#     "JP_FDI" = "#e74c3c",  # Red</span></span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a><span class="co">#     "US_FDI" = "#2ecc71",  # Green</span></span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a><span class="co">#     "AU_FDI" = "#f39c12"   # Orange</span></span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a><span class="co">#   )) +</span></span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Time", y = "FDI (%)", title = "FDI Trends", color = "Country") +</span></span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(</span></span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a><span class="co">#     legend.title = element_blank(),  # Removes the legend title for a cleaner look</span></span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a><span class="co">#     legend.position = "bottom"       # Moves the legend to the bottom</span></span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################XCH###################################</span></span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available exchange rate data fo China: ')</span></span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(CN.XCH.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available exchange rate data fo Australia: ')</span></span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(AU.XCH.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available exchange rate data fo Japan: ')</span></span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(JP.XCH.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available exchange rate data fo US: ')</span></span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(US.XCH.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available exchange rate data fo China: ')</span></span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(CN.XCH.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available exchange rate data fo Australia: ')</span></span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(AU.XCH.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available exchange rate data fo Japan: ')</span></span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(JP.XCH.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available exchange rate data fo US: ')</span></span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(US.XCH.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="dv">1980</span><span class="sc">:</span><span class="dv">2024</span></span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a>quarters <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">rep</span>(years, <span class="at">each =</span> <span class="dv">4</span>), <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"-Q1"</span>, <span class="st">"-Q2"</span>, <span class="st">"-Q3"</span>, <span class="st">"-Q4"</span>), <span class="at">times =</span> <span class="fu">length</span>(years)), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a>all_quarters <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> quarters[quarters <span class="sc">&gt;=</span> <span class="st">"1980-Q1"</span> <span class="sc">&amp;</span> quarters <span class="sc">&lt;=</span> <span class="st">"2024-Q1"</span>])</span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>XCH_data <span class="ot">=</span> <span class="fu">data.frame</span>(JP.XCH.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]])</span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a>XCH_data <span class="ot">=</span> XCH_data[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(XCH_data) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Time'</span>, <span class="st">'JP_XCH'</span>)</span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a><span class="co">#XCH_data$Time &lt;- as.character(as.yearqtr(XCH_data$Time))</span></span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a>XCH_data <span class="ot">=</span> <span class="fu">left_join</span>(all_quarters,  XCH_data, <span class="at">by =</span> <span class="st">"Time"</span>)</span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">data.frame</span>(CN.XCH.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]])</span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> tmp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmp) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Time'</span>, <span class="st">'CN_XCH'</span>)</span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a>XCH_data <span class="ot">=</span> <span class="fu">left_join</span>(XCH_data,  tmp, <span class="at">by =</span> <span class="st">"Time"</span>)</span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">data.frame</span>(US.XCH.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]])</span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> tmp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmp) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Time'</span>, <span class="st">'US_XCH'</span>)</span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a>XCH_data <span class="ot">=</span> <span class="fu">left_join</span>(XCH_data,  tmp, <span class="at">by =</span> <span class="st">"Time"</span>)</span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">data.frame</span>(AU.XCH.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]])</span>
<span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> tmp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmp) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Time'</span>, <span class="st">'AU_XCH'</span>)</span>
<span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a>XCH_data <span class="ot">=</span> <span class="fu">left_join</span>(XCH_data,  tmp, <span class="at">by =</span> <span class="st">"Time"</span>)</span>
<span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a>XCH_data<span class="sc">$</span>Time <span class="ot">=</span> <span class="fu">as.yearqtr</span>(XCH_data<span class="sc">$</span>Time, <span class="at">format =</span> <span class="st">"%Y-Q%q"</span>)</span>
<span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a>XCH_data <span class="ot">&lt;-</span> XCH_data <span class="sc">%&gt;%</span></span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a>    <span class="at">JP_XCH =</span> <span class="fu">as.numeric</span>(JP_XCH),</span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a>    <span class="at">CN_XCH =</span> <span class="fu">as.numeric</span>(CN_XCH),</span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a>    <span class="at">US_XCH =</span> <span class="fu">as.numeric</span>(US_XCH),</span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a>    <span class="at">AU_XCH =</span> <span class="fu">as.numeric</span>(AU_XCH)</span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a>XCH_data_percent <span class="ot">&lt;-</span> XCH_data <span class="sc">%&gt;%</span></span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(JP_XCH, CN_XCH, AU_XCH),</span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span> (.<span class="sc">/</span><span class="fu">lag</span>(.) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">"{.col}"</span>))</span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a>XCH_data_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(XCH_data,</span>
<span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a>                              <span class="at">cols =</span> <span class="fu">colnames</span>(XCH_data)[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_to =</span> <span class="st">"Country"</span>,</span>
<span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a>                              <span class="at">values_to =</span> <span class="st">"XCH"</span>)</span>
<span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a>XCH_data_percent_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(XCH_data_percent,</span>
<span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a>                              <span class="at">cols =</span> <span class="fu">colnames</span>(XCH_data)[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_to =</span> <span class="st">"Country"</span>,</span>
<span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a>                              <span class="at">values_to =</span> <span class="st">"XCH"</span>)</span>
<span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a>XCH_data_long <span class="ot">&lt;-</span> XCH_data_long <span class="sc">%&gt;%</span></span>
<span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a> <span class="fu">filter</span>(Country <span class="sc">!=</span> <span class="st">"US_XCH"</span>)</span>
<span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a>XCH_data_long <span class="ot">&lt;-</span> XCH_data_long <span class="sc">%&gt;%</span></span>
<span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">JP_Scaled_XCH =</span> <span class="fu">ifelse</span>(Country <span class="sc">==</span> <span class="st">"JP_XCH"</span>, XCH <span class="sc">*</span> <span class="fl">0.1</span>, XCH))</span>
<span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a><span class="co"># XCH_data_percent_long &lt;- XCH_data_percent_long %&gt;%</span></span>
<span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a><span class="co">#  filter(Country != "US_XCH")</span></span>
<span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a>XCH_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> XCH_data_long, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">color =</span> Country)) <span class="sc">+</span></span>
<span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span>  JP_Scaled_XCH))<span class="sc">+</span>  <span class="co"># Plot AU and CN on the primary axis Plot JP on the secondary axis</span></span>
<span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Exchange rate against the dollar, AUD and CNY per dollar"</span>,</span>
<span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">*</span> <span class="dv">10</span>, <span class="at">name =</span> <span class="st">"Exchange rate against the dollar, 10 JPY per dollar"</span>)  <span class="co"># Adjust the transformation to match the scale factor used above</span></span>
<span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CN_XCH"</span> <span class="ot">=</span> <span class="st">"#3498db"</span>,  <span class="co"># Blue</span></span>
<span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a>    <span class="st">"JP_XCH"</span> <span class="ot">=</span> <span class="st">"#e74c3c"</span>,  <span class="co"># Red</span></span>
<span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AU_XCH"</span> <span class="ot">=</span> <span class="st">"#f39c12"</span>   <span class="co"># Orange</span></span>
<span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Exchange Rate Against the Dollar"</span>,</span>
<span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Country"</span></span>
<span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb3-326"><a href="#cb3-326" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),  </span>
<span id="cb3-327"><a href="#cb3-327" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>)</span>
<span id="cb3-328"><a href="#cb3-328" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-329"><a href="#cb3-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-330"><a href="#cb3-330" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-331"><a href="#cb3-331" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################BOP###################################</span></span>
<span id="cb3-332"><a href="#cb3-332" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-333"><a href="#cb3-333" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available balance of payments data fo China: ')</span></span>
<span id="cb3-334"><a href="#cb3-334" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(CN.BOP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-335"><a href="#cb3-335" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available balance of payments data fo Australia: ')</span></span>
<span id="cb3-336"><a href="#cb3-336" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(AU.BOP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-337"><a href="#cb3-337" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available balance of payments data fo Japan: ')</span></span>
<span id="cb3-338"><a href="#cb3-338" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(JP.BOP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-339"><a href="#cb3-339" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available balance of payments data fo US: ')</span></span>
<span id="cb3-340"><a href="#cb3-340" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(US.BOP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-341"><a href="#cb3-341" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-342"><a href="#cb3-342" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available balance of payments data fo China: ')</span></span>
<span id="cb3-343"><a href="#cb3-343" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(CN.BOP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-344"><a href="#cb3-344" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available balance of payments data fo Australia: ')</span></span>
<span id="cb3-345"><a href="#cb3-345" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(AU.BOP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-346"><a href="#cb3-346" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available balance of payments data fo Japan: ')</span></span>
<span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(JP.BOP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-348"><a href="#cb3-348" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available balance of payments data fo US: ')</span></span>
<span id="cb3-349"><a href="#cb3-349" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(US.BOP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-350"><a href="#cb3-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-351"><a href="#cb3-351" aria-hidden="true" tabindex="-1"></a><span class="co"># years &lt;- 2005:2024</span></span>
<span id="cb3-352"><a href="#cb3-352" aria-hidden="true" tabindex="-1"></a><span class="co"># quarters &lt;- paste(rep(years, each = 4), rep(c("-Q1", "-Q2", "-Q3", "-Q4"), times = length(years)), sep = "")</span></span>
<span id="cb3-353"><a href="#cb3-353" aria-hidden="true" tabindex="-1"></a><span class="co"># all_quarters &lt;- data.frame(Time = quarters[quarters &gt;= "2005-Q1" &amp; quarters &lt;= "2023-Q4"])</span></span>
<span id="cb3-354"><a href="#cb3-354" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a><span class="co"># BOP_data = data.frame(JP.BOP.query$Obs[[1]])</span></span>
<span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a><span class="co"># BOP_data = BOP_data[,1:2]</span></span>
<span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(BOP_data) = c('Time', 'JP_BOP')</span></span>
<span id="cb3-358"><a href="#cb3-358" aria-hidden="true" tabindex="-1"></a><span class="co">#BOP_data$Time &lt;- as.character(as.yearqtr(BOP_data$Time))</span></span>
<span id="cb3-359"><a href="#cb3-359" aria-hidden="true" tabindex="-1"></a><span class="co"># BOP_data = left_join(all_quarters,  BOP_data, by = "Time")</span></span>
<span id="cb3-360"><a href="#cb3-360" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-361"><a href="#cb3-361" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = data.frame(CN.BOP.query$Obs[[1]])</span></span>
<span id="cb3-362"><a href="#cb3-362" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = tmp[,1:2]</span></span>
<span id="cb3-363"><a href="#cb3-363" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(tmp) = c('Time', 'CN_BOP')</span></span>
<span id="cb3-364"><a href="#cb3-364" aria-hidden="true" tabindex="-1"></a><span class="co"># BOP_data = left_join(BOP_data,  tmp, by = "Time")</span></span>
<span id="cb3-365"><a href="#cb3-365" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-366"><a href="#cb3-366" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = data.frame(US.BOP.query$Obs[[1]])</span></span>
<span id="cb3-367"><a href="#cb3-367" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = tmp[,1:2]</span></span>
<span id="cb3-368"><a href="#cb3-368" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(tmp) = c('Time', 'US_BOP')</span></span>
<span id="cb3-369"><a href="#cb3-369" aria-hidden="true" tabindex="-1"></a><span class="co"># BOP_data = left_join(BOP_data,  tmp, by = "Time")</span></span>
<span id="cb3-370"><a href="#cb3-370" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-371"><a href="#cb3-371" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = data.frame(AU.BOP.query$Obs[[1]])</span></span>
<span id="cb3-372"><a href="#cb3-372" aria-hidden="true" tabindex="-1"></a><span class="co"># tmp = tmp[,1:2]</span></span>
<span id="cb3-373"><a href="#cb3-373" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(tmp) = c('Time', 'AU_BOP')</span></span>
<span id="cb3-374"><a href="#cb3-374" aria-hidden="true" tabindex="-1"></a><span class="co"># BOP_data = left_join(BOP_data,  tmp, by = "Time")</span></span>
<span id="cb3-375"><a href="#cb3-375" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-376"><a href="#cb3-376" aria-hidden="true" tabindex="-1"></a><span class="co"># BOP_data$Time = as.yearqtr(BOP_data$Time, format = "%Y-Q%q")</span></span>
<span id="cb3-377"><a href="#cb3-377" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-378"><a href="#cb3-378" aria-hidden="true" tabindex="-1"></a><span class="co"># BOP_data &lt;- BOP_data %&gt;%</span></span>
<span id="cb3-379"><a href="#cb3-379" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(</span></span>
<span id="cb3-380"><a href="#cb3-380" aria-hidden="true" tabindex="-1"></a><span class="co">#     JP_BOP = as.numeric(JP_BOP),</span></span>
<span id="cb3-381"><a href="#cb3-381" aria-hidden="true" tabindex="-1"></a><span class="co">#     CN_BOP = as.numeric(CN_BOP),</span></span>
<span id="cb3-382"><a href="#cb3-382" aria-hidden="true" tabindex="-1"></a><span class="co">#     US_BOP = as.numeric(US_BOP),</span></span>
<span id="cb3-383"><a href="#cb3-383" aria-hidden="true" tabindex="-1"></a><span class="co">#     AU_BOP = as.numeric(AU_BOP)</span></span>
<span id="cb3-384"><a href="#cb3-384" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a><span class="co"># BOP_data_long &lt;- pivot_longer(BOP_data,</span></span>
<span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a><span class="co">#                               cols = colnames(BOP_data)[2:5],</span></span>
<span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a><span class="co">#                               names_to = "Country",</span></span>
<span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a><span class="co">#                               values_to = "BOP")</span></span>
<span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-390"><a href="#cb3-390" aria-hidden="true" tabindex="-1"></a><span class="co"># BOP_plot &lt;- ggplot(data = BOP_data_long, aes(x = Time, y = BOP, color = Country)) +</span></span>
<span id="cb3-391"><a href="#cb3-391" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line() +</span></span>
<span id="cb3-392"><a href="#cb3-392" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(values = c(</span></span>
<span id="cb3-393"><a href="#cb3-393" aria-hidden="true" tabindex="-1"></a><span class="co">#     "CN_BOP" = "#3498db",  # Blue</span></span>
<span id="cb3-394"><a href="#cb3-394" aria-hidden="true" tabindex="-1"></a><span class="co">#     "JP_BOP" = "#e74c3c",  # Red</span></span>
<span id="cb3-395"><a href="#cb3-395" aria-hidden="true" tabindex="-1"></a><span class="co">#     "US_BOP" = "#2ecc71",  # Green</span></span>
<span id="cb3-396"><a href="#cb3-396" aria-hidden="true" tabindex="-1"></a><span class="co">#     "AU_BOP" = "#f39c12"   # Orange</span></span>
<span id="cb3-397"><a href="#cb3-397" aria-hidden="true" tabindex="-1"></a><span class="co">#   )) +</span></span>
<span id="cb3-398"><a href="#cb3-398" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_minimal() +</span></span>
<span id="cb3-399"><a href="#cb3-399" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(x = "Time", y = "BOP (%)", title = "BOP Trends", color = "Country") +</span></span>
<span id="cb3-400"><a href="#cb3-400" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(</span></span>
<span id="cb3-401"><a href="#cb3-401" aria-hidden="true" tabindex="-1"></a><span class="co">#     legend.title = element_blank(),  # Removes the legend title for a cleaner look</span></span>
<span id="cb3-402"><a href="#cb3-402" aria-hidden="true" tabindex="-1"></a><span class="co">#     legend.position = "bottom"       # Moves the legend to the bottom</span></span>
<span id="cb3-403"><a href="#cb3-403" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb3-404"><a href="#cb3-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-405"><a href="#cb3-405" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-406"><a href="#cb3-406" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################GDP###################################</span></span>
<span id="cb3-407"><a href="#cb3-407" aria-hidden="true" tabindex="-1"></a><span class="do">#################################################################################</span></span>
<span id="cb3-408"><a href="#cb3-408" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available gross domestic product data fo China: ')</span></span>
<span id="cb3-409"><a href="#cb3-409" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(CN.GDP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-410"><a href="#cb3-410" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available gross domestic product data fo Australia: ')</span></span>
<span id="cb3-411"><a href="#cb3-411" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(AU.GDP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-412"><a href="#cb3-412" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available gross domestic product data fo Japan: ')</span></span>
<span id="cb3-413"><a href="#cb3-413" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(JP.GDP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-414"><a href="#cb3-414" aria-hidden="true" tabindex="-1"></a><span class="co"># print('earliest available gross domestic product data fo US: ')</span></span>
<span id="cb3-415"><a href="#cb3-415" aria-hidden="true" tabindex="-1"></a><span class="co"># print(min(US.GDP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-416"><a href="#cb3-416" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb3-417"><a href="#cb3-417" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available gross domestic product data fo China: ')</span></span>
<span id="cb3-418"><a href="#cb3-418" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(CN.GDP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-419"><a href="#cb3-419" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available gross domestic product data fo Australia: ')</span></span>
<span id="cb3-420"><a href="#cb3-420" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(AU.GDP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-421"><a href="#cb3-421" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available gross domestic product data fo Japan: ')</span></span>
<span id="cb3-422"><a href="#cb3-422" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(JP.GDP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-423"><a href="#cb3-423" aria-hidden="true" tabindex="-1"></a><span class="co"># print('newest available gross domestic product data fo US: ')</span></span>
<span id="cb3-424"><a href="#cb3-424" aria-hidden="true" tabindex="-1"></a><span class="co"># print(max(US.GDP.query$Obs[[1]]$`@TIME_PERIOD`))</span></span>
<span id="cb3-425"><a href="#cb3-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-426"><a href="#cb3-426" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="dv">1994</span><span class="sc">:</span><span class="dv">2024</span></span>
<span id="cb3-427"><a href="#cb3-427" aria-hidden="true" tabindex="-1"></a>quarters <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">rep</span>(years, <span class="at">each =</span> <span class="dv">4</span>), <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"-Q1"</span>, <span class="st">"-Q2"</span>, <span class="st">"-Q3"</span>, <span class="st">"-Q4"</span>), <span class="at">times =</span> <span class="fu">length</span>(years)), <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb3-428"><a href="#cb3-428" aria-hidden="true" tabindex="-1"></a>all_quarters <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> quarters[quarters <span class="sc">&gt;=</span> <span class="st">"1994-Q1"</span> <span class="sc">&amp;</span> quarters <span class="sc">&lt;=</span> <span class="st">"2023-Q3"</span>])</span>
<span id="cb3-429"><a href="#cb3-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-430"><a href="#cb3-430" aria-hidden="true" tabindex="-1"></a>GDP_data <span class="ot">=</span> <span class="fu">data.frame</span>(JP.GDP.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]])</span>
<span id="cb3-431"><a href="#cb3-431" aria-hidden="true" tabindex="-1"></a>GDP_data <span class="ot">=</span> GDP_data[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb3-432"><a href="#cb3-432" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(GDP_data) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Time'</span>, <span class="st">'JP_GDP'</span>)</span>
<span id="cb3-433"><a href="#cb3-433" aria-hidden="true" tabindex="-1"></a><span class="co">#GDP_data$Time &lt;- as.character(as.yearqtr(GDP_data$Time))</span></span>
<span id="cb3-434"><a href="#cb3-434" aria-hidden="true" tabindex="-1"></a>GDP_data <span class="ot">=</span> <span class="fu">left_join</span>(all_quarters,  GDP_data, <span class="at">by =</span> <span class="st">"Time"</span>)</span>
<span id="cb3-435"><a href="#cb3-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-436"><a href="#cb3-436" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">data.frame</span>(CN.GDP.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]])</span>
<span id="cb3-437"><a href="#cb3-437" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> tmp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb3-438"><a href="#cb3-438" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmp) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Time'</span>, <span class="st">'CN_GDP'</span>)</span>
<span id="cb3-439"><a href="#cb3-439" aria-hidden="true" tabindex="-1"></a>GDP_data <span class="ot">=</span> <span class="fu">left_join</span>(GDP_data,  tmp, <span class="at">by =</span> <span class="st">"Time"</span>)</span>
<span id="cb3-440"><a href="#cb3-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-441"><a href="#cb3-441" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">data.frame</span>(US.GDP.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]])</span>
<span id="cb3-442"><a href="#cb3-442" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> tmp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb3-443"><a href="#cb3-443" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmp) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Time'</span>, <span class="st">'US_GDP'</span>)</span>
<span id="cb3-444"><a href="#cb3-444" aria-hidden="true" tabindex="-1"></a>GDP_data <span class="ot">=</span> <span class="fu">left_join</span>(GDP_data,  tmp, <span class="at">by =</span> <span class="st">"Time"</span>)</span>
<span id="cb3-445"><a href="#cb3-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-446"><a href="#cb3-446" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">data.frame</span>(AU.GDP.query<span class="sc">$</span>Obs[[<span class="dv">1</span>]])</span>
<span id="cb3-447"><a href="#cb3-447" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> tmp[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb3-448"><a href="#cb3-448" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tmp) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'Time'</span>, <span class="st">'AU_GDP'</span>)</span>
<span id="cb3-449"><a href="#cb3-449" aria-hidden="true" tabindex="-1"></a>GDP_data <span class="ot">=</span> <span class="fu">left_join</span>(GDP_data,  tmp, <span class="at">by =</span> <span class="st">"Time"</span>)</span>
<span id="cb3-450"><a href="#cb3-450" aria-hidden="true" tabindex="-1"></a>GDP_data<span class="sc">$</span>Time <span class="ot">=</span> <span class="fu">as.yearqtr</span>(GDP_data<span class="sc">$</span>Time, <span class="at">format =</span> <span class="st">"%Y-Q%q"</span>)</span>
<span id="cb3-451"><a href="#cb3-451" aria-hidden="true" tabindex="-1"></a>GDP_data <span class="ot">&lt;-</span> GDP_data <span class="sc">%&gt;%</span></span>
<span id="cb3-452"><a href="#cb3-452" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-453"><a href="#cb3-453" aria-hidden="true" tabindex="-1"></a>    <span class="at">JP_GDP =</span> <span class="fu">as.numeric</span>(JP_GDP),</span>
<span id="cb3-454"><a href="#cb3-454" aria-hidden="true" tabindex="-1"></a>    <span class="at">CN_GDP =</span> <span class="fu">as.numeric</span>(CN_GDP),</span>
<span id="cb3-455"><a href="#cb3-455" aria-hidden="true" tabindex="-1"></a>    <span class="at">US_GDP =</span> <span class="fu">as.numeric</span>(US_GDP),</span>
<span id="cb3-456"><a href="#cb3-456" aria-hidden="true" tabindex="-1"></a>    <span class="at">AU_GDP =</span> <span class="fu">as.numeric</span>(AU_GDP)</span>
<span id="cb3-457"><a href="#cb3-457" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-458"><a href="#cb3-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-459"><a href="#cb3-459" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">left_join</span>(GDP_data, XCH_data, <span class="at">by =</span> <span class="st">'Time'</span>)</span>
<span id="cb3-460"><a href="#cb3-460" aria-hidden="true" tabindex="-1"></a>tmp<span class="sc">$</span>JP_GDP <span class="ot">=</span> tmp<span class="sc">$</span>JP_GDP<span class="sc">/</span>tmp<span class="sc">$</span>JP_XCH</span>
<span id="cb3-461"><a href="#cb3-461" aria-hidden="true" tabindex="-1"></a>tmp<span class="sc">$</span>CN_GDP <span class="ot">=</span> tmp<span class="sc">$</span>CN_GDP<span class="sc">/</span>tmp<span class="sc">$</span>CN_XCH</span>
<span id="cb3-462"><a href="#cb3-462" aria-hidden="true" tabindex="-1"></a>tmp<span class="sc">$</span>AU_GDP <span class="ot">=</span> tmp<span class="sc">$</span>AU_GDP<span class="sc">/</span>tmp<span class="sc">$</span>AU_XCH</span>
<span id="cb3-463"><a href="#cb3-463" aria-hidden="true" tabindex="-1"></a>tmp<span class="sc">$</span>US_GDP <span class="ot">=</span> tmp<span class="sc">$</span>US_GDP<span class="sc">/</span>tmp<span class="sc">$</span>US_XCH</span>
<span id="cb3-464"><a href="#cb3-464" aria-hidden="true" tabindex="-1"></a>GDP_data <span class="ot">=</span> tmp[<span class="fu">colnames</span>(GDP_data)[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>]]</span>
<span id="cb3-465"><a href="#cb3-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-466"><a href="#cb3-466" aria-hidden="true" tabindex="-1"></a>JP_GDP_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(GDP_data<span class="sc">$</span>JP_GDP, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">1994</span>, <span class="dv">1</span>), <span class="at">frequency=</span><span class="dv">4</span>)</span>
<span id="cb3-467"><a href="#cb3-467" aria-hidden="true" tabindex="-1"></a>CN_GDP_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(GDP_data<span class="sc">$</span>CN_GDP, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">1994</span>, <span class="dv">1</span>), <span class="at">frequency=</span><span class="dv">4</span>)</span>
<span id="cb3-468"><a href="#cb3-468" aria-hidden="true" tabindex="-1"></a>US_GDP_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(GDP_data<span class="sc">$</span>US_GDP, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">1994</span>, <span class="dv">1</span>), <span class="at">frequency=</span><span class="dv">4</span>)</span>
<span id="cb3-469"><a href="#cb3-469" aria-hidden="true" tabindex="-1"></a>AU_GDP_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(GDP_data<span class="sc">$</span>AU_GDP, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">1994</span>, <span class="dv">1</span>), <span class="at">frequency=</span><span class="dv">4</span>)</span>
<span id="cb3-470"><a href="#cb3-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-471"><a href="#cb3-471" aria-hidden="true" tabindex="-1"></a>adjust_series <span class="ot">&lt;-</span> <span class="cf">function</span>(series) {</span>
<span id="cb3-472"><a href="#cb3-472" aria-hidden="true" tabindex="-1"></a>  decomposed <span class="ot">&lt;-</span> <span class="fu">stl</span>(series, <span class="at">s.window=</span><span class="st">"periodic"</span>)</span>
<span id="cb3-473"><a href="#cb3-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seasadj</span>(decomposed)  <span class="co"># Return the seasonally adjusted series</span></span>
<span id="cb3-474"><a href="#cb3-474" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-475"><a href="#cb3-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-476"><a href="#cb3-476" aria-hidden="true" tabindex="-1"></a>JP_GDP_adj <span class="ot">&lt;-</span> <span class="fu">adjust_series</span>(JP_GDP_ts)</span>
<span id="cb3-477"><a href="#cb3-477" aria-hidden="true" tabindex="-1"></a>CN_GDP_adj <span class="ot">&lt;-</span> <span class="fu">adjust_series</span>(CN_GDP_ts)</span>
<span id="cb3-478"><a href="#cb3-478" aria-hidden="true" tabindex="-1"></a>US_GDP_adj <span class="ot">&lt;-</span> <span class="fu">adjust_series</span>(US_GDP_ts)</span>
<span id="cb3-479"><a href="#cb3-479" aria-hidden="true" tabindex="-1"></a>AU_GDP_adj <span class="ot">&lt;-</span> <span class="fu">adjust_series</span>(AU_GDP_ts)</span>
<span id="cb3-480"><a href="#cb3-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-481"><a href="#cb3-481" aria-hidden="true" tabindex="-1"></a>adjusted_GDP_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-482"><a href="#cb3-482" aria-hidden="true" tabindex="-1"></a>  <span class="at">Time =</span> <span class="fu">as.Date</span>(<span class="fu">time</span>(JP_GDP_adj), <span class="at">origin =</span> <span class="st">"1970-01-01"</span>),</span>
<span id="cb3-483"><a href="#cb3-483" aria-hidden="true" tabindex="-1"></a>  <span class="at">JP_GDP =</span> JP_GDP_adj,</span>
<span id="cb3-484"><a href="#cb3-484" aria-hidden="true" tabindex="-1"></a>  <span class="at">CN_GDP =</span> CN_GDP_adj,</span>
<span id="cb3-485"><a href="#cb3-485" aria-hidden="true" tabindex="-1"></a>  <span class="at">US_GDP =</span> US_GDP_adj,</span>
<span id="cb3-486"><a href="#cb3-486" aria-hidden="true" tabindex="-1"></a>  <span class="at">AU_GDP =</span> AU_GDP_adj</span>
<span id="cb3-487"><a href="#cb3-487" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-488"><a href="#cb3-488" aria-hidden="true" tabindex="-1"></a>adjusted_GDP_data<span class="sc">$</span>Time <span class="ot">=</span> <span class="fu">as.yearqtr</span>(adjusted_GDP_data<span class="sc">$</span>Time, <span class="at">format =</span> <span class="st">"%Y-Q%q"</span>)</span>
<span id="cb3-489"><a href="#cb3-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-490"><a href="#cb3-490" aria-hidden="true" tabindex="-1"></a>adjusted_GDP_data_long <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(adjusted_GDP_data,</span>
<span id="cb3-491"><a href="#cb3-491" aria-hidden="true" tabindex="-1"></a>                              <span class="at">cols =</span> <span class="fu">colnames</span>(adjusted_GDP_data)[<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb3-492"><a href="#cb3-492" aria-hidden="true" tabindex="-1"></a>                              <span class="at">names_to =</span> <span class="st">"Country"</span>,</span>
<span id="cb3-493"><a href="#cb3-493" aria-hidden="true" tabindex="-1"></a>                              <span class="at">values_to =</span> <span class="st">"GDP"</span>)</span>
<span id="cb3-494"><a href="#cb3-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-495"><a href="#cb3-495" aria-hidden="true" tabindex="-1"></a>GDP_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> adjusted_GDP_data_long, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> GDP, <span class="at">color =</span> Country)) <span class="sc">+</span></span>
<span id="cb3-496"><a href="#cb3-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb3-497"><a href="#cb3-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb3-498"><a href="#cb3-498" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CN_GDP"</span> <span class="ot">=</span> <span class="st">"#3498db"</span>,  <span class="co"># Blue</span></span>
<span id="cb3-499"><a href="#cb3-499" aria-hidden="true" tabindex="-1"></a>    <span class="st">"JP_GDP"</span> <span class="ot">=</span> <span class="st">"#e74c3c"</span>,  <span class="co"># Red</span></span>
<span id="cb3-500"><a href="#cb3-500" aria-hidden="true" tabindex="-1"></a>    <span class="st">"US_GDP"</span> <span class="ot">=</span> <span class="st">"#2ecc71"</span>,  <span class="co"># Green</span></span>
<span id="cb3-501"><a href="#cb3-501" aria-hidden="true" tabindex="-1"></a>    <span class="st">"AU_GDP"</span> <span class="ot">=</span> <span class="st">"#f39c12"</span>   <span class="co"># Orange</span></span>
<span id="cb3-502"><a href="#cb3-502" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb3-503"><a href="#cb3-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-504"><a href="#cb3-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"GDP"</span>, <span class="at">title =</span> <span class="st">"Seasonally Adjustd GDP Trends"</span>, <span class="at">color =</span> <span class="st">"Country"</span>) <span class="sc">+</span></span>
<span id="cb3-505"><a href="#cb3-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb3-506"><a href="#cb3-506" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),  <span class="co"># Removes the legend title for a cleaner look</span></span>
<span id="cb3-507"><a href="#cb3-507" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>       <span class="co"># Moves the legend to the bottom</span></span>
<span id="cb3-508"><a href="#cb3-508" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>final_df <span class="ot">=</span> <span class="fu">inner_join</span>(CPI_data, adjusted_GDP_data, <span class="at">by =</span> <span class="st">'Time'</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>final_df <span class="ot">=</span> <span class="fu">inner_join</span>(final_df, XCH_data, <span class="at">by =</span> <span class="st">'Time'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>final_df <span class="ot">=</span> final_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">'US_XCH'</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>final_df[<span class="fu">c</span>(<span class="st">'JP_GDP'</span>, <span class="st">'CN_GDP'</span>, <span class="st">'US_GDP'</span>, <span class="st">'AU_GDP'</span>)] <span class="ot">=</span> <span class="fu">log</span>(final_df[<span class="fu">c</span>(<span class="st">'JP_GDP'</span>, <span class="st">'CN_GDP'</span>, <span class="st">'US_GDP'</span>, <span class="st">'AU_GDP'</span>)])</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#final_df[,2:ncol(final_df)] = scale(final_df[,2:ncol(final_df)])</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="do">##############################################scaling data###############################</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Start time of analysis: '</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">min</span>(final_df<span class="sc">$</span>Time))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'End time of analysis: '</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">max</span>(final_df<span class="sc">$</span>Time))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-plots" class="level2">
<h2 class="anchored" data-anchor-id="data-plots">Data Plots</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span>   (XCH_plot) <span class="sc">/</span> (GDP_plot)<span class="sc">/</span> ( CPI_plot)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#layout &lt;-   (BOP_plot | XCH_plot) / (GDP_plot | FDI_plot) / (CPI_plot)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#FDI_original_plot | BOP_original_plot) / (XCH_original_plot | GDP_original_plot)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>layout</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="stationarity-check" class="level2">
<h2 class="anchored" data-anchor-id="stationarity-check">Stationarity Check</h2>
<p><strong>Stationary Tests</strong></p>
<p>This section employs the Augmented Dickey-Fuller test to examine the null hypothesis that a unit root is present in these time series. A lag order of 4 was chosen for the ADF test given our data’s quarterly frequency. The results indicate that most of the macroeconomic indicators possess a unit root and are not stationary, with a few exceptions. Specifically, we have enough evidence to reject the null hypothesis for the CPI series in China and the United States at a 5% significance level. Interestingly, Japan’s GDP series is found to be unit-root stationary at this significance level. This implies that Japan’s GDP exhibits a consistent mean and variance over time, contrasting with the general trend observed in other national GDP series. Japan’s GDP growth has been known to be stagnant for quite some years and it’s macroeconomic indicators may respond differently to economic shocks compared to its non-stationary counterparts</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("tseries")</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>perform_adf_test <span class="ot">&lt;-</span> <span class="cf">function</span>(series) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  adf_test <span class="ot">&lt;-</span> <span class="fu">adf.test</span>(series, <span class="at">alternative =</span> <span class="st">"stationary"</span>, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">statistic =</span> adf_test<span class="sc">$</span>statistic,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">lag.order =</span> <span class="fu">as.numeric</span>(adf_test<span class="sc">$</span>parameter),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">p.value =</span> adf_test<span class="sc">$</span>p.value</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sapply</span>(CPI_data[,<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], perform_adf_test)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>results_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(results), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(results_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Dickey-Fuller Statistic"</span>, <span class="st">"Lag Order"</span>, <span class="st">"P-value"</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>results_df<span class="sc">$</span>Country <span class="ot">&lt;-</span> <span class="fu">rownames</span>(results_df)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(results_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(results_df, <span class="at">caption =</span> <span class="st">"ADF Test Results for CPI Data by Country"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>ADF Test Results for CPI Data by Country</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Dickey-Fuller Statistic</th>
<th style="text-align: left;">Lag Order</th>
<th style="text-align: left;">P-value</th>
<th style="text-align: left;">Country</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-3.258408</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">0.08079872</td>
<td style="text-align: left;">JP_CPI</td>
</tr>
<tr class="even">
<td style="text-align: left;">-4.299916</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">0.01</td>
<td style="text-align: left;">CN_CPI</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-3.55799</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">0.0394958</td>
<td style="text-align: left;">US_CPI</td>
</tr>
<tr class="even">
<td style="text-align: left;">-3.333834</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">0.06822768</td>
<td style="text-align: left;">AU_CPI</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sapply</span>(XCH_data[<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(XCH_data),<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>)], perform_adf_test)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>results_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(results), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(results_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Dickey-Fuller Statistic"</span>, <span class="st">"Lag Order"</span>, <span class="st">"P-value"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>results_df<span class="sc">$</span>Country <span class="ot">&lt;-</span> <span class="fu">rownames</span>(results_df)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(results_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(results_df, <span class="at">caption =</span> <span class="st">"ADF Test Results for Exchange Rate (% change) Data by Country"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>ADF Test Results for Exchange Rate (% change) Data by Country</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Dickey-Fuller Statistic</th>
<th style="text-align: left;">Lag Order</th>
<th style="text-align: left;">P-value</th>
<th style="text-align: left;">Country</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-1.791111</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">0.6635047</td>
<td style="text-align: left;">JP_XCH</td>
</tr>
<tr class="even">
<td style="text-align: left;">-1.565957</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">0.7575635</td>
<td style="text-align: left;">CN_XCH</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-2.56175</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">0.3415666</td>
<td style="text-align: left;">AU_XCH</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">sapply</span>(adjusted_GDP_data[<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(adjusted_GDP_data),<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>], perform_adf_test)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>results_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(results), <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(results_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Dickey-Fuller Statistic"</span>, <span class="st">"Lag Order"</span>, <span class="st">"P-value"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>results_df<span class="sc">$</span>Country <span class="ot">&lt;-</span> <span class="fu">rownames</span>(results_df)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(results_df) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(results_df, <span class="at">caption =</span> <span class="st">"ADF Test Results for seasonally adjusted Data by Country"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>ADF Test Results for seasonally adjusted Data by Country</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Dickey-Fuller Statistic</th>
<th style="text-align: left;">Lag Order</th>
<th style="text-align: left;">P-value</th>
<th style="text-align: left;">Country</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">-3.499383</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">0.04535076</td>
<td style="text-align: left;">JP_GDP</td>
</tr>
<tr class="even">
<td style="text-align: left;">-2.472818</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">0.3802514</td>
<td style="text-align: left;">CN_GDP</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0.7030938</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">0.99</td>
<td style="text-align: left;">US_GDP</td>
</tr>
<tr class="even">
<td style="text-align: left;">-2.030497</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">0.5639204</td>
<td style="text-align: left;">AU_GDP</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The ACF plots of seasonally adjusted GDP data shows a strong autocorrelation at smaller lags and the autocorrelation decreases sharply as the lags increase. It is worth noting that the autocorrelations decreases much faster for Japan than for the other countries. Similar phenomenon is observed with exchange rates against the dollar for all three countries. It is worth noting that the autocorrelations for the Chinese series a more persistent than the others, possibly due to the fact that China has a managed floating exchange rate system, where the Chinese central banks sets a target exchange rate. The CPI data for all four countries shows generally low autocorrelation across lags, particularly beyond the first few periods. This suggests that CPI measurements are relatively independent from quarter to quarter. The alternating signs in the autocorrelation function (ACF) plot for Japan and US’s CPI data suggest possible seasonal effects, cyclical patterns or due to data collection methods.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(adjusted_GDP_data[,<span class="dv">2</span>],  <span class="at">main =</span> <span class="fu">colnames</span>(adjusted_GDP_data)[<span class="dv">2</span>])</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(adjusted_GDP_data[,<span class="dv">3</span>],  <span class="at">main =</span> <span class="fu">colnames</span>(adjusted_GDP_data)[<span class="dv">3</span>])</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(adjusted_GDP_data[,<span class="dv">4</span>],  <span class="at">main =</span> <span class="fu">colnames</span>(adjusted_GDP_data)[<span class="dv">4</span>])</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(adjusted_GDP_data[,<span class="dv">5</span>],  <span class="at">main =</span> <span class="fu">colnames</span>(adjusted_GDP_data)[<span class="dv">5</span>])</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(XCH_data[,<span class="dv">2</span>], <span class="at">main =</span> <span class="fu">colnames</span>(XCH_data)[<span class="dv">2</span>])</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(XCH_data[,<span class="dv">3</span>], <span class="at">main =</span> <span class="fu">colnames</span>(XCH_data)[<span class="dv">3</span>])</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.new</span>()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="fu">colnames</span>(XCH_data)[<span class="dv">4</span>], <span class="at">cex.main =</span> <span class="dv">1</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(XCH_data[,<span class="dv">5</span>], <span class="at">main =</span> <span class="fu">colnames</span>(XCH_data)[<span class="dv">5</span>])</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(CPI_data[,<span class="dv">2</span>], <span class="at">main =</span> <span class="fu">colnames</span>(CPI_data)[<span class="dv">2</span>])</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(CPI_data[,<span class="dv">3</span>], <span class="at">main =</span> <span class="fu">colnames</span>(CPI_data)[<span class="dv">3</span>])</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(CPI_data[,<span class="dv">4</span>], <span class="at">main =</span> <span class="fu">colnames</span>(CPI_data)[<span class="dv">4</span>])</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="fu">acf</span>(CPI_data[,<span class="dv">5</span>], <span class="at">main =</span> <span class="fu">colnames</span>(CPI_data)[<span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-model-and-hypothesis" class="level1">
<h1>3. The Model and Hypothesis</h1>
<p>We will employ four models to address our proposed problem. Firstly, we will use a standard Bayesian Vector Autoregressive (BVAR) model with independently and identically distributed innovations, as outlined in details in <span class="citation" data-cites="wozniakBsvarsBayesianEstimation2022">Woźniak (<a href="#ref-wozniakBsvarsBayesianEstimation2022" role="doc-biblioref">2022</a>)</span>. Additionally, we will investigate a large BVAR model with flexible error covariance structures, following the methodology proposed by <span class="citation" data-cites="Chan_2015">Chan (<a href="#ref-Chan_2015" role="doc-biblioref">2015</a>)</span>. Specifically, the second model will incorporate MA(1) Gaussian innovations to better account for potential model misspecifications such as omitted variable bias and to facilitate shrinkage in VAR coefficients. Our third model will be a BVAR incorporating common stochastic volatilities to allow for time varying distribution of volatility terms, which will be useful to handle the impact of specific events like the Covid-19 Global Pandemic. The final model will combine a common stochastic volatility frame work with MA(1) Gaussian innovations, offering a robust approach to volatility modelling.</p>
<section id="model-1-standard-bvarp-model" class="level2">
<h2 class="anchored" data-anchor-id="model-1-standard-bvarp-model">3.1 Model 1: Standard BVAR(p) Model</h2>
<section id="model-specification" class="level3">
<h3 class="anchored" data-anchor-id="model-specification">3.1.1 Model Specification</h3>
<p><span class="math display">\[ Y = XA+E\]</span> <span class="math display">\[E|X \sim \mathcal{MN}_{T \times N}(0_{T \times N},\Sigma_{N \times N}, I_T)\]</span> <span class="math display">\[
A = \begin{bmatrix}
\mu_0^T \\
A_1^T \\
\vdots \\
A_p^T
\end{bmatrix}
, \quad
Y = \begin{bmatrix}
y_1^T \\
y_2^T \\
\vdots \\
y_T^T
\end{bmatrix}
, \quad
x_t = \begin{bmatrix}
1 \\
y_{t-1}^T \\
\vdots \\
y_{t-p}^T
\end{bmatrix}
, \quad
X = \begin{bmatrix}
x_1^T \\
x_2^T \\
\vdots \\
x_T^T
\end{bmatrix}
, \quad
E = \begin{bmatrix}
e_1^T \\
e_2^T \\
\vdots \\
e_T^T
\end{bmatrix}
\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(T\)</span> is the number of time periods under consideration</li>
<li><span class="math inline">\(N\)</span> is the number of variables, in our case, N = 20</li>
<li><span class="math inline">\(P\)</span> is the number of lags</li>
<li><span class="math inline">\(Y\)</span> is a <span class="math inline">\(T \times N\)</span> matrix of variables of response variables we aim to model.</li>
<li><span class="math inline">\(A\)</span> is a <span class="math inline">\(K \times N\)</span> matrix of coefficients, <span class="math inline">\(K = (1+𝑝\times N)\)</span>.</li>
<li><span class="math inline">\(E\)</span> is a <span class="math inline">\(T \times N\)</span> matrix of the error terms</li>
<li><span class="math inline">\(X\)</span> is a <span class="math inline">\(T \times (1+𝑝\times N)\)</span> matrix of covariates</li>
<li><span class="math inline">\(\Sigma\)</span> is a <span class="math inline">\(N \times N\)</span> matrix representing the row-specific covariance matrix</li>
<li><span class="math inline">\(I_T\)</span> is a <span class="math inline">\(T \times T\)</span> identity matrix representing the column specific covariance matrix</li>
<li><span class="math inline">\(E|X\)</span> follows a matrix-variate normal distribution with mean <span class="math inline">\(0_{T \times N}\)</span>, row specific covariance matrix <span class="math inline">\(\Sigma_{N \times N}\)</span> and column specific covariance matrix <span class="math inline">\(I_T\)</span></li>
<li><span class="math inline">\(x_{t}^T = \left( \begin{array}{cccc}1  &amp; y_{t-1} &amp; y_{t-2} &amp; \cdots &amp; y_{t-p} \end{array} \right)\)</span></li>
</ul>
<p>In our specific application, the Y matrix is formulated as follows:</p>
<p><span class="math display">\[
Y = \begin{pmatrix}
    \text{CPI}_{\text{CN}, p+1} &amp; \text{XCH}_{\text{CN}, p+1} &amp; \log(\text{GDP})_{\text{CN}, p+1} &amp; \text{CPI}_{\text{US}, p+1} &amp; \log(\text{GDP})_{\text{US}, p+1} &amp; \text{CPI}_{\text{JP}, p+1} &amp; \text{XCH}_{\text{JP}, p+1} &amp; \log(\text{GDP})_{\text{JP}, p+1} &amp; \text{CPI}_{\text{AU}, p+1} &amp; \text{XCH}_{\text{AU}, p+1} &amp; \log(\text{GDP})_{\text{AU}, p+1} \\
    \text{CPI}_{\text{CN}, p+2} &amp; \text{XCH}_{\text{CN}, p+2} &amp; \log(\text{GDP})_{\text{CN}, p+2} &amp; \text{CPI}_{\text{US}, p+2} &amp; \log(\text{GDP})_{\text{US}, p+2} &amp; \text{CPI}_{\text{JP}, p+2} &amp; \text{XCH}_{\text{JP}, p+2} &amp; \log(\text{GDP})_{\text{JP}, p+2} &amp; \text{CPI}_{\text{AU}, p+2} &amp; \text{XCH}_{\text{AU}, p+2} &amp; \log(\text{GDP})_{\text{AU}, p+2} \\
    \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
    \text{CPI}_{\text{CN}, T} &amp; \text{XCH}_{\text{CN}, T} &amp; \log(\text{GDP})_{\text{CN}, T} &amp; \text{CPI}_{\text{US}, T} &amp; \log(\text{GDP})_{\text{US}, T} &amp; \text{CPI}_{\text{JP}, T} &amp; \text{XCH}_{\text{JP}, T} &amp; \log(\text{GDP})_{\text{JP}, T} &amp; \text{CPI}_{\text{AU}, T} &amp; \text{XCH}_{\text{AU}, T} &amp; \log(\text{GDP})_{\text{AU}, T}
\end{pmatrix}
\]</span></p>
<p>The Bayesian Vector Autoregression model as formulated above provides a robust framework for investigating the relationships among selected economic indicators across different nations. By employing this model, this research aims to quantitatively measure the influence of one country’s economic indicators on another, such as how lagged changes in China’s i consumer price index may influence the GDP growth rate of the United States and vice versa. The BVAR model, with its estimation of coefficients across various lags, offers a deep understanding of both immediate and more delayed economic interactions, which is crucial to analyzing the cyclical nature of trade relationships, investment flows, monetary policy environments, and economic performances and the transmission of these metrics across borders.</p>
<p>The strength of this BVAR model lies in its ability to incorporate prior economic knowledge and beliefs into the estimation process. By setting prior distributions for the matrix of coefficients A and the covariance matrix <span class="math inline">\(\Sigma\)</span>, the model can be tailors to reflect established economic theories regarding international economic linkages and the time it takes for policy changes in one country to affect another. By calibrating the prior variances, particularly for the autoregressive coefficients, we can integrate prior knowledge or hypotheses, such as the presence of unit roots or the diminishing influence of distant lags on current values, into the analysis. When interpreting the estimation output, attention will be given to the posterior means and variances of the coefficients, which represent the model’s “learnt” understanding of the underlying economic structure. The analysis will be supplemented by forecast error variance decompositions to better understand the proportion of the movements in economic indicators that can be accounted for by their own shocks versus shocks to other variables.</p>
<p>The economic context underscoring this analysis is the increased globalization over the past decade, marking an era where economies are more intertwined than ever through trade, capital flows, and policy decisions. This period has witnessed not only the strengthening of global economic ties but also recent calls from political leaders advocating for a reduction in globalization. These contrasting dynamics highlight the complexity of the current global economic landscape, where the push for deeper integration coexists with growing sentiments for retrenchment. This dual trend sets the stage for our investigation, providing a rich context to explore how economic variables across nations influence each other amidst fluctuating levels of global interconnectedness. In this environment, understanding the cross-country spillover effects is vital for policymakers and businesses alike, as decisions made in one country can have far-reaching implications. By addressing these aspects, this research will contribute to the discourse on economic policy formulation, risk assessment, and strategic planning.</p>
</section>
<section id="prior-settings" class="level3">
<h3 class="anchored" data-anchor-id="prior-settings">3.1.2 Prior Settings</h3>
<p>We will employ a Normal-Inverse Wishart distribution for the joint distribution of coefficient matrices A and the row-specific variance matrix <span class="math inline">\(\Sigma\)</span>, and a Minnesota prior on the coefficients A. Specifically, we have:</p>
<p><span class="math display">\[\Sigma \sim \mathcal{IW}(S_0, \nu_0) \]</span></p>
<p><span class="math display">\[p(\Sigma) \propto |\Sigma|^{-\frac{\nu_0+N+1}{2}}exp(-\frac{1}{2}tr(\Sigma^{-1}S_0))\]</span></p>
<p><span class="math display">\[A|\Sigma \sim \mathcal{MN}_{K \times N}(A_0, \Sigma, V_A)\]</span></p>
<p><span class="math display">\[p(A|\Sigma) \propto |\Sigma|^{-\frac{K}{2}}exp(-\frac{1}{2}tr(\Sigma^{-1}(A-A_0)^T(A-A_0)))\]</span></p>
<p><span class="math display">\[(A,\Sigma) \sim \mathcal{NIW}_{K \times N} (A_0, V_A, S_0, \nu_0)\]</span></p>
<p><span class="math display">\[p(A,\Sigma) \propto |\Sigma|^{-\frac{K+\nu_0+N+1}{2}} \times exp(-\frac{1}{2}tr(\Sigma^{-1}S_0))\times exp(-\frac{1}{2}tr(\Sigma^{-1}(A-A_0)^T(A-A_0)))\]</span></p>
<p>where</p>
<p><span class="math display">\[V_A = diag(\kappa_2 \quad \kappa_1(\mathbf{p} \otimes I_N^T))\]</span></p>
<p><span class="math display">\[\mathbf{p} = [1 \quad 2 \quad ... \quad p]\]</span> <span class="math display">\[I_N = [1 \quad 1 \quad ... \quad 1] \in \mathbb{R}^N\]</span> <span class="math display">\[\kappa_1 \text{ is the overall shrinkage level for autoregressive slopes}\]</span> <span class="math display">\[\kappa_2 \text{ is the overall shrinkage lvel for the constant term }\]</span></p>
<p>Additionally, we adopt commonly used values for the hyperparameters as established in the literature.</p>
<p><span class="math display">\[A_0 = 0\]</span></p>
<p><span class="math display">\[v_0 = N+3\]</span></p>
<p><span class="math display">\[S_0 = I_N\]</span></p>
<p><span class="math display">\[\kappa_1 = 0.2^2 \quad \kappa_2 = 10^2\]</span></p>
<p>The hyperparameters <span class="math inline">\(\kappa_1\)</span> and <span class="math inline">\(\kappa_2\)</span> are specified in a way such that the coefficient associated with a lag l variable is shrunk more heavily as lag length increases whereas the intercepts are not shrunk to 0.</p>
</section>
<section id="posterior-distributions" class="level3">
<h3 class="anchored" data-anchor-id="posterior-distributions">3.1.3 Posterior Distributions</h3>
<p>The posterior distribution specified above has the form</p>
<p><span class="math display">\[p(Y|A, \Sigma) = (2\pi)^{-\frac{TN}{2}}|\Sigma|^{-\frac{T}{2}}exp(-\frac{1}{2}tr(\Sigma^{-1}(Y-XA)^T(Y-XA))\]</span></p>
<p>and the joint posterior distribution</p>
<p><span class="math display">\[p(A, \Sigma \mid Y)  = \frac{p(A,\Sigma,Y)}{p(Y)}\propto p(A, \Sigma, Y) \propto p(Y|A,\Sigma)\times p(A,\Sigma) =  p(Y|A,\Sigma) p(A \mid \Sigma) p(\Sigma)\]</span></p>
<p><span class="math display">\[\propto |\Sigma|^{-\frac{T}{2}}exp(-\frac{1}{2}tr(\Sigma^{-1}(Y-XA)^T(Y-XA))) \times\]</span></p>
<p><span class="math display">\[\mid \Sigma \mid^{-\frac{\nu_0+N+K}{2}}exp(-\frac{1}{2}tr(\Sigma^{-1}S_o))exp(-\frac{1}{2}tr(\Sigma^{-1}(A-A_0)^TV_A^{-1}(A-A_0))\]</span></p>
<p><span class="math display">\[\propto |\Sigma|^{-\frac{T+N+K+\nu_0+1}{2}} \times \exp (-\frac{1}{2}tr(\Sigma^{-1}S_0)) \times \]</span></p>
<p><span class="math display">\[exp(-\frac{1}{2}tr(\Sigma^{-1}(A_0^TV_a^{-1}A_0+Y^TY-\bar{A}^T\bar{V}^{-1}\bar{A})\times\]</span> <span class="math display">\[exp(-\frac{1}{2}tr(\Sigma^{-1}(A-\bar{A})^T\bar{V}^{-1}(A-\bar{A})))\]</span> Hence,</p>
<p><span class="math display">\[p(A, \Sigma \mid Y, X) = p(A \mid Y, X, \Sigma) p(\Sigma \mid Y, X)\]</span></p>
<p><span class="math display">\[p(A \mid Y, X, \Sigma) = \mathcal{MN}_{k \times N}(\bar{A}, \Sigma, \bar{V})\]</span></p>
<p><span class="math display">\[p(\Sigma \mid Y, X) = \mathcal{IW}_N(\bar{S}, \bar{\nu})\]</span></p>
<p>where</p>
<p><span class="math display">\[\bar{V} = (X^TX + V_A^{-1})^{-1}\]</span></p>
<p><span class="math display">\[\bar{A} = \bar{V}(X^TY + V_A^{-1}A_0)\]</span></p>
<p><span class="math display">\[\bar{\nu} = T + \nu_0\]</span></p>
<p><span class="math display">\[\bar{S} = S_0 + Y^TY + A_0^TV_A^{-1}A_0 - \bar{A}^T\bar{V}^{-1}\bar{A}\]</span></p>
</section>
<section id="estimation-procedure" class="level3">
<h3 class="anchored" data-anchor-id="estimation-procedure">3.1.4 Estimation Procedure</h3>
<p>In this setting, we have</p>
<ul>
<li><span class="math inline">\((A,\Sigma) \sim \mathcal{NIW}_{K \times N} (A_0, V_A, S_0, \nu_0)\)</span></li>
</ul>
<p>then, prior draws can be sampled from</p>
<ul>
<li><span class="math inline">\(\Sigma \sim \mathcal{IW}(S_0, \nu_0)\)</span></li>
<li><span class="math inline">\(A|\Sigma \sim \mathcal{MN}_{K \times N}(A_0, \Sigma, V_A)\)</span></li>
</ul>
<p>we use the following Gibb’s Sampler algorithm to sample from the posterior distribution:</p>
<ul>
<li>Initialize <span class="math inline">\(\Sigma\)</span> at <span class="math inline">\(\Sigma^0\)</span></li>
<li>For <span class="math inline">\(s = 1,...,S_1+S_2\)</span>
<ol type="1">
<li>Draw a sample <span class="math inline">\(A^{(s)}\)</span> from <span class="math inline">\(p(A \mid Y, X, \Sigma^{(s-1)}) \sim \mathcal{MN}_{K \times N}(\bar{A}, \Sigma, \bar{V})\)</span></li>
<li>Draw a sample <span class="math inline">\(\Sigma^{(s)}\)</span> from <span class="math inline">\(p(\Sigma \mid Y, X, A^{(s)}) = \mathcal{IW}_N(\bar{S}, \bar{\nu})\)</span></li>
</ol></li>
</ul>
<p>We discard the first <span class="math inline">\(S_1\)</span> sample draws to allow the algorithm to converge to the stationary posterior distributiion to obtain <span class="math inline">\(S_2\)</span> sampled draws from the joint posterior distribution.</p>
<p><span class="math display">\[\left\{A^{(s)}, \Sigma^{(s)}\right\}_{s=S_1+1}^{S_1+S_2}\]</span></p>
<p>The draws from joint predictive density can then be obtained using the following algorithm:</p>
<ol type="1">
<li>Sample S draws <span class="math inline">\(\left\{ A^{(s)}, \Sigma^{(s)} \right\}_{s=1}^{S}\)</span> from <span class="math inline">\(p(A,\Sigma|Y, X)\)</span></li>
<li>Sample S draws <span class="math inline">\(\left\{ Y_{t+h}^{(s)} \right\}_{s=1}^S\)</span> from <span class="math inline">\(Y_{t+h}^{(s)} \sim \mathcal{N}_{hN}(Y_{t+h|t}(A^{(s)}), \mathbb{V}ar[Y_{t+h|t}|A^{(s)}, \Sigma^{(s)}])\)</span></li>
</ol>
<p>where</p>
<p><span class="math display">\[\underset{\text{hN} \times1}{Y_{t+h}} = \begin{pmatrix}
    Y_{t+1} \\
    Y_{t+2} \\
    \vdots    \\
    Y_{t+h}
\end{pmatrix}\]</span></p>
<p>To derive the posterior predictive density for <span class="math inline">\(Y_{t+h}\)</span>, we first note that:</p>
<p><span class="math display">\[p(Y_{t+h}|Y_{t}) = \int \int p(Y_{t+h}|Y_{t},A, \Sigma)\times p(A,\Sigma|Y,X)dAd\Sigma\]</span> where</p>
<p><span class="math display">\[p(y_{t+h}|Y, X, A, \Sigma, I_T) \sim \mathcal{N}_{hN} (Y_{t+h|t}(A), Var(Y_{t+h}|A, \Sigma))\]</span></p>
<p><span class="math display">\[Y_{t+h|t}(A) =\begin{pmatrix}
    Y_{t+1|t} \\
    Y_{t+2|t} \\
    \vdots    \\
    Y_{t+h|t}
\end{pmatrix} = \begin{pmatrix}  
\mu_0 + A_1 Y_t + \cdots + A_pY_{t-p+1|t} \\
\mu_0 + A_1 Y_{t+1|t} + \cdots + A_p Y_{t-p+2|t}\\
\vdots \\
\mu_0 + A_1 Y_{t+h-1|t} + \cdots + A_p Y_{t+h-p|t}
\end{pmatrix}\]</span></p>
<p><span class="math display">\[\underset{\text{(hN)} \times \text{(hN)}}{\mathbb{V}ar(Y_{t+h|t}|A, \Sigma)} = \begin{pmatrix}
    \Sigma &amp; \Sigma \phi_1^T &amp; \cdots &amp; \Sigma \phi_{h-1}^T \\
    \phi_1\Sigma &amp;\Sigma + \phi_1 \Sigma \phi_1^T  &amp; \cdots &amp; \Sigma \phi_1^T + \phi_1 \Sigma \phi_2^T+ \cdots + \phi_{h-2}\Sigma \phi_{h-1}^T + \phi_{h-1} \Sigma \phi_{h}^T \\
    \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
    \phi_{h-1}\Sigma\ &amp; \phi_1\Sigma  + \phi_2 \Sigma \Phi_1^T + \cdots + \phi_{h} \Sigma \phi_{h-1}^T &amp; \cdots &amp; \Sigma + \phi_1 \Sigma \phi_1^T + \cdots+\phi_{h-2}\Sigma\phi_{h-2}^T+\phi_{h-1}\Sigma\phi_{h-1}^T
\end{pmatrix}
\]</span></p>
<p>where <span class="math inline">\(\phi_i = J A^i J'\)</span> are the parameters of the VMA(<span class="math inline">\(\infty\)</span>) representation of VAR(<span class="math inline">\(p\)</span>) and <span class="math inline">\(A\)</span> is the parameter matrix of <span class="math inline">\(VAR(1)\)</span> representation of VAR(<span class="math inline">\(p\)</span>). <span class="math inline">\(A^i\)</span> is the matrix <span class="math inline">\(A\)</span> raised to the power of <span class="math inline">\(i\)</span>. <span class="math display">\[
\underset{Np \times Np}{A} =
\begin{pmatrix} A_1 &amp; A_2 &amp; \cdots &amp; A_{p-1} &amp; A_p \\
I_N &amp; 0_{N \times N} &amp; \cdots &amp; 0_{N \times N} &amp; 0_{N \times N}  \\
0 &amp; I_N  &amp; \cdots &amp; 0 &amp; 0 \\ \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\
0 &amp; 0 &amp; \cdots &amp; I_N &amp; 0 \end{pmatrix}
\qquad
\underset{\text{N} \times \text{Np}}{J} = [I_N \quad 0_{N \times N(p-1)}]
\]</span> <span class="math display">\[p(A|Y, X, \Sigma) \sim \mathcal{MN}_{K \times N}(\bar{A}, \Sigma, \bar{V})\]</span> <span class="math display">\[p(\Sigma \mid Y, X) = \mathcal{IW}_N(\bar{S}, \bar{\nu})\]</span> as before. In this approach, we are incorporating into our prediction the uncertainties in the estimates of the parameters by integrating over <span class="math inline">\(A\)</span> and <span class="math inline">\(\Sigma\)</span>.</p>
</section>
<section id="test-for-granger-causality" class="level3">
<h3 class="anchored" data-anchor-id="test-for-granger-causality">3.1.5 Test for Granger Causality</h3>
<p>Granger causality testing, introduced in <span class="citation" data-cites="Granger_1969">Granger (<a href="#ref-Granger_1969" role="doc-biblioref">1969</a>)</span>, is a way to measure whether the past and current values of one time series contains useful information for predicting future values of another. The idea behind granger causality testing is that if a time series does contain predictive information about another, incorporating it into the model should reduce the error variance and improve the precision of the forecasts. The classical approach for testing causality is the Wald test, but it fails to quantify the degree of evidence in the data in favour of or against the causality hypothesis. The Bayesian approach to testing Granger causality based on Baye’s factor, on the other hand, has the ability to quantify the evidence for and against the hypothesis with a single number. The Baye’s factor is defined as:</p>
<p><span class="math display">\[B_H = \frac{p[H_0|Y]}{p[H_1|Y]}\]</span> In the context of testing for VAR(p) models, we have the marginal likelihood under the assumption of no Granger causality is:</p>
<p><span class="math display">\[p_0(Y) = \int p_1(Y| A_{ij} = 0, A_{-(ij)})dA_{-(ij)} = p_1(Y|A_{ij}=0)\]</span> using Baye’s rule, we have: <span class="math display">\[p_0(Y) = \frac{p_1(A_{ij} = 0|Y) \times p_1(Y)}{p_1(A_{ij} = 0)}\]</span> We divide the above equation by <span class="math inline">\(p(y_t|H_1)\)</span> to get Baye’s factor:</p>
<p><span class="math display">\[B_H = \frac{p_0(Y)}{p_1(Y)} = \frac{p_1(A_{ij} = 0|Y)}{p_1(A_{ij} = 0)}=\frac{\int p_1(A_{ij=0}|Y, \Sigma)d \Sigma}{\int p(A_{ij}=0, \Sigma)d\Sigma}\]</span></p>
<p>and the integration is performed using numerical integration methods. The second part is also known as the Savage-Dickey density ratio estimator, which is the ratio of the posterior over the prior density evaluated at <span class="math inline">\(A_{ij} = 0\)</span>. Indicative values for interpreting Bayes factors is provided below:</p>
<p>To test for Granger causality, we use the equation: <span class="math display">\[B_H = \frac{p_1(A_{ij} = 0|Y)}{p(A_{ij}=0)} \]</span> A value much greater than 1 would indicate that the posterior distribution has a higher probability density at <span class="math inline">\(A_{ij} = 0\)</span> than the prior, hence the data provides evidence for the null hypothesis that <span class="math inline">\(A_{ij} = 0\)</span>. Conversely, a value much smaller than 1 would suggest that the data provides evidence against the null hypothesis.</p>
</section>
</section>
<section id="model-2-large-bvar-model-with-ma1-gaussian-innovations" class="level2">
<h2 class="anchored" data-anchor-id="model-2-large-bvar-model-with-ma1-gaussian-innovations">3.2 Model 2: Large BVAR model with MA(1) Gaussian Innovations</h2>
<p>Incorporating MA(1) Gaussian innovations in a large BVARs model can lead to a significant enhancement over traditional BVAR models, especially when forecasting macroeconomic variables, for several reasons. By allowing for serial correlation in the innovations term, we will be able to capture the momentum or persistence in economic variables that is often observed in real-world data. Recognizing that shocks may have a lasting impact over several periods can enhance the model’s ability to predict future values by considering the path-dependent nature of the economy. In addition, our BVAR model with common stochastic volatility is a natural extension to the standard BVAR model and formulated as below:</p>
<section id="model-specification-1" class="level3">
<h3 class="anchored" data-anchor-id="model-specification-1">3.2.1 Model Specification</h3>
<p><span class="math display">\[ Y = XA+E\]</span> <span class="math display">\[E|X \sim \mathcal{MN}_{T \times N}(0_{T \times N},\Sigma_{N \times N}, \Omega_{T \times T})\]</span> <span class="math display">\[
A = \begin{bmatrix}
\mu_0^T \\
A_1^T \\
\vdots \\
A_p^T
\end{bmatrix}
, \quad
Y = \begin{bmatrix}
y_1^T \\
y_2^T \\
\vdots \\
y_T^T
\end{bmatrix}
, \quad
x_t = \begin{bmatrix}
1 \\
y_{t-1}^T \\
\vdots \\
y_{t-p}^T
\end{bmatrix}
, \quad
X = \begin{bmatrix}
x_1^T \\
x_2^T \\
\vdots \\
x_T^T
\end{bmatrix}
, \quad
E = \begin{bmatrix}
e_1^T \\
e_2^T \\
\vdots \\
e_T^T
\end{bmatrix}
\]</span></p>
<p>where</p>
<ul>
<li><span class="math inline">\(T\)</span> is the number of time periods under consideration</li>
<li><span class="math inline">\(N\)</span> is the number of variables, in our case, N = 20</li>
<li><span class="math inline">\(P\)</span> is the number of lags</li>
<li><span class="math inline">\(Y\)</span> is a <span class="math inline">\(T \times N\)</span> matrix of variables of response variables we aim to model.</li>
<li><span class="math inline">\(A\)</span> is a <span class="math inline">\(K \times N\)</span> matrix of coefficients, <span class="math inline">\(K = (1+𝑝\times N)\)</span>.</li>
<li><span class="math inline">\(E\)</span> is a <span class="math inline">\(T \times N\)</span> matrix of the error terms</li>
<li><span class="math inline">\(X\)</span> is a <span class="math inline">\(T \times (1+𝑝\times N)\)</span> matrix of covariates</li>
<li><span class="math inline">\(\Sigma\)</span> is a <span class="math inline">\(N \times N\)</span> matrix representing the row-specific covariance matrix</li>
<li><span class="math inline">\(\Omega\)</span> is a <span class="math inline">\(T \times T\)</span> identity matrix representing the column specific covariance matrix</li>
<li><span class="math inline">\(E|X\)</span> follows a matrix-variate normal distribution with mean <span class="math inline">\(0_{T \times N}\)</span>, row specific covariance matrix <span class="math inline">\(\Sigma_{N \times N}\)</span> and column specific covariance matrix <span class="math inline">\(I_T\)</span></li>
</ul>
<p>with MA(1) innovations, we have, for i = 1,….,N and t = 1,…,T, <span class="math display">\[e_{t, i} = \eta_{t, i} + \psi \eta_{t-1, i}\]</span> where <span class="math inline">\(|\psi|&lt;1\)</span> and <span class="math inline">\(\eta_{t,i} \sim \mathcal{N}(0,1)\)</span></p>
<p>In matrix notation, we have:</p>
<p><span class="math display">\[e_i = H_{\psi} \eta_i\]</span></p>
<p>where</p>
<p><span class="math display">\[
e_i = \begin{bmatrix}
e_{1, i} \\
e_{2, i} \\
\vdots \\
e_{T, i}
\end{bmatrix} \qquad
\eta_i = \begin{bmatrix}
\eta_{1, i} \\
\eta_{2, i} \\
\vdots \\
\eta_{T, i}
\end{bmatrix} \qquad
H_{\psi} = \left(
\begin{array}{cccc}
1 &amp; 0  &amp; \cdots &amp; 0 \\
\psi &amp; 1  &amp; \cdots &amp; 0 \\
\vdots &amp; \ddots &amp; \ddots &amp; \vdots \\
0 &amp; \cdots &amp; \psi &amp; 1
\end{array}
\right) \qquad
O_{\psi} = diag(1+\psi^2, 1, ..., 1)
\]</span></p>
<p>Hence, we have</p>
<p><span class="math display">\[E \sim \mathcal{N}(0, H_{\psi}O_{\psi}H_{\psi}^T) \qquad \qquad \Omega = H_{\psi}O_{\psi}H_{\psi}^T\]</span> Note that the covariance matrix <span class="math inline">\(\Omega\)</span> depends on <span class="math inline">\(\psi\)</span> only.</p>
</section>
<section id="prior-specification" class="level3">
<h3 class="anchored" data-anchor-id="prior-specification">3.2.2 Prior Specification</h3>
<p>We consider a prior independent distributions for <span class="math inline">\((A, \Sigma, \Omega)\)</span>, specifically, we have: <span class="math display">\[P(A, \Sigma, \Omega) = P(A, \Sigma) \times P(\Omega)\]</span></p>
<p>We will employ a Normal-Inverse Wishart distribution for the joint distribution of A and <span class="math inline">\(\Sigma\)</span> and before, <span class="math display">\[(A,\Sigma) \sim \mathcal{NIW}_{K \times N}(A_0, V_A, S_0, \nu_0)\]</span></p>
<p>We apply a truncated normal prior on <span class="math inline">\(\psi\)</span>, <span class="math display">\[\psi \sim \mathcal{N}(\psi_0, V_{\psi})\mathbb{1}_{\{|\psi|&lt;1\}}\]</span></p>
<p>For estimation purposes, we initialize with the following setting:</p>
<ul>
<li><span class="math inline">\(e_{i1} \sim \mathcal{N}(0, 1+\psi^2)\)</span></li>
<li><span class="math inline">\(\psi_0 = 0\)</span> and <span class="math inline">\(V_{\psi} = 1\)</span> so that the prior centers around 0 with a relatively large variance and has support within (-1, 1)</li>
</ul>
</section>
<section id="posterior-distributions-1" class="level3">
<h3 class="anchored" data-anchor-id="posterior-distributions-1">3.2.3 Posterior Distributions</h3>
<ol type="1">
<li>The posterior distribution of Y specified above has the form:</li>
</ol>
<p><span class="math display">\[p(Y|A, \Sigma) = (2\pi)^{-\frac{Tn}{2}}|\Sigma|^{-\frac{T}{2}}|\Omega|^{-\frac{N}{2}}exp(-\frac{1}{2}tr(\Sigma^{-1}(Y-XA)^T\Omega^{-1}(Y-XA))\]</span></p>
<p><span class="math display">\[= (2\pi)^{-\frac{Tn}{2}}|\Sigma|^{-\frac{T}{2}}(1+\psi^2)^{-\frac{N}{2}}exp(-\frac{1}{2}tr(\Sigma^{-1}(Y-XA)^T(H_{\psi}O_{\psi}H_{\psi}^T)^{-1}(Y-XA))\]</span></p>
<ol start="2" type="1">
<li>The joint posterior distribution of A and <span class="math inline">\(\Sigma\)</span> can be derived as follows:</li>
</ol>
<p><span class="math display">\[p(A, \Sigma \mid Y, \Omega)  = \frac{p(A,\Sigma,Y, \Omega)}{p(Y, \Omega)}\]</span> <span class="math display">\[\propto p(A, \Sigma, Y, \Omega) \propto p(Y \mid A,\Sigma, \Omega)\times p(A,\Sigma, \Omega)\]</span> <span class="math display">\[=  p(Y \mid A,\Sigma, \Omega) p(A, \Sigma) p(\Omega) = p(Y \mid A,\Sigma, \Omega) p(A \mid \Sigma) p(\Sigma) p(\Omega)\]</span></p>
<p><span class="math display">\[\propto p(Y \mid A,\Sigma, \Omega) p(A \mid \Sigma) p(\Sigma)\]</span></p>
<p><span class="math display">\[\propto |\Sigma|^{-\frac{T}{2}}exp(-\frac{1}{2}tr(\Sigma^{-1}(Y-XA)^T\Omega^{-1}(Y-XA)) \times\]</span></p>
<p><span class="math display">\[\mid \Sigma \mid^{-\frac{\nu_0+N+K}{2}}exp(-\frac{1}{2}tr(\Sigma^{-1}S_o))exp(-\frac{1}{2}tr(\Sigma^{-1}(A-A_0)^TV_A^{-1}(A-A_0))\]</span></p>
<p><span class="math display">\[\propto |\Sigma|^{-\frac{T+N+K+\nu_0+1}{2}} \times \exp (-\frac{1}{2}tr(\Sigma^{-1}S_0)) \times \]</span> <span class="math display">\[exp(-\frac{1}{2}tr(\Sigma^{-1}(A_0^TV_a^{-1}A_0+Y^T\Omega^{-1}Y-\bar{A}^T\bar{V}^{-1}\bar{A})\times\]</span> <span class="math display">\[exp(-\frac{1}{2}tr(\Sigma^{-1}(A-\bar{A})^T\bar{V}^{-1}(A-\bar{A})))\]</span></p>
<p>Hence,</p>
<p><span class="math display">\[p(A, \Sigma \mid Y, X) = p(A \mid Y, X, \Sigma, \Omega) p(\Sigma \mid Y, X, \Omega)\]</span></p>
<p><span class="math display">\[p(A \mid Y, X, \Sigma, \Omega) = \mathcal{MN}_{K \times N}(\bar{A}, \Sigma, \bar{V})\]</span></p>
<p><span class="math display">\[p(\Sigma \mid Y, X, \Omega) = \mathcal{IW}_N(\bar{S}, \bar{\nu})\]</span></p>
<p>where</p>
<p><span class="math display">\[\bar{V} = (X^T\Omega^{-1}X + V_A^{-1})^{-1}\]</span></p>
<p><span class="math display">\[\bar{A} = \bar{V}(X^T\Omega^{-1}Y + V_A^{-1}A_0)\]</span></p>
<p><span class="math display">\[\bar{\nu} = T + \nu_0\]</span></p>
<p><span class="math display">\[\bar{S} = S_0 + Y^T\Omega^{-1}Y + A_0^TV_A^{-1}A_0 - \bar{A}^T\bar{V}^{-1}\bar{A}\]</span> 3. The posterior distribution for the parameter <span class="math inline">\(\psi\)</span> can be obtained as follows: <span class="math display">\[P(\psi|Y, A, \Sigma) = \frac{P(\psi, Y, A, \Sigma)}{P(Y, A, \Sigma)} \propto P(\psi, Y, A, \Sigma) = P(Y|A, \Sigma, \psi) \times P(A,\Sigma, \psi) \]</span></p>
<p><span class="math display">\[= P(Y|A, \Sigma, \psi) \times P(A, \Sigma) \times P(\psi) \propto P(Y|A, \Sigma, \psi) \times P(\psi)\]</span></p>
<p>we can sample from the posterior distribution of <span class="math inline">\(\psi\)</span> using an independence-chain Metropolis-Hastings algorithm.</p>
</section>
<section id="estimation-procedure-1" class="level3">
<h3 class="anchored" data-anchor-id="estimation-procedure-1">3.2.4 Estimation Procedure</h3>
<p>We obtain posterior estimates of <span class="math inline">\(A, \Sigma, \psi\)</span> using a Gibbs sampler, specifically, we initialize <span class="math inline">\(\psi^{(0)}\)</span> and for s = 1,…,S1+S2, we sequentially sample:</p>
<ul>
<li><span class="math inline">\(\Sigma^{(s)} | Y, X, \psi^{(s-1)} \sim \mathcal{IW}_N(\bar{S}, \bar{\nu})\)</span></li>
<li><span class="math inline">\(A^{(s)} | Y, X, \Sigma^{(s)}, \psi^{(s-1)} \sim \mathcal{MN}_{k \times N}(\bar{A}, \Sigma^{(s)}, \bar{V})\)</span></li>
<li><span class="math inline">\(\psi^{(s)} | Y, X, A^{(s)}, \Sigma^{(s)} \propto P(Y|A^{(s)}, \Sigma^{(s)}, \psi^{s-1})\times p(\psi)\)</span></li>
</ul>
<p>The Metropolis-Hastings Algorithm for Sampling <span class="math inline">\(\psi\)</span> is given as follows:</p>
<p><strong>Initialization:</strong></p>
<ul>
<li>Choose an initial value <span class="math inline">\(\psi^{(0)}\)</span> within the bounds <span class="math inline">\((-1, 1)\)</span>.</li>
</ul>
<p><strong>Proposal Distribution:</strong></p>
<ul>
<li>Select the proposal distribution <span class="math inline">\(q(\psi' | \psi^{(t)}) \sim N(\psi^{(t)}, \tau^2)\mathcal{I}(\psi'\in(-1,1))\)</span>. <span class="math inline">\(\tau^2\)</span> is a tuning parameter that controls the step size.</li>
</ul>
<p><strong>Sampling Loop:</strong></p>
<p>For t = 1,…,<span class="math inline">\(T_1+T_2\)</span></p>
<ul>
<li><p>Generate a candidate <span class="math inline">\(\psi'^{(t)}\)</span> from <span class="math inline">\(q(\psi' | \psi^{(t-1)})\)</span>.</p></li>
<li><p>Check if <span class="math inline">\(\psi'\)</span> is within the bounds <span class="math inline">\((-1, 1)\)</span>. If not, reject <span class="math inline">\(\psi'\)</span> (set <span class="math inline">\(\alpha = 0\)</span>).</p></li>
<li><p>Compute the acceptance ratio <span class="math inline">\(\alpha\)</span>: <span class="math display">\[ \alpha(\psi^{(t-1)}, \psi') = \min\left(1, \frac{p(Y | A, \Sigma, \psi') p(\psi') q(\psi^{(t-1)} | \psi')}{p(Y | A, \Sigma, \psi^{(t-1)}) p(\psi^{(t-1)}) q(\psi' | \psi^{(t-1)})}\right)\]</span></p></li>
</ul>
<p><strong>Decide to accept or reject:</strong></p>
<ul>
<li><p>Generate a random number <span class="math inline">\(u\)</span> from <span class="math inline">\(U[0,1]\)</span>.</p></li>
<li><p>If <span class="math inline">\(u \leq \alpha\)</span>, accept <span class="math inline">\(\psi'\)</span> and set <span class="math inline">\(\psi^{(t)} = \psi'\)</span>.</p></li>
<li><p>Otherwise, reject <span class="math inline">\(\psi'\)</span> and set <span class="math inline">\(\psi^{(t)} = \psi^{(t-1)}\)</span>.</p></li>
</ul>
<p><strong>Burn in period</strong></p>
<ul>
<li>Discard the first <span class="math inline">\(T_1\)</span> samples to allow the algorithm to converge to the true distribution</li>
</ul>
<p><strong>Obtain one sample of <span class="math inline">\(\psi\)</span></strong></p>
<ul>
<li>Randomly draw a <span class="math inline">\(\psi^*\)</span> from the <span class="math inline">\(T_2\)</span> draws and set <span class="math inline">\(\psi^{(s)} = \psi^*\)</span></li>
</ul>
<p>When combined with Gibbs sampling for the estimation of <span class="math inline">\(A\)</span> and <span class="math inline">\(\Sigma\)</span>, the Metropolis-Hastings step can be embedded into the Gibbs sampler, a method known as Metropolis-within-Gibbs sampling. In this approach, one sample from the Metropolis-Hastings step is generated per Gibbs iteration. Detailed proofs and explanations on the convergence properties and efficiency of the Metropolis-within-Gibbs sampling method are provided in <span class="citation" data-cites="Chib1995">Chib and Greenberg (<a href="#ref-Chib1995" role="doc-biblioref">1995</a>)</span>.</p>
<p>We monitor the acceptance rate and adjust <span class="math inline">\(\tau^2\)</span> as necessary to achieve an optimal rate of about 20-40%.</p>
<p>We note that since <span class="math inline">\(\Omega\)</span> is a band matrix, which means we do not need compute <span class="math inline">\(\Omega^{-1}\)</span>. Instead, we obtain the Cholesky decomposition <span class="math inline">\(C_{\Omega}\)</span> of <span class="math inline">\(\Omega\)</span>, which has a time complexity of <span class="math inline">\(O(T)\)</span> instead of <span class="math inline">\(O(T^3)\)</span>. Terms involving <span class="math inline">\(\Omega^{-1}\)</span> such as <span class="math inline">\(X^T\Omega^{-1}X\)</span> can be obtained by: <span class="math display">\[X^T\Omega^{-1}X = X^T(C_{\Omega}^{-1})^{T}C_{\Omega}^{-1}X=(C_{\Omega}^{-1}X)^T(C_{\Omega}^{-1}X) = \tilde{X}^T\tilde{X}\]</span></p>
<p>To make forecasts of the <span class="math inline">\(Y\)</span>, we make the following observations: <em>One-period ahead forecast</em> <span class="math display">\[y_{t+1} = \mu_0 + A_1y_t + \cdots + A_py_{t-p+1} +  e_{t+1}\]</span> <span class="math display">\[E(y_{t+1}) = E(\mu_0 + A_1y_t + \cdots + A_py_{t-p+1} +  e_{t+1}) = \mu_0 + A_1y_t + \cdots + A_py_{t-p+1}\]</span> The one-period ahead forecast error is: <span class="math display">\[e_{t+1|t} = y_{t+1} - y_{t+1|t} = e_{t+1}\]</span> The one period ahead forecast variance is: <span class="math display">\[\mathbb{V}ar(e_{t+1}|t) = \mathbb{E}[\mathbb{E}_t(e_{t+1}e_{t+1}^T)] = \Sigma\]</span> <em>Two-period ahead forecast</em> <span class="math display">\[y_{t+2} = \mu_0 + A_1y_{t+1} + \cdots + A_py_{t-p+2} +  e_{t+2}\]</span> <span class="math display">\[E(y_{t+2}) = E(\mu_0 + A_1y_{t+1} + \cdots + A_py_{t-p+2} +  e_{t+2}) = \mu_0 + A_1y_{t+1|t} + \cdots + A_py_{t-p+2}\]</span> The two-period ahead forecast error is: <span class="math display">\[e_{t+2|t} = y_{t+2}-y_{t+2|t} = e_{t+2} + A_1(y_{t+1} - y_{t+1|t}) = e_{t+2} + A_1e_{t+1}\]</span> <span class="math display">\[Var(e_{t+2|t}) = E[e_{t+2|t}e_{t+2|t}^T] = E((e_{t+2} + A_1e_{t+1})(e_{t+2} + A_1e_{t+1})^T) = E((e_{t+2}e_{t+2}^T + A_1e_{t+1}e_{t+2}^T+e_{t+2}e_{t+1}^TA_1^T+A_1e_{t+1}e_{t+1}^TA_1^T)\]</span> <span class="math display">\[ = \Sigma + A_i\Psi+ \Psi A_1^T + A_1\Sigma A_1^T\]</span> since in the MA(1) innovations setup, we have:</p>
<p><span class="math display">\[\mathbb{V}ar(e_{t+2} e_{t+1}^T) = E \left[
\begin{pmatrix}
e_{t+2, 1} \\
e_{t+2, 2} \\
\vdots \\
e_{t+2, N}
\end{pmatrix}
\begin{pmatrix}
e_{t+1, 1} &amp; e_{t+1, 2} &amp; \cdots &amp; e_{t+1, N}
\end{pmatrix}
\right] \]</span> <span class="math display">\[=
E \left[
\begin{pmatrix}
e_{t+2, 1}e_{t+1, 1} &amp; e_{t+2, 1}e_{t+1, 2} &amp; \cdots &amp; e_{t+2, 1}e_{t+1, N}\\
e_{t+2, 2}e_{t+1, 1} &amp; e_{t+2, 2}e_{t+1, 2} &amp; \cdots &amp; e_{t+2, 2}e_{t+1, N}\\
\vdots               &amp;    \vdots            &amp; \vdots &amp;    \vdots          \\
e_{t+2, N}e_{t+2, 1} &amp; e_{t+2, N}e_{t+2, 2} &amp; \vdots &amp;    e_{t+2,N}e_{t+1,N}
\end{pmatrix}
\right]\]</span> <span class="math display">\[ = E \left[
\begin{pmatrix}
(\eta_{t+2, 1} + \psi \eta_{t+1, 1})(\eta_{t+1, 1} + \psi \eta_{t, 1}) &amp; (\eta_{t+2, 1} + \psi \eta_{t+1, 1})(\eta_{t+1, 2}+\psi \eta_{t,2}) &amp; \cdots &amp; (\eta_{t+2, 1} + \psi \eta_{t+1, 1})(\eta_{t,N}+\psi\eta_{t,N})) \\
(\eta_{t+2, 2} + \psi \eta_{t+1, 2})(\eta_{t+1, 1} + \psi \eta_{t, 1}) &amp; (\eta_{t+2, 2} + \psi \eta_{t+1, 2})(\eta_{t+1, 2}+\psi \eta_{t,2}) &amp; \cdots &amp; (\eta_{t+2, 2} + \psi \eta_{t+1, 2})(\eta_{t,N}+\psi\eta_{t,N})) \\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots \\
(\eta_{t+2, N} + \psi \eta_{t+1, N})(\eta_{t+1, 1} + \psi \eta_{t, 1}) &amp; (\eta_{t+2, N} + \psi \eta_{t+1, N})(\eta_{t+1, 2}+\psi \eta_{t,2}) &amp; \cdots &amp; (\eta_{t+2, N} + \psi \eta_{t+1, N})(\eta_{t,N}+\psi\eta_{t,N}))\
\end{pmatrix}
\right]
\]</span> <span class="math display">\[= \begin{pmatrix}
\psi\mathbb{E}[\eta_{t+1,1}^2] &amp; 0 &amp; \cdots &amp; 0\\
0 &amp; \psi\mathbb{E}[\eta_{t+1,2}^2] &amp; \cdots &amp; 0 \\
0 &amp; 0 &amp; \ddots &amp; 0 \\
0 &amp; 0 &amp; \cdots &amp; \psi\mathbb{E}[\eta_{t+1,N}^2]
\end{pmatrix} = \begin{pmatrix}
\psi &amp; 0 &amp; \cdots &amp; 0\\
0 &amp; \psi &amp; \cdots &amp; 0 \\
0 &amp; 0 &amp; \ddots &amp; 0 \\
0 &amp; 0 &amp; \cdots &amp; \psi
\end{pmatrix} = \Psi\]</span></p>
<p>since <span class="math inline">\(\eta_{t,i} \overset{iid}{\sim}\mathcal{N}(0,1)\)</span></p>
</section>
</section>
<section id="model-3-large-bvar-model-with-common-stochastic-volatility" class="level2">
<h2 class="anchored" data-anchor-id="model-3-large-bvar-model-with-common-stochastic-volatility">3.3 Model 3: Large BVAR model with common Stochastic Volatility</h2>
<p>The variances of economic shocks are rarely constant over time. Volatility tends to cluster during periods of economic crisis and becomes more tranquil during stable times. Thus, treating the innovations as having constant variance is an unrealistic assumption in practice. To remedy the situation, we can incorporate stochastic volatility into the model, thereby allowing the model to adapt to changing volatility in the data. This typically lead to improvement in model performance, especially in the presence of financial market instability or shifts in economic policy. A BVAR model with common stochastic volatility is s specified as follows:</p>
<p><span class="math display">\[ Y = XA+E\]</span> <span class="math display">\[
A = \begin{bmatrix}
\mu_0^T \\
A_1^T \\
\vdots \\
A_p^T
\end{bmatrix}
, \quad
Y = \begin{bmatrix}
y_1^T \\
y_2^T \\
\vdots \\
y_T^T
\end{bmatrix}
, \quad
x_t = \begin{bmatrix}
1 \\
y_{t-1}^T \\
\vdots \\
y_{t-p}^T
\end{bmatrix}
, \quad
X = \begin{bmatrix}
x_1^T \\
x_2^T \\
\vdots \\
x_T^T
\end{bmatrix}
, \quad
E = \begin{bmatrix}
e_1^T \\
e_2^T \\
\vdots \\
e_T^T
\end{bmatrix}
\]</span></p>
<p><span class="math display">\[E|X \sim \mathcal{MN}_{T \times N}(0_{T \times N},\Sigma_{N \times N}, \Omega_{T \times T})\]</span> where</p>
<p><span class="math display">\[e_t \sim \mathcal{N}(0, e^{h_t}\Sigma)\]</span> and <span class="math inline">\(h_t\)</span> follows an AR(1) process. <span class="math display">\[h_t = \rho h_{t-1} + u_t^h\]</span> <span class="math display">\[u_t^h \sim N(0, \sigma^2_h)\]</span></p>
</section>
<section id="model-4-large-bvar-model-with-ma1-gaussian-innovations-and-common-stochastic-volatility" class="level2">
<h2 class="anchored" data-anchor-id="model-4-large-bvar-model-with-ma1-gaussian-innovations-and-common-stochastic-volatility">3.4 Model 4: Large BVAR model with MA(1) Gaussian innovations and Common Stochastic Volatility</h2>
<section id="model-specification-2" class="level3">
<h3 class="anchored" data-anchor-id="model-specification-2">3.4.1 Model Specification</h3>
<p><span class="math display">\[ Y = XA+E\]</span></p>
<p>where</p>
<p><span class="math display">\[
A = \begin{bmatrix}
\mu_0^T \\
A_1^T \\
\vdots \\
A_p^T
\end{bmatrix}
, \quad
Y = \begin{bmatrix}
y_1^T \\
y_2^T \\
\vdots \\
y_T^T
\end{bmatrix}
, \quad
x_t = \begin{bmatrix}
1 \\
y_{t-1}^T \\
\vdots \\
y_{t-p}^T
\end{bmatrix}
, \quad
X = \begin{bmatrix}
x_1^T \\
x_2^T \\
\vdots \\
x_T^T
\end{bmatrix}
, \quad
E = \begin{bmatrix}
e_1^T \\
e_2^T \\
\vdots \\
e_T^T
\end{bmatrix}
\]</span></p>
<p>the same as before. But, instead of the column specific matrix as the identity matrix, we specify the column specific matrix as a diagonal matrix <span class="math inline">\(\Omega\)</span>. Specifically, we have:</p>
<p><span class="math display">\[\epsilon_t = u_t + \psi_1 u_{t-1}\]</span></p>
<p><span class="math display">\[u_t \sim \mathcal{N}(0,e^{h_t} \Sigma)\]</span></p>
<p><span class="math display">\[h_t = \rho h_{t-1} + u_t^h \quad \text{ follows an Autoregressive process of lag 1 AR(1), and}\]</span></p>
<p><span class="math display">\[u_t^h \sim N(0,\sigma_h^2)\]</span></p>
<p><span class="math display">\[\Omega = \left(
\begin{array}{cccc}
(1 + \psi_1^2) e^{h_1} &amp; \psi_1 e^{h_1} &amp; \cdots &amp; 0 \\
\psi_1 e^{h_1} &amp; \psi_1^2 e^{h_1} + e^{h_2} &amp; \cdots &amp; \vdots \\
0 &amp; \cdots &amp; \ddots &amp; \vdots \\
\vdots &amp; \cdots &amp; \psi_1^2 e^{h_{T-2}} + e^{h_{T-1}} &amp; \psi_1 e^{h_{T-1}} \\
0 &amp; \cdots &amp; \psi_1 e^{h_{T-1}} &amp; \psi_1^2 e^{h_{T-1}} + e^{h_T}
\end{array}
\right)\]</span></p>
<p>In this specification, each element of <span class="math inline">\(e_t\)</span> may have distinct variances, and the variances of all innovations can be scaled by a common factor. This approach is economically intuitive, as the volatility of macroeconomic variables often exhibit co-movement. It is important to emphasize that each component of <span class="math inline">\(e_t\)</span> must adhere to the same univariate time series model.</p>
</section>
<section id="prior-specification-1" class="level3">
<h3 class="anchored" data-anchor-id="prior-specification-1">3.4.2 Prior Specification</h3>
<p>Here, we consider a priori independent distributions for <span class="math inline">\((A, \Sigma, \Omega)\)</span>, namely:</p>
<p><span class="math display">\[p(A, \Sigma, \Omega) = p(A, \Sigma) \times p(\Omega)\]</span> Given this structure, we can sample from the posterior distribution by sequentially sampling from:</p>
<ul>
<li><span class="math inline">\(P(A, \Sigma | Y, X, \Omega)\)</span></li>
<li><span class="math inline">\(P(\Omega | Y, X, A, \Sigma)\)</span></li>
</ul>
<p>The prior distribution of <span class="math inline">\((A,\Sigma)\)</span> follow the same normal inverse Wishart prior distribution as outlined in model one. But the variance matrix <span class="math inline">\(V_A\)</span> for A is different:</p>
<p><span class="math display">\[V_A = diag(v_{A,ii})\]</span></p>
<p><span class="math display">\[v_{A,ii} = \begin{cases}
\kappa_1(\frac{l^2}{\hat{s}_r}) &amp; \text{for a coefficient associated to lag l of variable r} \\
\kappa_2&amp; \text{for an intercept}
\end{cases}\]</span></p>
<p>where <span class="math inline">\(\hat{s}_r\)</span> is the sample variance of an AR(4) model for the variable r.</p>
<p><span class="math display">\[E|X \sim \mathcal{MN}_{T \times N}(0_{T \times N},\Sigma_{N \times N}, \Omega_{T \times T})\]</span></p>
<p>and,</p>
<p>For the moving average coefficients, we adopt an uninformative truncated normal prior for the MA coefficient <span class="math inline">\(\psi\)</span>:</p>
<p><span class="math display">\[
\psi \sim \mathcal{N}(\psi_0, V_\psi) \mathbb{1}(|\psi|&lt;1)
\]</span></p>
<p>and we set <span class="math inline">\(\psi_0 = 0\)</span> and <span class="math inline">\(V_\psi = 1\)</span> so that the prior centers around 0 with a relatively large variance and has support within (-1,1). Further more, we assume independent priors for <span class="math inline">\(\sigma^2_h\)</span> and <span class="math inline">\(\rho\)</span>:</p>
<p><span class="math display">\[\sigma_h^2 \sim \mathcal{IG}(\nu_{h_0}, s_{h_0})\]</span></p>
<p><span class="math display">\[\rho \sim \mathcal{N}(\rho_0, V_\rho) \mathbb{1}(|\rho|&lt;1)\]</span></p>
<p>We set the hyperparameters <span class="math inline">\(\nu_{h_0} = 5\)</span>, <span class="math inline">\(s_{h_0} = 0.04\)</span>, <span class="math inline">\(\rho_0 = 0.9\)</span> and <span class="math inline">\(V_\rho = 0.04\)</span> so that the prior mean of <span class="math inline">\(\sigma_h^2\)</span> is 0.01 and <span class="math inline">\(\rho\)</span> is centered at 0.9.</p>
</section>
<section id="posterior-distribution" class="level3">
<h3 class="anchored" data-anchor-id="posterior-distribution">3.4.3 Posterior Distribution</h3>
<p>The posterior distribution specified above has the following form:</p>
<p><span class="math display">\[p(Y|A, \Sigma) = (2\pi)^{-\frac{Tn}{2}}|\Sigma|^{-\frac{T}{2}}|\Omega|^{-\frac{N}{2}}exp(-\frac{1}{2}tr(\Sigma^{-1}(Y-XA)^T\Omega^{-1}(Y-XA))\]</span></p>
<p>and the joint posterior distribution</p>
<p><span class="math display">\[p(A, \Sigma \mid Y, \Omega)  = \frac{p(A,\Sigma,Y, \Omega)}{p(Y, \Omega)}\]</span> <span class="math display">\[\propto p(A, \Sigma, Y, \Omega) \propto p(Y \mid A,\Sigma, \Omega)\times p(A,\Sigma, \Omega)\]</span> <span class="math display">\[=  p(Y \mid A,\Sigma, \Omega) p(A, \Sigma) p(\Omega) = p(Y \mid A,\Sigma, \Omega) p(A \mid \Sigma) p(\Sigma) p(\Omega)\]</span></p>
<p><span class="math display">\[\propto p(Y \mid A,\Sigma, \Omega) p(A \mid \Sigma) p(\Sigma)\]</span></p>
<p><span class="math display">\[\propto |\Sigma|^{-\frac{T}{2}}exp(-\frac{1}{2}tr(\Sigma^{-1}(Y-XA)^T\Omega^{-1}(Y-XA)) \times\]</span></p>
<p><span class="math display">\[\mid \Sigma \mid^{-\frac{\nu_0+N+K}{2}}exp(-\frac{1}{2}tr(\Sigma^{-1}S_o))exp(-\frac{1}{2}tr(\Sigma^{-1}(A-A_0)^TV_A^{-1}(A-A_0))\]</span></p>
<p><span class="math display">\[\propto |\Sigma|^{-\frac{T+N+K+\nu_0+1}{2}} \times \exp (-\frac{1}{2}tr(\Sigma^{-1}S_0)) \times \]</span> <span class="math display">\[exp(-\frac{1}{2}tr(\Sigma^{-1}(A_0^TV_a^{-1}A_0+Y^T\Omega^{-1}Y-\bar{A}^T\bar{V}^{-1}\bar{A})\times\]</span> <span class="math display">\[exp(-\frac{1}{2}tr(\Sigma^{-1}(A-\bar{A})^T\bar{V}^{-1}(A-\bar{A})))\]</span></p>
<p>Hence,</p>
<p><span class="math display">\[p(A, \Sigma \mid Y, X) = p(A \mid Y, X, \Sigma) p(\Sigma \mid Y, X)\]</span></p>
<p><span class="math display">\[p(A \mid Y, X, \Sigma, \Omega) = \mathcal{MN}_{k \times N}(\bar{A}, \Sigma, \bar{V})\]</span></p>
<p><span class="math display">\[p(\Sigma \mid Y, X) = \mathcal{IW}_N(\bar{S}, \bar{\nu})\]</span></p>
<p>where</p>
<p><span class="math display">\[\bar{V} = (X^T\Omega^{-1}X + V_A^{-1})^{-1}\]</span></p>
<p><span class="math display">\[\bar{A} = \bar{V}(X^T\Omega^{-1}Y + V_A^{-1}A_0)\]</span></p>
<p><span class="math display">\[\bar{\nu} = T + \nu_0\]</span></p>
<p><span class="math display">\[\bar{S} = S_0 + Y^T\Omega^{-1}Y + A_0^TV_A^{-1}A_0 - \bar{A}^T\bar{V}^{-1}\bar{A}\]</span></p>
</section>
<section id="estimation-procedure-2" class="level3">
<h3 class="anchored" data-anchor-id="estimation-procedure-2">3.4.4 Estimation Procedure</h3>
<p>In this setting, we have</p>
<ul>
<li><span class="math inline">\((A,\Sigma) \sim \mathcal{NIW}_{K \times N} (A_0, V_A, S_0, \nu_0)\)</span></li>
<li><span class="math inline">\(p(A, \Sigma, \Omega) = p(A, \Sigma) \times p(\Omega)\)</span></li>
</ul>
<p>then, prior draws can be sampled from</p>
<ul>
<li><p><span class="math inline">\(\Sigma \sim \mathcal{IW}(S_0, \nu_0)\)</span></p></li>
<li><p><span class="math inline">\(A|\Sigma \sim \mathcal{MN}_{K \times N}(A_0, \Sigma, V_A)\)</span></p></li>
<li><p><span class="math inline">\(\Omega = \left(
\begin{array}{cccc}
(1 + \psi_1^2) e^{h_1} &amp; \psi_1 e^{h_1} &amp; \cdots &amp; 0 \\
\psi_1 e^{h_1} &amp; \psi_1^2 e^{h_1} + e^{h_2} &amp; \cdots &amp; \vdots \\
0 &amp; \cdots &amp; \ddots &amp; \vdots \\
\vdots &amp; \cdots &amp; \psi_1^2 e^{h_{T-2}} + e^{h_{T-1}} &amp; \psi_1 e^{h_{T-1}} \\
0 &amp; \cdots &amp; \psi_1 e^{h_{T-1}} &amp; \psi_1^2 e^{h_{T-1}} + e^{h_T}
\end{array}
\right)\)</span></p></li>
<li><p><span class="math inline">\(\epsilon_t = u_t + \psi_1 u_{t-1}\)</span></p></li>
<li><p><span class="math inline">\(\psi \sim \mathcal{N}(\psi_0, V_\psi) \mathbb{1}(|\psi|&lt;1)\)</span></p></li>
<li><p><span class="math inline">\(u_t \sim \mathcal{N}(0,e^{h_t} \Sigma)\)</span></p></li>
<li><p><span class="math inline">\(h_t = \rho h_{t-1} + u_t^h\)</span></p></li>
<li><p><span class="math inline">\(\rho \sim \mathcal{N}(\rho_0, V_\rho) \mathbb{1}(|\rho|&lt;1)\)</span></p></li>
<li><p><span class="math inline">\(u_t^h \sim N(0,\sigma_h^2)\)</span></p></li>
<li><p><span class="math inline">\(\sigma_h^2 \sim \mathcal{IG}(\nu_{h_0}, s_{h_0})\)</span></p></li>
</ul>
<p>To sample <span class="math inline">\(S_1+S_2\)</span> draws of <span class="math inline">\(\left\{\Omega^{(s)}\right\}_{s=1}^{S_1+S_2}\)</span></p>
<ol type="1">
<li>Sample <span class="math inline">\(S_1+S_2\)</span> draws of <span class="math inline">\(\left\{\sigma^{2,(s)}_h\right\}_{s=1}^{S_1+S_2}\)</span> from <span class="math inline">\(\mathcal{IG}(v_{h_0}, s_{h_0})\)</span></li>
<li>Sample <span class="math inline">\(S_1+S_2\)</span> draws of <span class="math inline">\(\left\{\rho^{(s)}\right\}_{s=1}^{S_1+S_2}\)</span> from <span class="math inline">\(\mathcal{N}(\rho_0, V_\rho) \mathbb{1}(|\rho|&lt;1)\)</span></li>
<li>For each <span class="math inline">\(\sigma^{2,(s)}_h\)</span>, sample <span class="math inline">\(\left\{u_t^{h,(s)}\right\}_{t=1}^T\)</span> from <span class="math inline">\(N(0,\sigma_h^{2,(s)})\)</span></li>
<li>For t = 1,…,T and s = 1,…, <span class="math inline">\(S_1+S_2\)</span>, compute <span class="math inline">\(h_t^{(s)} = \rho h_{t-1}^{(s)} + u_t^{h,(s)}\)</span></li>
<li>Sample <span class="math inline">\(S_1+S_2\)</span> draws of <span class="math inline">\(\left\{u_t^{(s)}\right\}_{s=1}^{S_1+S_2}\)</span> from <span class="math inline">\(u_t \sim \mathcal{N}(0,e^{h_t^{(s)}} \Sigma)\)</span> for t = 1,…,T</li>
<li>Sample <span class="math inline">\(S_1+S_2\)</span> draws of <span class="math inline">\(\left\{\psi^{(s)}\right\}_{s=1}^{S_1+S_2}\)</span> from <span class="math inline">\(\mathcal{N}(\psi_0, V_\psi) \mathbb{1}(|\psi|&lt;1)\)</span></li>
<li>for each t = 1,…,T and s = 1,…<span class="math inline">\(S_1+S_2\)</span>, compute <span class="math inline">\(\epsilon_t^{(s)} = u_t^{(s)} + \psi^{(s)}u_{t-1}^{(s)}\)</span></li>
</ol>
<p>After we have obtained <span class="math inline">\(\left\{\Omega^{(s)}\right\}_{s=1}^{S_1+S_2}\)</span>, we can use the following Gibb’s Sampler algorithm to sample from the posterior distribution <span class="math inline">\(p(A \mid Y, X, \Sigma, \Omega)\)</span>:</p>
<ul>
<li>Initialize <span class="math inline">\(\Sigma\)</span> at <span class="math inline">\(\Sigma^0\)</span></li>
<li>For <span class="math inline">\(s = 1,...,S_1+S_2\)</span>
<ol type="1">
<li>Draw a sample <span class="math inline">\(A^{(s)}\)</span> from <span class="math inline">\(p(A \mid Y, X, \Omega^{(s)}, \Sigma^{(s-1)}) \sim \mathcal{MN}_{k \times N}(\bar{A}, \Sigma, \bar{V})\)</span></li>
<li>Draw a sample <span class="math inline">\(\Sigma^{(s)}\)</span> from <span class="math inline">\(p(\Sigma \mid Y, X, A^{(s)}, \Omega^{(s)}) = \mathcal{IW}_N(\bar{S}, \bar{\nu})\)</span></li>
</ol></li>
</ul>
<p>We discard the first <span class="math inline">\(S_1\)</span> sample draws to allow the algorithm to converge to the stationary posterior distributiion to obtain <span class="math inline">\(S_2\)</span> sampled draws from the joint posterior distribution.</p>
<p><span class="math display">\[\left\{A^{(s)}, \Sigma^{(s)}\right\}_{s=S_1+1}^{S_1+S_2}\]</span></p>
<p>Sampling from the joint predictive density is the same as before.</p>
</section>
</section>
</section>
<section id="model-estimation" class="level1">
<h1>4. Model Estimation</h1>
<section id="standard-bayesian-var" class="level2">
<h2 class="anchored" data-anchor-id="standard-bayesian-var">4.1 Standard Bayesian VAR</h2>
<section id="model-building-code-and-validation" class="level3">
<h3 class="anchored" data-anchor-id="model-building-code-and-validation">4.1.1 Model Building Code and Validation</h3>
<p>We verify that our model can replicate the true parameter of the data generate process by: 1. Generate artificial data containing 1000 observations simulated from a bi-variate Gaussian random walk process with the covariance matrix equal to the identity matrix of order 2. That is,</p>
<p><span class="math display">\[\mathbf{y_t} = \begin{pmatrix} y_t,1 \\ y_t,2\end{pmatrix} = \mathbf{y_{t-1}} + \mathbf{\epsilon_t} = \begin{pmatrix}y_{t-1,1}\\y_{t-1, 2}\end{pmatrix} + \begin{pmatrix}\epsilon_{t,1}\\ \epsilon_{t, 2}\end{pmatrix}\]</span> and</p>
<p><span class="math display">\[\mathbf{\epsilon} \sim iid \mathcal{N}(\mathbf{0}, \mathbf{I_2} )\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1005</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">1000</span>  </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>cov_matrix <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">2</span>)  </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>random_walk_sample <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> n, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#initialize the random walk at 0,0</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>random_walk_sample[<span class="dv">1</span>, ] <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  random_walk_sample[i, ] <span class="ot">=</span> random_walk_sample[i <span class="sc">-</span> <span class="dv">1</span>, ] <span class="sc">+</span> <span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Sigma =</span> cov_matrix)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>mat_plot <span class="ot">=</span> random_walk_sample </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mat_plot) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Series1"</span>, <span class="st">"Series2"</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>mat_plot <span class="ot">=</span> <span class="fu">as.data.frame</span>(mat_plot)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>mat_plot<span class="sc">$</span>Index <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mat_plot) </span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>mat_plot <span class="ot">=</span> <span class="fu">melt</span>(mat_plot, <span class="at">id.vars =</span> <span class="st">"Index"</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mat_plot, <span class="fu">aes</span>(<span class="at">x =</span> Index, <span class="at">y =</span> value, <span class="at">color =</span> variable)) <span class="sc">+</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"1000 observations simulated from a bi-variate Gaussian random walk process"</span>, <span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>The BVAR_fit function takes in ‘data’ as an argument, where columns of ‘data’ represent different variables and rows correspond to observations over time. It also requires an integer p, which specifies the number of lags to include in the BVAR model. The parameters S1 and S2 denote the number of burn-in samples and actual samples, respectively. <span class="math inline">\(\kappa_1\)</span> is the shrinkage level applied to the autoregressive coefficients, while <span class="math inline">\(\kappa_2\)</span> controls the shrinkage for the constant term. The <span class="math inline">\(A_{prior}\)</span> and <span class="math inline">\(V_{prior}\)</span> parameters set the prior mean and covariance matrices for the matrix A. Finally, <span class="math inline">\(S_{prior}\)</span> and <span class="math inline">\(\nu_{prior}\)</span> define the scale and shape parameters, respectively, for the prior distribution of the covariance matrix <span class="math inline">\(\Sigma\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>BVAR_fit <span class="ot">&lt;-</span> <span class="cf">function</span>(data, p, S1, S2, kappa1, kappa2, A_prior, V_prior, S_prior, nu_prior, N){</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">=</span> <span class="fu">ncol</span>(Y)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  Ty <span class="ot">=</span> <span class="fu">nrow</span>(Y)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">=</span> S1 <span class="sc">+</span> S2</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>) </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    X     <span class="ot">=</span> <span class="fu">cbind</span>(X, (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)<span class="sc">-</span>i,]))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">=</span> <span class="fu">as.matrix</span>(Y)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> <span class="fl">1e-5</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  V_bar <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X <span class="sc">+</span> <span class="fu">solve</span>(V_prior) <span class="sc">+</span> <span class="fu">diag</span>(lambda, <span class="at">nrow =</span> <span class="fu">ncol</span>(X)))</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#V_bar = round(V_bar, 5)</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  A_bar <span class="ot">=</span> V_bar<span class="sc">%*%</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>Y <span class="sc">+</span> <span class="fu">solve</span>(V_prior)<span class="sc">%*%</span>A_prior)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  nu_bar <span class="ot">=</span> Ty <span class="sc">+</span> nu_prior</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#S_bar  = S_prior + t(Y)%*%Y + t(A_prior)%*%diag(1/diag(V_prior))%*%A_prior - t(A_bar)%*%solve(V_bar)%*%A_bar</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  S_bar <span class="ot">=</span> S_prior <span class="sc">+</span>  <span class="fu">t</span>(Y)<span class="sc">%*%</span>Y <span class="sc">+</span> <span class="fu">t</span>(A_prior)<span class="sc">%*%</span><span class="fu">solve</span>(V_prior)<span class="sc">%*%</span>A_prior <span class="sc">-</span> <span class="fu">t</span>(A_bar)<span class="sc">%*%</span><span class="fu">solve</span>(V_bar)<span class="sc">%*%</span>A_bar</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  S_bar_inv <span class="ot">=</span> <span class="fu">solve</span>(S_bar)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Sigma_posterior = rWishart(S, df=nu_bar, Sigma=S_bar_inv)</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  Sigma_posterior <span class="ot">=</span> <span class="fu">rWishart</span>(S, <span class="at">df=</span>nu_bar, <span class="at">Sigma=</span>S_bar_inv)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  Sigma_posterior <span class="ot">=</span> <span class="fu">apply</span>(Sigma_posterior,<span class="dv">3</span>,solve)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  Sigma_posterior  <span class="ot">=</span> <span class="fu">array</span>(Sigma_posterior,<span class="fu">c</span>(N,N,S))</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  A_posterior <span class="ot">=</span> <span class="fu">array</span>(<span class="fu">rnorm</span>(<span class="fu">prod</span>(<span class="fu">c</span>(<span class="fu">dim</span>(A_bar),S))),<span class="fu">c</span>(<span class="fu">dim</span>(A_bar),S))</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">chol</span>(V_bar))</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    A_posterior[,,s]<span class="ot">=</span> A_bar <span class="sc">+</span> L<span class="sc">%*%</span>A_posterior[,,s]<span class="sc">%*%</span><span class="fu">chol</span>(Sigma_posterior[,,s])</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  A_posterior <span class="ot">=</span> A_posterior[,,(S1<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(S1<span class="sc">+</span>S2)]</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  Sigma_posterior <span class="ot">=</span> Sigma_posterior[,,(S1<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(S1<span class="sc">+</span>S2)]</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(A_posterior, Sigma_posterior))</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We use our function to estimate a model with a constant term and lag order 1 using simulated data from a bi-variate Gaussian random walk process with the covariance matrix equal to the identity matrix of order 2. We show that sampled posterior mean of the autoregressive and the covariance matrices are close to an identity matrix and that the sampled posterior mean of the constant term is close to a vector of zeros.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.02</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(random_walk_sample)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>A_prior             <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N,N)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>A_prior[<span class="dv">2</span><span class="sc">:</span>(N <span class="sc">+</span> <span class="dv">1</span>),] <span class="ot">=</span> <span class="fu">diag</span>(N)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>V_prior     <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>S_prior     <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span>, N)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>nu_prior    <span class="ot">=</span> <span class="fu">ncol</span>(random_walk_sample)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>S1 <span class="ot">=</span> <span class="dv">10000</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>S2 <span class="ot">=</span> <span class="dv">20000</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>posterior_samples <span class="ot">=</span> <span class="fu">BVAR_fit</span>(<span class="at">data =</span> random_walk_sample, <span class="at">p =</span> p, <span class="at">S1=</span> S1, <span class="at">S2 =</span> S2, <span class="at">kappa1 =</span> kappa1, <span class="at">kappa2 =</span> kappa2, <span class="at">A_prior =</span> A_prior, <span class="at">V_prior =</span> V_prior, <span class="at">S_prior =</span> S_prior, <span class="at">nu_prior =</span> nu_prior)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>posterior_samples_A <span class="ot">=</span> posterior_samples[[<span class="dv">1</span>]]</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>posterior_samples_Sigma <span class="ot">=</span> posterior_samples[[<span class="dv">2</span>]]</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Posterior mean of autoregressive parameter:'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Posterior mean of autoregressive parameter:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">apply</span>(posterior_samples_A,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,mean),<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]  [,2]
[1,] 0.029 0.019
[2,] 0.987 0.002
[3,] 0.006 0.993</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Posterior standard deviation of autoregressive parameter:'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Posterior standard deviation of autoregressive parameter:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">apply</span>(posterior_samples_A,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,sd),<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]  [,2]
[1,] 0.033 0.033
[2,] 0.005 0.005
[3,] 0.006 0.006</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Posterior mean of covariance matrix:'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Posterior mean of covariance matrix:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">apply</span>(posterior_samples_Sigma,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,mean),<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]  [,2]
[1,] 0.993 0.037
[2,] 0.037 1.045</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">'Posterior standard deviation of covariance matrix:'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Posterior standard deviation of covariance matrix:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">apply</span>(posterior_samples_Sigma,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,sd),<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]  [,2]
[1,] 0.045 0.033
[2,] 0.033 0.047</code></pre>
</div>
</div>
</section>
<section id="empirical-result" class="level3">
<h3 class="anchored" data-anchor-id="empirical-result">4.1.2 Empirical Result</h3>
<section id="fitted-models" class="level4">
<h4 class="anchored" data-anchor-id="fitted-models"><strong>4.1.2.1 Fitted Models</strong></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> final_df[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(final_df)]</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>A_prior <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N,N)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>A_prior[<span class="dv">2</span><span class="sc">:</span>(N <span class="sc">+</span> <span class="dv">1</span>),] <span class="ot">=</span> <span class="fu">diag</span>(N)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>S_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span>, N)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>nu_prior  <span class="ot">=</span> <span class="fu">ncol</span>(data)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> final_df[,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(final_df)]</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#data = final_df[,2:19]</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>S1 <span class="ot">=</span> <span class="dv">50000</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>S2 <span class="ot">=</span> <span class="dv">50000</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>posterior_samples <span class="ot">=</span> <span class="fu">BVAR_fit</span>(<span class="at">data =</span> data, <span class="at">p =</span> p, <span class="at">S1=</span> S1, <span class="at">S2 =</span> S2, <span class="at">kappa1 =</span> kappa1, <span class="at">kappa2 =</span> kappa2, <span class="at">A_prior =</span> A_prior, <span class="at">V_prior =</span> V_prior, <span class="at">S_prior =</span> S_prior, <span class="at">nu_prior =</span> nu_prior)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>posterior_samples_A <span class="ot">=</span> posterior_samples[[<span class="dv">1</span>]]</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>posterior_samples_Sigma <span class="ot">=</span> posterior_samples[[<span class="dv">2</span>]]</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior mean of autoregressive parameter:')</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_A,1:2,mean),3)</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior standard deviation of autoregressive parameter:')</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_A,1:2,sd),3)</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior mean of covariance matrix:')</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_Sigma,1:2,mean),3)</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior standard deviation of covariance matrix:')</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_Sigma,1:2,sd),3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="prediction-plots" class="level4">
<h4 class="anchored" data-anchor-id="prediction-plots"><strong>4.1.2.2 Prediction Plots</strong></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>BVAR_predict <span class="ot">=</span> <span class="cf">function</span>(posterior_samples_A, posterior_samples_Sigma, data, h){</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">=</span> <span class="fu">dim</span>(posterior_samples_A)[<span class="dv">3</span>]</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">=</span><span class="fu">dim</span>(posterior_samples_A)[<span class="dv">2</span>]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">=</span> (<span class="fu">dim</span>(posterior_samples_A)[<span class="dv">1</span>] <span class="sc">-</span><span class="dv">1</span>) <span class="sc">/</span> N</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#last p observations </span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> Y[(<span class="fu">nrow</span>(Y)<span class="sc">-</span>p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(Y),]</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reverse the order t-p t-(p-1)...</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> x[p<span class="sc">:</span><span class="dv">1</span>,]</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  Y_h   <span class="ot">=</span> <span class="fu">array</span>(<span class="cn">NA</span>,<span class="fu">c</span>(h,N,S))</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    A     <span class="ot">=</span> posterior_samples_A[,,s]</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="ot">=</span> posterior_samples_Sigma[,,s]</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    x  <span class="ot">=</span> Y[(<span class="fu">nrow</span>(Y)<span class="sc">-</span>p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(Y),]</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">=</span> x[p<span class="sc">:</span><span class="dv">1</span>,]</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>h){</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>      <span class="co">#x_{{t+1}= (1 y_t y_{t-1},... y_{t-p+1})</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>      x_T   <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fu">as.vector</span>(<span class="fu">t</span>(x)))</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>      <span class="co">#y_t+h = mvnnorm(1, x_t%*%A)</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>      Period_Y  <span class="ot">=</span> mvtnorm<span class="sc">::</span><span class="fu">rmvnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> x_T<span class="sc">%*%</span>A, <span class="at">sigma=</span>Sigma)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(Period_Y) <span class="ot">=</span> <span class="fu">colnames</span>(x)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>      x   <span class="ot">=</span> <span class="fu">rbind</span>(Period_Y,x[<span class="dv">1</span><span class="sc">:</span>(p<span class="dv">-1</span>),])</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>      Y_h[i,,s]   <span class="ot">=</span> Period_Y[<span class="dv">1</span><span class="sc">:</span>N]</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Y_h)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> final_df[, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(final_df)]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  BVAR_prediction <span class="ot">&lt;-</span> <span class="fu">BVAR_predict</span>(<span class="at">posterior_samples_A =</span> posterior_samples_A, <span class="at">posterior_samples_Sigma =</span> posterior_samples_Sigma, <span class="at">data =</span> data, <span class="at">h =</span> h)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>})  <span class="co"># Closing the system.time block after all operations</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming S2 is the number of iterations and is defined somewhere in your script</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Running prediction for %d iterations took: %f seconds"</span>, S2, start[<span class="st">"elapsed"</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running prediction for 50000 iterations took: 131.263000 seconds"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HDInterval)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>plot_CI <span class="ot">=</span> <span class="cf">function</span>(prediction, data, final_df, var_index, <span class="at">main_title =</span> <span class="st">"Forecast Plot"</span>){</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">=</span> <span class="fu">dim</span>(prediction)[<span class="dv">1</span>]</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  forecast_mean <span class="ot">=</span> <span class="fu">apply</span>(prediction, <span class="dv">1</span>, mean)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  forecast_interval <span class="ot">=</span> <span class="fu">apply</span>(prediction, <span class="dv">1</span>, hdi, <span class="at">credMass=</span><span class="fl">0.50</span>)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  forecast_range <span class="ot">=</span> <span class="fu">range</span>(data[,var_index], forecast_interval)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  mcxs1 <span class="ot">=</span> <span class="st">"#05386B"</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  mcxs1.shade1 <span class="ot">=</span> <span class="fu">rgb</span>(<span class="fu">t</span>(<span class="fu">col2rgb</span>(mcxs1)), <span class="at">alpha=</span><span class="dv">120</span>, <span class="at">maxColorValue=</span><span class="dv">255</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  x_value <span class="ot">=</span> final_df<span class="sc">$</span>Time</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>h){</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    x_value[<span class="fu">length</span>(x_value)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> <span class="fu">max</span>(x_value) <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>))</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(x_value, <span class="fu">c</span>(data[,var_index], forecast_mean), <span class="at">type=</span><span class="st">"l"</span>,</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim=</span>forecast_range, <span class="at">axes=</span><span class="cn">FALSE</span>, <span class="at">xlab=</span><span class="st">""</span>, <span class="at">ylab=</span><span class="st">""</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">main =</span> main_title)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>) </span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">2</span>) </span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v=</span><span class="fu">length</span>(data[,var_index]), <span class="at">col=</span>mcxs1)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">polygon</span>(<span class="at">x =</span> <span class="fu">c</span>(x_value[(<span class="fu">length</span>(x_value)<span class="sc">-</span>h<span class="sc">+</span><span class="dv">1</span>) <span class="sc">:</span> <span class="fu">length</span>(x_value)], <span class="fu">rev</span>(x_value[(<span class="fu">length</span>(x_value)<span class="sc">-</span>h<span class="sc">+</span><span class="dv">1</span>) <span class="sc">:</span> <span class="fu">length</span>(x_value)])),</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>          <span class="at">y =</span> <span class="fu">c</span>(forecast_interval[<span class="dv">1</span>,], <span class="fu">rev</span>(forecast_interval[<span class="dv">2</span>,])),</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">col=</span>mcxs1.shade1, <span class="at">border=</span><span class="cn">NA</span>)</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># polygon(x = c((length(data[,var_index])+1):(length(data[,var_index])+h), rev((length(data[,var_index])+1):(length(data[,var_index])+h))),</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#         y = c(forecast_interval[1,], rev(forecast_interval[2,])),</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#         col=mcxs1.shade1, border=NA)</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">cex.axis =</span> <span class="dv">1</span>)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(data)) {</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>  plot_title <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">"Forecast for"</span>, <span class="fu">colnames</span>(data)[i]) </span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_CI</span>(<span class="at">prediction =</span> BVAR_prediction[, i, ], <span class="at">data =</span> data, <span class="at">final_df =</span> final_df, <span class="at">var_index =</span> i, <span class="at">main_title =</span> plot_title)</span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plot3D)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>mcxs1  <span class="ot">=</span> <span class="st">"#05386B"</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>mcxs2  <span class="ot">=</span> <span class="st">"#379683"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>mcxs3  <span class="ot">=</span> <span class="st">"#5CDB95"</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>mcxs4  <span class="ot">=</span> <span class="st">"#8EE4AF"</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>mcxs5  <span class="ot">=</span> <span class="st">"#EDF5E1"</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>threeD_plolts_MA <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>plots <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(data)){</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  lower        <span class="ot">=</span> <span class="fu">range</span>(BVAR_prediction[,j,])</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  prediction_mean         <span class="ot">=</span> <span class="fu">apply</span>(BVAR_prediction[,j,],<span class="dv">1</span>,mean)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  prediction_CI      <span class="ot">=</span> <span class="fu">apply</span>(BVAR_prediction[,j,],<span class="dv">1</span>,hdi,<span class="at">credMass=</span><span class="fl">0.90</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  theta <span class="ot">=</span> <span class="dv">180</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  phi   <span class="ot">=</span> <span class="fl">15.5</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  x_range           <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span>lower[<span class="dv">1</span>], <span class="at">to=</span>lower[<span class="dv">2</span>], <span class="at">length.out=</span><span class="dv">10</span>)</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  z_range           <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,h,<span class="dv">9</span>)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>h){</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>    z_range[i,]     <span class="ot">=</span> <span class="fu">hist</span>(BVAR_prediction[i,j,], <span class="at">breaks=</span>x_range, <span class="at">plot=</span><span class="cn">FALSE</span>)<span class="sc">$</span>density</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  x_range           <span class="ot">=</span> <span class="fu">hist</span>(BVAR_prediction[i,j,], <span class="at">breaks=</span>x_range, <span class="at">plot=</span><span class="cn">FALSE</span>)<span class="sc">$</span>mids</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  y_range          <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span>h</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot using plot_ly</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">y =</span> y_range, <span class="at">x =</span> x_range, <span class="at">z =</span> z_range, <span class="at">type =</span> <span class="st">"surface"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(<span class="at">scene =</span> <span class="fu">list</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="fu">sprintf</span>(<span class="st">"%s"</span>, <span class="fu">colnames</span>(data)[j])),</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>                        <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"h"</span>),</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>                        <span class="at">zaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"density"</span>)),</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="fu">sprintf</span>(<span class="st">"%s"</span>, <span class="fu">colnames</span>(data)[j]))</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print or display the plot</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>  plots[[j]] <span class="ot">=</span> p</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="test-for-granger-causality-1" class="level4">
<h4 class="anchored" data-anchor-id="test-for-granger-causality-1"><strong>4.1.2.3 Test for Granger Causality</strong></h4>
<p>We first perform Granger Causality test for each country, we test whether the macroeconomic factor of one country has some predictive power on the macroeconomic factors of another. Specifically, we test the following hypothesis:</p>
<p><span class="math inline">\(H_0:\)</span> The consumer price index, interest rate, foreign direct investment, balance of payments, gross domestic product, exchange rate against the dollar of country A has no impact on these variables in the country B$</p>
<p>The Baye’s factor in this case is defined as:</p>
<p><span class="math display">\[_H = \frac{p_0(Y)}{p_1(Y)} = \frac{p_1(A_{ij} = 0|Y)}{p_1(A_{ij} = 0)}=\frac{\int p_1(A_{ij=0}|Y, \Sigma)p(\Sigma|Y) d \Sigma}{\int p(A_{ij}=0, \Sigma)d\Sigma}\]</span> <span class="math display">\[p_1(A_{ij} = 0|Y, X,\Sigma) \sim \mathcal{MN}_{K \times N}(\bar{A_{ij}}, \Sigma_{ij}, \bar{V}_{ij})\]</span> <span class="math display">\[p_1(A_{ij} = 0, \Sigma) \sim \mathcal{NIW}_{K \times N}(A_{0, ij}, V_{A, ij}, S_{0, ij}, \nu_{0, ij})\]</span> <span class="math display">\[p_1(A_{ij} = 0, \Sigma) = p(A_{ij}|\Sigma)\times p(\Sigma)\]</span> <span class="math display">\[A_{ij}|\Sigma \sim \mathcal{MN}_{K \times N} (A_{0,ij}, \Sigma, V_{A, ij}) \]</span> <span class="math display">\[\Sigma \sim \mathcal{IW}(S_0, \nu_0)\]</span> and we test the bi-lateral relationship between each of these countries.</p>
<p><strong>1. Granger Causality Test for all countries from Q1 1994 to Q3 2023</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>calc_bayes_factor <span class="ot">=</span> <span class="cf">function</span>(country1, country2, S){</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">#S cannot exceed the number of posterior samples generated</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">=</span> <span class="fu">min</span>(S, <span class="fu">dim</span>(posterior_samples_Sigma)[<span class="dv">3</span>])</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  ratio_list <span class="ot">=</span> <span class="fu">list</span>(<span class="at">dim =</span> S)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  var_list <span class="ot">=</span> <span class="fu">colnames</span>(data)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  country1 <span class="ot">=</span> var_list[<span class="fu">grepl</span>(country1, var_list)]</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  var_list <span class="ot">=</span> <span class="fu">colnames</span>(X)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  country2 <span class="ot">=</span> var_list[<span class="fu">grepl</span>(country2, var_list)]</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set dim names for V</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(V_prior) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(X), <span class="fu">colnames</span>(X))</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(posterior_V) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(X), <span class="fu">colnames</span>(X))</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set this in case we want to test less samples than the number of posterior samples generated</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  total_s <span class="ot">=</span> <span class="fu">dim</span>(posterior_samples_Sigma)[<span class="dv">3</span>]</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set dim names for A_prior</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(A_prior) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(X), <span class="fu">colnames</span>(data))</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">#calculate prior probability</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    A_prior_test <span class="ot">=</span> A_prior[country2, country1]</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    prior_Sigma <span class="ot">=</span> MCMCpack<span class="sc">::</span><span class="fu">riwish</span>(<span class="at">v =</span> nu_prior, <span class="at">S =</span> S_prior)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dimnames</span>(prior_Sigma) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(data), <span class="fu">colnames</span>(data))</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Sigma is row specific covariance matrix</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    prior_Sigma_test <span class="ot">=</span> prior_Sigma[<span class="fu">colnames</span>(A_prior_test),<span class="fu">colnames</span>(A_prior_test)]</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># V is the column specific covariance matrix</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    V_prior_test <span class="ot">=</span> V_prior[<span class="fu">rownames</span>(A_prior_test), <span class="fu">rownames</span>(A_prior_test)]</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    Q_prior <span class="ot">=</span> <span class="fu">kronecker</span>(prior_Sigma_test, V_prior_test)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    prior_prob <span class="ot">=</span>  mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(<span class="fu">nrow</span>(A_prior_test), <span class="fu">ncol</span>(A_prior_test)))), </span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">c</span>(A_prior_test), </span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">sigma =</span> Q_prior, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">#select the s sampled posterior A</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    A_0_mat_full <span class="ot">=</span> posterior_samples_A[,,s]</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dimnames</span>(A_0_mat_full) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(X), <span class="fu">colnames</span>(data))</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    row_names <span class="ot">=</span> <span class="fu">rownames</span>(A_0_mat_full)</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    A_0_mat_posterior <span class="ot">=</span> A_0_mat_full[country2, country1]</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> <span class="fu">c</span>(posterior_samples_A[,,(total_s <span class="sc">-</span> s <span class="sc">+</span> <span class="dv">1</span>)])</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> <span class="fu">array</span>(M, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(A_0_mat_full), <span class="fu">ncol</span>(A_0_mat_full)))</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dimnames</span>(M) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(X), <span class="fu">colnames</span>(data))</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> M[country2, country1]</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>    posteior_sigma_test <span class="ot">=</span> posterior_samples_Sigma[,,(total_s <span class="sc">-</span> s <span class="sc">+</span> <span class="dv">1</span>)]</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dimnames</span>(posteior_sigma_test) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(data), <span class="fu">colnames</span>(data))</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>    posteior_sigma_test <span class="ot">=</span> posteior_sigma_test[<span class="fu">colnames</span>(A_0_mat_posterior),<span class="fu">colnames</span>(A_0_mat_posterior)]</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>    posterior_V_test <span class="ot">=</span> posterior_V[<span class="fu">rownames</span>(A_0_mat_posterior), <span class="fu">rownames</span>(A_0_mat_posterior)]</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>    Q <span class="ot">=</span> <span class="fu">kronecker</span>(posteior_sigma_test, posterior_V_test)</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>    posterior_prob <span class="ot">=</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(<span class="fu">nrow</span>(A_0_mat_posterior), <span class="fu">ncol</span>(A_0_mat_posterior)))), <span class="at">mean =</span> <span class="fu">c</span>(M), <span class="at">sigma =</span> Q, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>    ratio_list[s] <span class="ot">=</span> posterior_prob <span class="sc">-</span> prior_prob</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ratio_list)</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#aa = calc_bayes_factor('CN', "US")</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>countries_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'CN'</span>, <span class="st">'US'</span>, <span class="st">"JP"</span>, <span class="st">"AU"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="dv">50000</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  X     <span class="ot">=</span> <span class="fu">cbind</span>(X, (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)<span class="sc">-</span>i,]))</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">data.frame</span>(X) <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">make.unique</span>(.), <span class="at">.cols =</span> <span class="fu">names</span>(.)[<span class="fu">duplicated</span>(<span class="fu">names</span>(.))])</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> <span class="fu">as.matrix</span>(Y)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">=</span> <span class="fl">1e-4</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>posterior_V <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X <span class="sc">+</span> <span class="fu">solve</span>(V_prior) <span class="sc">+</span> <span class="fu">diag</span>(lambda, <span class="at">nrow =</span> <span class="fu">ncol</span>(X)))</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>A_prior <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N,N)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>A_prior[<span class="dv">2</span><span class="sc">:</span>(N <span class="sc">+</span> <span class="dv">1</span>),] <span class="ot">=</span> <span class="fu">diag</span>(N)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>bayesfactor <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(countries_list), <span class="at">ncol =</span> <span class="fu">length</span>(countries_list), <span class="at">dimnames =</span> <span class="fu">list</span>(countries_list, countries_list))</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>start <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">total =</span> <span class="fu">length</span>(countries_list))</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (country_a <span class="cf">in</span> countries_list){</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (country_b <span class="cf">in</span> countries_list){  </span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>      bayesfactor[country_a, country_b] <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(<span class="fu">calc_bayes_factor</span>(country_a, country_b, S)))</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>   <span class="fu">gc</span>()</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Running Bayes factor calculation for %d iterations took: %f seconds"</span>, S, start[<span class="st">"elapsed"</span>])) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running Bayes factor calculation for 50000 iterations took: 401.001000 seconds"</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bayesfactor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            CN           US          JP          AU
CN -1570.58201     7.432428    26.90968    11.92190
US    17.89544 -1512.714188    34.73056    21.27134
JP   -13.90457   -10.155720 -1747.54612   -14.59196
AU    41.80227    25.967628    58.43271 -2363.09432</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 21%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>China</th>
<th>United States</th>
<th>Japan</th>
<th>Australia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>China</strong></td>
<td>Strong Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="even">
<td><strong>US</strong></td>
<td>No Evidence</td>
<td>Strong Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="odd">
<td><strong>Japan</strong></td>
<td>Some Evidence</td>
<td>Some Evidence</td>
<td>Strong Evidence</td>
<td>Some Evidence</td>
</tr>
<tr class="even">
<td><strong>Australia</strong></td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>Strong Evidence</td>
</tr>
</tbody>
</table>
<p><strong>2. Granger Causality Test for all countries from Q1 1994 to Q1 2020 (Pre-Covid)</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> final_df[final_df<span class="sc">$</span>Time <span class="sc">&lt;=</span><span class="fu">as.yearqtr</span>(<span class="st">'2020 Q1'</span>),<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(final_df)]</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>A_prior <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N,N)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>A_prior[<span class="dv">2</span><span class="sc">:</span>(N <span class="sc">+</span> <span class="dv">1</span>),] <span class="ot">=</span> <span class="fu">diag</span>(N)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>S_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span>, N)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>nu_prior  <span class="ot">=</span> <span class="fu">ncol</span>(data)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>S1 <span class="ot">=</span> <span class="dv">50000</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>S2 <span class="ot">=</span> <span class="dv">50000</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>) </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  X     <span class="ot">=</span> <span class="fu">cbind</span>(X, (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)<span class="sc">-</span>i,]))</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> <span class="fu">as.matrix</span>(Y)</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">=</span> <span class="fl">1e-4</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>posterior_V <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X <span class="sc">+</span> <span class="fu">solve</span>(V_prior) <span class="sc">+</span> <span class="fu">diag</span>(lambda, <span class="at">nrow =</span> <span class="fu">ncol</span>(X)))</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>posterior_samples <span class="ot">=</span> <span class="fu">BVAR_fit</span>(<span class="at">data =</span> data, <span class="at">p =</span> p, <span class="at">S1=</span> S1, <span class="at">S2 =</span> S2, <span class="at">kappa1 =</span> kappa1, <span class="at">kappa2 =</span> kappa2, <span class="at">A_prior =</span> A_prior, <span class="at">V_prior =</span> V_prior, <span class="at">S_prior =</span> S_prior, <span class="at">nu_prior =</span> nu_prior)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>posterior_samples_A <span class="ot">=</span> posterior_samples[[<span class="dv">1</span>]]</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>posterior_samples_Sigma <span class="ot">=</span> posterior_samples[[<span class="dv">2</span>]]</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>countries_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'CN'</span>, <span class="st">'US'</span>, <span class="st">"JP"</span>, <span class="st">"AU"</span>)</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="dv">50000</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">data.frame</span>(X) <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">make.unique</span>(.), <span class="at">.cols =</span> <span class="fu">names</span>(.)[<span class="fu">duplicated</span>(<span class="fu">names</span>(.))])</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>bayesfactor <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(countries_list), <span class="at">ncol =</span> <span class="fu">length</span>(countries_list), <span class="at">dimnames =</span> <span class="fu">list</span>(countries_list, countries_list))</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">total =</span> <span class="fu">length</span>(countries_list))</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>start <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (country_a <span class="cf">in</span> countries_list){</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (country_b <span class="cf">in</span> countries_list){</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>      bayesfactor[country_a, country_b] <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(<span class="fu">calc_bayes_factor</span>(country_a, country_b, S)))</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gc</span>()</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Running Bayes factor calculation for %d iterations took: %f seconds"</span>, S, start[<span class="st">"elapsed"</span>])) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running Bayes factor calculation for 50000 iterations took: 401.722000 seconds"</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bayesfactor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            CN           US          JP          AU
CN -1658.35140     7.650737    27.66237    11.82414
US    16.42595 -1326.997653    34.15129    21.06936
JP   -15.77123   -10.111587 -1497.03284   -15.49152
AU    41.34139    25.307909    56.91642 -2086.87136</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 21%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>China</th>
<th>United States</th>
<th>Japan</th>
<th>Australia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>China</strong></td>
<td>Strong Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="even">
<td><strong>US</strong></td>
<td>No Evidence</td>
<td>Strong Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="odd">
<td><strong>Japan</strong></td>
<td>Some Evidence</td>
<td>Some Evidence</td>
<td>Strong Evidence</td>
<td>Some Evidence</td>
</tr>
<tr class="even">
<td><strong>Australia</strong></td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>Strong Evidence</td>
</tr>
</tbody>
</table>
<p><strong>3. Granger Causality Test for all countries from Q1 2007 to Q1 2020 (After China joined WTO and before Covid)</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> final_df[(final_df<span class="sc">$</span>Time <span class="sc">&lt;=</span><span class="fu">as.yearqtr</span>(<span class="st">'2020 Q1'</span>))<span class="sc">&amp;</span>(final_df<span class="sc">$</span>Time <span class="sc">&gt;=</span><span class="fu">as.yearqtr</span>(<span class="st">'2007 Q1'</span>)),<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(final_df)]</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>A_prior <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N,N)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>A_prior[<span class="dv">2</span><span class="sc">:</span>(N <span class="sc">+</span> <span class="dv">1</span>),] <span class="ot">=</span> <span class="fu">diag</span>(N)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>S_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span>, N)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>nu_prior  <span class="ot">=</span> <span class="fu">ncol</span>(data)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>S1 <span class="ot">=</span> <span class="dv">50000</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>S2 <span class="ot">=</span> <span class="dv">50000</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>) </span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>  X     <span class="ot">=</span> <span class="fu">cbind</span>(X, (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)<span class="sc">-</span>i,]))</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> <span class="fu">as.matrix</span>(Y)</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">=</span> <span class="fl">1e-4</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>posterior_V <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X <span class="sc">+</span> <span class="fu">solve</span>(V_prior) <span class="sc">+</span> <span class="fu">diag</span>(lambda, <span class="at">nrow =</span> <span class="fu">ncol</span>(X)))</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>posterior_samples <span class="ot">=</span> <span class="fu">BVAR_fit</span>(<span class="at">data =</span> data, <span class="at">p =</span> p, <span class="at">S1=</span> S1, <span class="at">S2 =</span> S2, <span class="at">kappa1 =</span> kappa1, <span class="at">kappa2 =</span> kappa2, <span class="at">A_prior =</span> A_prior, <span class="at">V_prior =</span> V_prior, <span class="at">S_prior =</span> S_prior, <span class="at">nu_prior =</span> nu_prior)</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>posterior_samples <span class="ot">=</span> <span class="fu">BVAR_fit</span>(<span class="at">data =</span> data, <span class="at">p =</span> p, <span class="at">S1=</span> S1, <span class="at">S2 =</span> S2, <span class="at">kappa1 =</span> kappa1, <span class="at">kappa2 =</span> kappa2, <span class="at">A_prior =</span> A_prior, <span class="at">V_prior =</span> V_prior, <span class="at">S_prior =</span> S_prior, <span class="at">nu_prior =</span> nu_prior)</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>posterior_samples_A <span class="ot">=</span> posterior_samples[[<span class="dv">1</span>]]</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>posterior_samples_Sigma <span class="ot">=</span> posterior_samples[[<span class="dv">2</span>]]</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>countries_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'CN'</span>, <span class="st">'US'</span>, <span class="st">"JP"</span>, <span class="st">"AU"</span>)</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="dv">50000</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">data.frame</span>(X) <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">make.unique</span>(.), <span class="at">.cols =</span> <span class="fu">names</span>(.)[<span class="fu">duplicated</span>(<span class="fu">names</span>(.))])</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>bayesfactor <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(countries_list), <span class="at">ncol =</span> <span class="fu">length</span>(countries_list), <span class="at">dimnames =</span> <span class="fu">list</span>(countries_list, countries_list))</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">total =</span> <span class="fu">length</span>(countries_list))</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>start <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (country_a <span class="cf">in</span> countries_list){</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (country_b <span class="cf">in</span> countries_list){</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>      bayesfactor[country_a, country_b] <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(<span class="fu">calc_bayes_factor</span>(country_a, country_b, S)))</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gc</span>()</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Running Bayes factor calculation for %d iterations took: %f seconds"</span>, S, start[<span class="st">"elapsed"</span>])) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running Bayes factor calculation for 50000 iterations took: 406.405000 seconds"</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bayesfactor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            CN         US         JP          AU
CN -1013.69449   13.22565   34.54541    19.75187
US    10.42473 -614.39611   22.02464    12.92040
JP   -20.42617  -12.62750 -820.92075   -19.52982
AU    33.42174   21.50034   47.78869 -1062.21448</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 21%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>China</th>
<th>United States</th>
<th>Japan</th>
<th>Australia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>China</strong></td>
<td>Strong Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="even">
<td><strong>US</strong></td>
<td>No Evidence</td>
<td>Strong Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="odd">
<td><strong>Japan</strong></td>
<td>Some Evidence</td>
<td>Some Evidence</td>
<td>Strong Evidence</td>
<td>Some Evidence</td>
</tr>
<tr class="even">
<td><strong>Australia</strong></td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>Strong Evidence</td>
</tr>
</tbody>
</table>
<p>We see that Granger causality doesn’t change much according to the basic model.</p>
<p><strong>4. Granger Causality Test for all countries (excluding China) from Q1 1994 to Q3 2023</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co">#data = final_df[final_df$Time &lt;=as.yearqtr('2020 Q1'),2:ncol(final_df)]</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> final_df[<span class="fu">grep</span>(<span class="fu">c</span>(<span class="st">'CN|Time'</span>), <span class="fu">colnames</span>(final_df), <span class="at">value =</span> <span class="cn">TRUE</span>, <span class="at">invert =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>A_prior <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N,N)</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>A_prior[<span class="dv">2</span><span class="sc">:</span>(N <span class="sc">+</span> <span class="dv">1</span>),] <span class="ot">=</span> <span class="fu">diag</span>(N)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>S_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span>, N)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>nu_prior  <span class="ot">=</span> <span class="fu">ncol</span>(data)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>S1 <span class="ot">=</span> <span class="dv">50000</span></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>S2 <span class="ot">=</span> <span class="dv">50000</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>) </span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  X     <span class="ot">=</span> <span class="fu">cbind</span>(X, (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)<span class="sc">-</span>i,]))</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> <span class="fu">as.matrix</span>(Y)</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">=</span> <span class="fl">1e-4</span></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>posterior_V <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X <span class="sc">+</span> <span class="fu">solve</span>(V_prior) <span class="sc">+</span> <span class="fu">diag</span>(lambda, <span class="at">nrow =</span> <span class="fu">ncol</span>(X)))</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>posterior_samples <span class="ot">=</span> <span class="fu">BVAR_fit</span>(<span class="at">data =</span> data, <span class="at">p =</span> p, <span class="at">S1=</span> S1, <span class="at">S2 =</span> S2, <span class="at">kappa1 =</span> kappa1, <span class="at">kappa2 =</span> kappa2, <span class="at">A_prior =</span> A_prior, <span class="at">V_prior =</span> V_prior, <span class="at">S_prior =</span> S_prior, <span class="at">nu_prior =</span> nu_prior)</span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>posterior_samples_A <span class="ot">=</span> posterior_samples[[<span class="dv">1</span>]]</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>posterior_samples_Sigma <span class="ot">=</span> posterior_samples[[<span class="dv">2</span>]]</span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>countries_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'US'</span>, <span class="st">"JP"</span>, <span class="st">"AU"</span>)</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="dv">50000</span></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">data.frame</span>(X) <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">make.unique</span>(.), <span class="at">.cols =</span> <span class="fu">names</span>(.)[<span class="fu">duplicated</span>(<span class="fu">names</span>(.))])</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a>bayesfactor <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(countries_list), <span class="at">ncol =</span> <span class="fu">length</span>(countries_list), <span class="at">dimnames =</span> <span class="fu">list</span>(countries_list, countries_list))</span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">total =</span> <span class="fu">length</span>(countries_list))</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a>start <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb47-39"><a href="#cb47-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (country_a <span class="cf">in</span> countries_list){</span>
<span id="cb47-40"><a href="#cb47-40" aria-hidden="true" tabindex="-1"></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb47-41"><a href="#cb47-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (country_b <span class="cf">in</span> countries_list){</span>
<span id="cb47-42"><a href="#cb47-42" aria-hidden="true" tabindex="-1"></a>      bayesfactor[country_a, country_b] <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(<span class="fu">calc_bayes_factor</span>(country_a, country_b, S)))</span>
<span id="cb47-43"><a href="#cb47-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gc</span>()</span>
<span id="cb47-44"><a href="#cb47-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-45"><a href="#cb47-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-46"><a href="#cb47-46" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb47-47"><a href="#cb47-47" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Running Bayes factor calculation for %d iterations took: %f seconds"</span>, S, start[<span class="st">"elapsed"</span>])) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running Bayes factor calculation for 50000 iterations took: 218.616000 seconds"</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bayesfactor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            US          JP          AU
US -1699.45041    33.00494    21.32670
JP   -10.30516 -1817.04882   -14.93476
AU    26.07606    58.04532 -2882.27562</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 24%">
<col style="width: 25%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>United States</th>
<th>Japan</th>
<th>Australia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>US</strong></td>
<td>Strong Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="even">
<td><strong>Japan</strong></td>
<td>Some Evidence</td>
<td>Strong Evidence</td>
<td>Some Evidence</td>
</tr>
<tr class="odd">
<td><strong>Australia</strong></td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>Strong Evidence</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="large-bvar-model-with-ma1-gaussian-innovations" class="level2">
<h2 class="anchored" data-anchor-id="large-bvar-model-with-ma1-gaussian-innovations">4.2 Large BVAR model with MA(1) Gaussian Innovations</h2>
<section id="model-building-code-and-validation-1" class="level3">
<h3 class="anchored" data-anchor-id="model-building-code-and-validation-1">4.2.1 Model Building Code and Validation</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>BVAR_MA_fit <span class="ot">&lt;-</span> <span class="cf">function</span>(data, p, S1, S2, kappa1, kappa2, A_prior, V_prior, S_prior, nu_prior, N){</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">=</span> <span class="fu">ncol</span>(Y)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  Ty <span class="ot">=</span> <span class="fu">nrow</span>(Y)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">=</span> S1 <span class="sc">+</span> S2</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>) </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  tau <span class="ot">=</span> <span class="fl">0.15</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    X     <span class="ot">=</span> <span class="fu">cbind</span>(X, (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)<span class="sc">-</span>i,]))</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">=</span> <span class="fu">as.matrix</span>(Y)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>  nu_bar <span class="ot">=</span> Ty <span class="sc">+</span> nu_prior</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>  psi <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  H_psi <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> Ty, <span class="at">ncol =</span> Ty)</span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  O_psi <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">rep</span>(<span class="dv">1</span>, Ty))</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  O_psi[<span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>psi<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>Ty){</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    H_psi[t,t] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (t <span class="sc">&lt;</span> Ty){</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>      H_psi[t<span class="sc">+</span><span class="dv">1</span>, t] <span class="ot">=</span> psi</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>  A_posterior <span class="ot">=</span> <span class="fu">array</span>(<span class="fu">rnorm</span>(<span class="fu">prod</span>(<span class="fu">c</span>(<span class="fu">c</span>(K,N),S))),<span class="fu">c</span>(<span class="fu">c</span>(K,N),S))</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>  Sigma_posterior <span class="ot">=</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(N,N,S))</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>  Omega_posterior <span class="ot">=</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(Ty, Ty, S<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>  Omega_posterior[,,<span class="dv">1</span>] <span class="ot">=</span> H_psi <span class="sc">%*%</span> O_psi <span class="sc">%*%</span> <span class="fu">t</span>(H_psi)</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>  accept <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>  pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">total =</span> S)</span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb51-34"><a href="#cb51-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb51-35"><a href="#cb51-35" aria-hidden="true" tabindex="-1"></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb51-36"><a href="#cb51-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-37"><a href="#cb51-37" aria-hidden="true" tabindex="-1"></a>    chol_Omega <span class="ot">=</span> <span class="fu">chol</span>(Omega_posterior[,,s]) <span class="do">#########change </span></span>
<span id="cb51-38"><a href="#cb51-38" aria-hidden="true" tabindex="-1"></a>    chol_Omega_inv <span class="ot">=</span> <span class="fu">solve</span>(chol_Omega)</span>
<span id="cb51-39"><a href="#cb51-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">#V_bar = solve(t(X)%*%X + solve(V_prior))</span></span>
<span id="cb51-40"><a href="#cb51-40" aria-hidden="true" tabindex="-1"></a>    V_bar <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(chol_Omega_inv<span class="sc">%*%</span>X)<span class="sc">%*%</span>(chol_Omega_inv<span class="sc">%*%</span>X) <span class="sc">+</span> <span class="fu">solve</span>(V_prior))</span>
<span id="cb51-41"><a href="#cb51-41" aria-hidden="true" tabindex="-1"></a>    L <span class="ot">=</span> <span class="fu">t</span>(<span class="fu">chol</span>(V_bar))</span>
<span id="cb51-42"><a href="#cb51-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">#A_bar = V_bar%*%(t(X)%*%Y + solve(V_prior)%*%A_prior)</span></span>
<span id="cb51-43"><a href="#cb51-43" aria-hidden="true" tabindex="-1"></a>    A_bar <span class="ot">=</span> V_bar<span class="sc">%*%</span>(<span class="fu">t</span>(chol_Omega_inv<span class="sc">%*%</span>X)<span class="sc">%*%</span>(chol_Omega_inv<span class="sc">%*%</span>Y) <span class="sc">+</span> <span class="fu">solve</span>(V_prior)<span class="sc">%*%</span>A_prior)</span>
<span id="cb51-44"><a href="#cb51-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">#S_bar = S_prior +  t(Y)%*%Y + t(A_prior)%*%solve(V_prior)%*%A_prior - t(A_bar)%*%solve(V_bar)%*%A_bar</span></span>
<span id="cb51-45"><a href="#cb51-45" aria-hidden="true" tabindex="-1"></a>    S_bar <span class="ot">=</span> S_prior <span class="sc">+</span>  <span class="fu">t</span>(chol_Omega_inv<span class="sc">%*%</span>Y)<span class="sc">%*%</span>(chol_Omega_inv<span class="sc">%*%</span>Y) <span class="sc">+</span> <span class="fu">t</span>(A_prior)<span class="sc">%*%</span><span class="fu">solve</span>(V_prior)<span class="sc">%*%</span>A_prior <span class="sc">-</span> <span class="fu">t</span>(A_bar)<span class="sc">%*%</span><span class="fu">solve</span>(V_bar)<span class="sc">%*%</span>A_bar</span>
<span id="cb51-46"><a href="#cb51-46" aria-hidden="true" tabindex="-1"></a>    S_bar_inv <span class="ot">=</span> <span class="fu">solve</span>(S_bar)</span>
<span id="cb51-47"><a href="#cb51-47" aria-hidden="true" tabindex="-1"></a>    Sigma_posterior[,,s] <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">rWishart</span>(<span class="dv">1</span>, <span class="at">df=</span>nu_bar, <span class="at">Sigma=</span>S_bar_inv)[,,<span class="dv">1</span>])</span>
<span id="cb51-48"><a href="#cb51-48" aria-hidden="true" tabindex="-1"></a>    A_posterior[,,s]<span class="ot">=</span> A_bar <span class="sc">+</span> L<span class="sc">%*%</span>A_posterior[,,s]<span class="sc">%*%</span><span class="fu">chol</span>(Sigma_posterior[,,<span class="dv">1</span>]) <span class="do">############change </span></span>
<span id="cb51-49"><a href="#cb51-49" aria-hidden="true" tabindex="-1"></a>    <span class="do">###############MH Step    ##################################</span></span>
<span id="cb51-50"><a href="#cb51-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># psi_candidate = rnorm(n = 1, mean = psi, sd = tau)</span></span>
<span id="cb51-51"><a href="#cb51-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if(abs(psi_candidate) &gt; 1){</span></span>
<span id="cb51-52"><a href="#cb51-52" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   alpha = 0</span></span>
<span id="cb51-53"><a href="#cb51-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># }</span></span>
<span id="cb51-54"><a href="#cb51-54" aria-hidden="true" tabindex="-1"></a>    psi_candidate <span class="ot">=</span> RcppTN<span class="sc">::</span><span class="fu">rtn</span>(psi, tau, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb51-55"><a href="#cb51-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">#else{</span></span>
<span id="cb51-56"><a href="#cb51-56" aria-hidden="true" tabindex="-1"></a>    H_psi <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> Ty, <span class="at">ncol =</span> Ty)</span>
<span id="cb51-57"><a href="#cb51-57" aria-hidden="true" tabindex="-1"></a>    O_psi <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">rep</span>(<span class="dv">1</span>, Ty))</span>
<span id="cb51-58"><a href="#cb51-58" aria-hidden="true" tabindex="-1"></a>    O_psi[<span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>psi_candidate<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb51-59"><a href="#cb51-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>Ty){</span>
<span id="cb51-60"><a href="#cb51-60" aria-hidden="true" tabindex="-1"></a>      H_psi[i,i] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb51-61"><a href="#cb51-61" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (i <span class="sc">&lt;</span> Ty){</span>
<span id="cb51-62"><a href="#cb51-62" aria-hidden="true" tabindex="-1"></a>        H_psi[i<span class="sc">+</span><span class="dv">1</span>, i] <span class="ot">=</span> psi_candidate</span>
<span id="cb51-63"><a href="#cb51-63" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb51-64"><a href="#cb51-64" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb51-65"><a href="#cb51-65" aria-hidden="true" tabindex="-1"></a>    Omega_draw <span class="ot">=</span> H_psi <span class="sc">%*%</span> O_psi <span class="sc">%*%</span> <span class="fu">t</span>(H_psi)</span>
<span id="cb51-66"><a href="#cb51-66" aria-hidden="true" tabindex="-1"></a>    chol_Omega_draw <span class="ot">=</span> <span class="fu">chol</span>(Omega_draw)</span>
<span id="cb51-67"><a href="#cb51-67" aria-hidden="true" tabindex="-1"></a>    chol_Omega_draw_inv <span class="ot">=</span> <span class="fu">solve</span>(chol_Omega_draw)</span>
<span id="cb51-68"><a href="#cb51-68" aria-hidden="true" tabindex="-1"></a>    Sigma_posterior_inv <span class="ot">=</span> <span class="fu">solve</span>(Sigma_posterior[,,s])</span>
<span id="cb51-69"><a href="#cb51-69" aria-hidden="true" tabindex="-1"></a>    Likelihood_ratio <span class="ot">=</span> ((<span class="dv">1</span><span class="sc">+</span>psi_candidate<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>psi<span class="sc">^</span><span class="dv">2</span>))<span class="sc">^</span>(N<span class="sc">/</span><span class="dv">2</span>) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>(<span class="fu">tr</span>(</span>
<span id="cb51-70"><a href="#cb51-70" aria-hidden="true" tabindex="-1"></a>      Sigma_posterior_inv<span class="sc">%*%</span><span class="fu">t</span>(chol_Omega_draw_inv<span class="sc">%*%</span>(Y<span class="sc">-</span>X<span class="sc">%*%</span>A_posterior[,,s]))<span class="sc">%*%</span>(chol_Omega_draw_inv<span class="sc">%*%</span>(Y<span class="sc">-</span>X<span class="sc">%*%</span>A_posterior[,,s]))</span>
<span id="cb51-71"><a href="#cb51-71" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">-</span> <span class="fu">tr</span>(</span>
<span id="cb51-72"><a href="#cb51-72" aria-hidden="true" tabindex="-1"></a>        Sigma_posterior_inv<span class="sc">%*%</span><span class="fu">t</span>(chol_Omega_inv<span class="sc">%*%</span>(Y<span class="sc">-</span>X<span class="sc">%*%</span>A_posterior[,,s]))<span class="sc">%*%</span>(chol_Omega_inv<span class="sc">%*%</span>(Y<span class="sc">-</span>X<span class="sc">%*%</span>A_posterior[,,s]))))</span>
<span id="cb51-73"><a href="#cb51-73" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb51-74"><a href="#cb51-74" aria-hidden="true" tabindex="-1"></a>    prior_ratio <span class="ot">=</span> <span class="fu">dtruncnorm</span>(<span class="at">x =</span> psi_candidate, <span class="at">mean =</span> psi_prior, <span class="at">sd =</span> Vpsi_prior)<span class="sc">/</span><span class="fu">dtruncnorm</span>(<span class="at">x =</span> psi, <span class="at">mean =</span> psi_prior, <span class="at">sd =</span> Vpsi_prior)</span>
<span id="cb51-75"><a href="#cb51-75" aria-hidden="true" tabindex="-1"></a>    <span class="co">#proposal_ratio = dnorm(x = psi, mean = psi_candidate, sd = tau)/dnorm(x=psi_candidate, mean = psi, sd = tau)</span></span>
<span id="cb51-76"><a href="#cb51-76" aria-hidden="true" tabindex="-1"></a>    proposal_ratio <span class="ot">=</span> RcppTN<span class="sc">::</span><span class="fu">dtn</span>(<span class="at">.x =</span> psi, <span class="at">.mean =</span> psi_candidate, <span class="at">.sd =</span> tau, <span class="at">.low =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">.high =</span> <span class="dv">1</span>) <span class="sc">/</span> RcppTN<span class="sc">::</span><span class="fu">dtn</span>(<span class="at">.x =</span> psi_candidate, <span class="at">.mean =</span> psi, <span class="at">.sd =</span> tau, <span class="at">.low =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">.high =</span> <span class="dv">1</span>)</span>
<span id="cb51-77"><a href="#cb51-77" aria-hidden="true" tabindex="-1"></a>    alpha <span class="ot">=</span> <span class="fu">min</span>(<span class="dv">1</span>, Likelihood_ratio, prior_ratio, proposal_ratio)</span>
<span id="cb51-78"><a href="#cb51-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">#}</span></span>
<span id="cb51-79"><a href="#cb51-79" aria-hidden="true" tabindex="-1"></a>    u <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>)</span>
<span id="cb51-80"><a href="#cb51-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (u <span class="sc">&lt;=</span> alpha){</span>
<span id="cb51-81"><a href="#cb51-81" aria-hidden="true" tabindex="-1"></a>      accept <span class="ot">=</span> accept <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb51-82"><a href="#cb51-82" aria-hidden="true" tabindex="-1"></a>      psi <span class="ot">=</span> psi_candidate</span>
<span id="cb51-83"><a href="#cb51-83" aria-hidden="true" tabindex="-1"></a>      Omega_posterior[,,s<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> Omega_draw</span>
<span id="cb51-84"><a href="#cb51-84" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb51-85"><a href="#cb51-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb51-86"><a href="#cb51-86" aria-hidden="true" tabindex="-1"></a>      Omega_posterior[,,s<span class="sc">+</span><span class="dv">1</span>] <span class="ot">=</span> Omega_posterior[,,s]}</span>
<span id="cb51-87"><a href="#cb51-87" aria-hidden="true" tabindex="-1"></a>    <span class="do">##################################################    #####</span></span>
<span id="cb51-88"><a href="#cb51-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-89"><a href="#cb51-89" aria-hidden="true" tabindex="-1"></a>  A_posterior <span class="ot">=</span> A_posterior[,,(S1<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(S1<span class="sc">+</span>S2)]</span>
<span id="cb51-90"><a href="#cb51-90" aria-hidden="true" tabindex="-1"></a>  Sigma_posterior <span class="ot">=</span> Sigma_posterior[,,(S1<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(S1<span class="sc">+</span>S2)]</span>
<span id="cb51-91"><a href="#cb51-91" aria-hidden="true" tabindex="-1"></a>  Omega_posterior <span class="ot">=</span> Omega_posterior[,,(S1<span class="sc">+</span><span class="dv">2</span>)<span class="sc">:</span>(S1<span class="sc">+</span>S2<span class="sc">+</span><span class="dv">1</span>)]</span>
<span id="cb51-92"><a href="#cb51-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"acceptance rate of the Metropolis Hasting Step: "</span>)</span>
<span id="cb51-93"><a href="#cb51-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(accept<span class="sc">/</span>S)</span>
<span id="cb51-94"><a href="#cb51-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(A_posterior, Sigma_posterior, Omega_posterior))</span>
<span id="cb51-95"><a href="#cb51-95" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.1</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(random_walk_sample)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>A_prior     <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N, <span class="at">ncol =</span> N)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>V_prior     <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>S_prior     <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span>, N)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>nu_prior    <span class="ot">=</span> <span class="fu">ncol</span>(random_walk_sample)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>S1 <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>S2 <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>vh0_prior <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>sh0_prior <span class="ot">=</span> <span class="fl">0.04</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>rho_prior <span class="ot">=</span> <span class="fl">0.9</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>Vrho_prior <span class="ot">=</span> <span class="fl">0.04</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>psi_prior <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>Vpsi_prior <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>start <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  posterior_samples_MA <span class="ot">=</span> <span class="fu">BVAR_MA_fit</span>(<span class="at">data =</span> random_walk_sample, <span class="at">p =</span> p, <span class="at">S1=</span> S1, <span class="at">S2 =</span> S2, <span class="at">kappa1 =</span> kappa1, <span class="at">kappa2 =</span> kappa2, <span class="at">A_prior =</span> A_prior, <span class="at">V_prior =</span> V_prior, <span class="at">S_prior =</span> S_prior, <span class="at">nu_prior =</span> nu_prior, N)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "acceptance rate of the Metropolis Hasting Step: "
[1] 0.1915</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Fit MA BVAR on 1000 bi-variate random walk for %d iterations took: %f seconds"</span>, (S1<span class="sc">+</span>S2), start[<span class="st">"elapsed"</span>])) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fit MA BVAR on 1000 bi-variate random walk for 2000 iterations took: 3885.405000 seconds"</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>posterior_samples_A_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">1</span>]]</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>posterior_samples_Sigma_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">2</span>]]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>posterior_samples_Omega_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">3</span>]]</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior mean of autoregressive parameter:')</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_A_MA,1:2,mean),3)</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior standard deviation of autoregressive parameter:')</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_A_MA,1:2,sd),3)</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior mean of row specific covariance matrix:')</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_Sigma_MA,1:2,mean),3)</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior standard deviation of row specific covariance matrix:')</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_Sigma_MA,1:2,sd),3)</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior mean of column specific covariance matrix (first 10 rows and columns):')</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_Omega_MA[1:10, 1:10,],1:2,mean),3)</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior standard deviation of column specific covariance matrix (first 10 rows and columns):')</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_Omega_MA[1:10, 1:10,],1:2,sd),3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="fitted-models-1" class="level4">
<h4 class="anchored" data-anchor-id="fitted-models-1"><strong>4.2.2.1 Fitted Models</strong></h4>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.02</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> final_df[,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(final_df)]</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>A_prior <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,<span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N,N)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>A_prior[<span class="dv">2</span><span class="sc">:</span>(N <span class="sc">+</span> <span class="dv">1</span>),] <span class="ot">=</span> <span class="fu">diag</span>(N)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>S_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span>, N)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>nu_prior  <span class="ot">=</span> <span class="fu">ncol</span>(data)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> final_df[,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(final_df)]</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>S1 <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>S2 <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>vh0_prior <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>sh0_prior <span class="ot">=</span> <span class="fl">0.04</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>rho_prior <span class="ot">=</span> <span class="fl">0.9</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>Vrho_prior <span class="ot">=</span> <span class="fl">0.04</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>psi_prior <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>Vpsi_prior <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>fstart <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>  posterior_samples_MA <span class="ot">=</span> <span class="fu">BVAR_MA_fit</span>(<span class="at">data =</span> data, <span class="at">p =</span> p, <span class="at">S1=</span> S1, <span class="at">S2 =</span> S2, <span class="at">kappa1 =</span> kappa1, <span class="at">kappa2 =</span> kappa2, <span class="at">A_prior =</span> A_prior, <span class="at">V_prior =</span> V_prior, <span class="at">S_prior =</span> S_prior, <span class="at">nu_prior =</span> nu_prior, N)</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "acceptance rate of the Metropolis Hasting Step: "
[1] 0.2449</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Fit MA BVAR on data for %d iterations took: %f seconds"</span>, (S1<span class="sc">+</span>S2), start[<span class="st">"elapsed"</span>])) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fit MA BVAR on data for 10000 iterations took: 3885.405000 seconds"</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>posterior_samples_A_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">1</span>]]</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>posterior_samples_Sigma_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">2</span>]]</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>posterior_samples_Omega_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">3</span>]]</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior mean of autoregressive parameter:')</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_A_MA,1:2,mean),3)</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior standard deviation of autoregressive parameter:')</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_A_MA,1:2,sd),3)</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior mean of row specific covariance matrix:')</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_Sigma_MA,1:2,mean),3)</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior standard deviation of row specific covariance matrix:')</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_Sigma_MA,1:2,sd),3)</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior mean of column specific covariance matrix (first 10 rows and columns):')</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_Omega_MA[1:10, 1:10,],1:2,mean),3)</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co"># print('Posterior standard deviation of column specific covariance matrix (first 10 rows and columns):')</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="co"># round(apply(posterior_samples_Omega_MA[1:10, 1:10,],1:2,sd),3)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="prediction-plots-1" class="level4">
<h4 class="anchored" data-anchor-id="prediction-plots-1"><strong>4.2.2.2 Prediction Plots </strong></h4>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>BVAR_MA_predict <span class="ot">=</span> <span class="cf">function</span>(posterior_samples_A_MA, posterior_samples_Sigma_MA ,posterior_samples_Omega_MA,  data, h){</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">=</span> <span class="fu">dim</span>(posterior_samples_A_MA)[<span class="dv">3</span>]</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">=</span> <span class="fu">dim</span>(posterior_samples_A_MA)[<span class="dv">2</span>]</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">=</span> (<span class="fu">dim</span>(posterior_samples_A_MA)[<span class="dv">1</span>] <span class="sc">-</span><span class="dv">1</span>) <span class="sc">/</span> N</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#last p observations </span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> Y[(<span class="fu">nrow</span>(Y)<span class="sc">-</span>p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(Y),]</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># reverse the order t-p t-(p-1)...</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> x[p<span class="sc">:</span><span class="dv">1</span>,]</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  Y_h   <span class="ot">=</span> <span class="fu">array</span>(<span class="cn">NA</span>,<span class="fu">c</span>(h,N,S))</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>    A     <span class="ot">=</span> posterior_samples_A_MA[,,s]</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="ot">=</span> posterior_samples_Sigma_MA[,,s]</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>    Omega <span class="ot">=</span> posterior_samples_Omega_MA[]</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>    N <span class="ot">=</span> <span class="fu">ncol</span>(A)</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> (<span class="fu">nrow</span>(A) <span class="sc">-</span><span class="dv">1</span>) <span class="sc">/</span> N</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>    Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>    x  <span class="ot">=</span> Y[(<span class="fu">nrow</span>(Y)<span class="sc">-</span>p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(Y),]</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">=</span> x[p<span class="sc">:</span><span class="dv">1</span>,]</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>h){</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>      <span class="co">#x_{{t+1}= (1 y_t y_{t-1},... y_{t-p+1})</span></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>      x_T               <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,purrr<span class="sc">::</span><span class="fu">as_vector</span>(<span class="fu">t</span>(x)))</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>      <span class="co">#y_t+h = mvnnorm(1, x_t%*%A)</span></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>      Period_Y               <span class="ot">=</span> mvtnorm<span class="sc">::</span><span class="fu">rmvnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> x_T<span class="sc">%*%</span>A, <span class="at">sigma=</span>Sigma)</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">colnames</span>(Period_Y) <span class="ot">=</span> <span class="fu">colnames</span>(x)</span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a>      x            <span class="ot">=</span> <span class="fu">rbind</span>(Period_Y,x[<span class="dv">1</span><span class="sc">:</span>(p<span class="dv">-1</span>),])</span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a>      Y_h[i,,s]   <span class="ot">=</span> Period_Y[<span class="dv">1</span><span class="sc">:</span>N]</span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Y_h)</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> final_df[,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(final_df)]</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>h <span class="ot">=</span> <span class="dv">8</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>start <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  BVAR_MA_prediction <span class="ot">=</span> <span class="fu">BVAR_MA_predict</span>(<span class="at">posterior_samples_A_MA =</span> posterior_samples_A_MA, </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">posterior_samples_Sigma_MA =</span> posterior_samples_Sigma_MA,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">posterior_samples_Omega_MA =</span> posterior_samples_Omega_MA,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">data =</span> data, <span class="at">h =</span> h)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>}) </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Predict %d periods ahead MA BVAR on data for %d iterations took: %f seconds"</span>, h, S1 <span class="sc">+</span> S2, start[[<span class="st">"elapsed"</span>]]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Predict 8 periods ahead MA BVAR on data for 10000 iterations took: 278.933000 seconds"</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="test-for-granger-causality-2" class="level4">
<h4 class="anchored" data-anchor-id="test-for-granger-causality-2"><strong>4.2.2.3 Test for Granger Causality</strong></h4>
<p><strong>1. Granger Causality Test for all countries from Q1 1994 to Q3 2023</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>) </span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  X     <span class="ot">=</span> <span class="fu">cbind</span>(X, (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)<span class="sc">-</span>i,]))</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">=</span> <span class="fl">1e-4</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">data.frame</span>(X) <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">make.unique</span>(.), <span class="at">.cols =</span> <span class="fu">names</span>(.)[<span class="fu">duplicated</span>(<span class="fu">names</span>(.))])</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="do">##########</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>calc_bayes_factor_MA <span class="ot">=</span> <span class="cf">function</span>(country1, country2, posterior_samples_A_MA, posterior_samples_Sigma_MA, posterior_samples_Omega_MA, v_prior, S_prior, A_prior, nu_prior, S) {</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a><span class="co">#S cannot exceed the number of posterior samples generated</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">=</span> <span class="fu">min</span>(S, <span class="fu">dim</span>(posterior_samples_Sigma_MA)[<span class="dv">3</span>])</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>  ratio_list <span class="ot">=</span> <span class="fu">list</span>(<span class="at">dim =</span> S)</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>  var_list <span class="ot">=</span> <span class="fu">colnames</span>(data)</span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>  country1 <span class="ot">=</span> var_list[<span class="fu">grepl</span>(country1, var_list)]</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>  var_list <span class="ot">=</span> <span class="fu">colnames</span>(X)</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>  country2 <span class="ot">=</span> var_list[<span class="fu">grepl</span>(country2, var_list)]</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set dim names for V</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(V_prior) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(X), <span class="fu">colnames</span>(X))</span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set this in case we want to test less samples than the number of posterior samples generated</span></span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>  total_S <span class="ot">=</span> <span class="fu">dim</span>(posterior_samples_Sigma_MA)[<span class="dv">3</span>]</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#set dim names for A_prior</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(A_prior) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(X), <span class="fu">colnames</span>(data))</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>S){</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">#calculate prior probability</span></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>    A_prior_test <span class="ot">=</span> A_prior[country2, country1]</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>    prior_Sigma <span class="ot">=</span> MCMCpack<span class="sc">::</span><span class="fu">riwish</span>(<span class="at">v =</span> nu_prior, <span class="at">S =</span> S_prior)</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dimnames</span>(prior_Sigma) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(data), <span class="fu">colnames</span>(data))</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Sigma is row specific covariance matrix</span></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>    prior_Sigma_test <span class="ot">=</span> prior_Sigma[<span class="fu">colnames</span>(A_prior_test),<span class="fu">colnames</span>(A_prior_test)]</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># V is the column specific covariance matrix</span></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a>    V_prior_test <span class="ot">=</span> V_prior[<span class="fu">rownames</span>(A_prior_test), <span class="fu">rownames</span>(A_prior_test)]</span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>    Q_prior <span class="ot">=</span> <span class="fu">kronecker</span>(prior_Sigma_test, V_prior_test)</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>    prior_prob <span class="ot">=</span>  mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(<span class="fu">nrow</span>(A_prior_test), <span class="fu">ncol</span>(A_prior_test)))), </span>
<span id="cb65-46"><a href="#cb65-46" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">c</span>(A_prior_test), </span>
<span id="cb65-47"><a href="#cb65-47" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">sigma =</span> Q_prior, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-48"><a href="#cb65-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">#calculate posterior probability</span></span>
<span id="cb65-49"><a href="#cb65-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">#select the s sampled posterior A</span></span>
<span id="cb65-50"><a href="#cb65-50" aria-hidden="true" tabindex="-1"></a>    <span class="co">#select mean matrix</span></span>
<span id="cb65-51"><a href="#cb65-51" aria-hidden="true" tabindex="-1"></a>    A_0_mat_full <span class="ot">=</span> posterior_samples_A_MA[,,s]</span>
<span id="cb65-52"><a href="#cb65-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dimnames</span>(A_0_mat_full) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(X), <span class="fu">colnames</span>(data))</span>
<span id="cb65-53"><a href="#cb65-53" aria-hidden="true" tabindex="-1"></a>    row_names <span class="ot">=</span> <span class="fu">rownames</span>(A_0_mat_full)</span>
<span id="cb65-54"><a href="#cb65-54" aria-hidden="true" tabindex="-1"></a>    A_0_mat_posterior <span class="ot">=</span> A_0_mat_full[country2, country1]</span>
<span id="cb65-55"><a href="#cb65-55" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> <span class="fu">c</span>(posterior_samples_A_MA[,,(total_S <span class="sc">-</span> s <span class="sc">+</span> <span class="dv">1</span>)])</span>
<span id="cb65-56"><a href="#cb65-56" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> <span class="fu">array</span>(M, <span class="at">dim =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(A_0_mat_full), <span class="fu">ncol</span>(A_0_mat_full)))</span>
<span id="cb65-57"><a href="#cb65-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dimnames</span>(M) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(X), <span class="fu">colnames</span>(data))</span>
<span id="cb65-58"><a href="#cb65-58" aria-hidden="true" tabindex="-1"></a>    M <span class="ot">=</span> M[country2, country1]</span>
<span id="cb65-59"><a href="#cb65-59" aria-hidden="true" tabindex="-1"></a>    <span class="co">#select row specific covariance matrix</span></span>
<span id="cb65-60"><a href="#cb65-60" aria-hidden="true" tabindex="-1"></a>    posteior_sigma_test <span class="ot">=</span> posterior_samples_Sigma_MA[,,(total_S <span class="sc">-</span> s <span class="sc">+</span> <span class="dv">1</span>)]</span>
<span id="cb65-61"><a href="#cb65-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dimnames</span>(posteior_sigma_test) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(data), <span class="fu">colnames</span>(data))</span>
<span id="cb65-62"><a href="#cb65-62" aria-hidden="true" tabindex="-1"></a>    posteior_sigma_test <span class="ot">=</span> posteior_sigma_test[<span class="fu">colnames</span>(A_0_mat_posterior),<span class="fu">colnames</span>(A_0_mat_posterior)]</span>
<span id="cb65-63"><a href="#cb65-63" aria-hidden="true" tabindex="-1"></a>    <span class="co">#select column specific covariance matrix</span></span>
<span id="cb65-64"><a href="#cb65-64" aria-hidden="true" tabindex="-1"></a>    posterior_V <span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X) <span class="sc">%*%</span> posterior_samples_Omega_MA[,,(total_S <span class="sc">-</span> s <span class="sc">+</span><span class="dv">1</span>)] <span class="sc">%*%</span> X <span class="sc">+</span> <span class="fu">solve</span>(V_prior) <span class="sc">+</span> <span class="fu">diag</span>(lambda, <span class="fu">ncol</span>(X)))</span>
<span id="cb65-65"><a href="#cb65-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dimnames</span>(posterior_V) <span class="ot">=</span> <span class="fu">list</span>(<span class="fu">colnames</span>(X), <span class="fu">colnames</span>(X))</span>
<span id="cb65-66"><a href="#cb65-66" aria-hidden="true" tabindex="-1"></a>    posterior_V_test <span class="ot">=</span> posterior_V[<span class="fu">rownames</span>(A_0_mat_posterior), <span class="fu">rownames</span>(A_0_mat_posterior)]</span>
<span id="cb65-67"><a href="#cb65-67" aria-hidden="true" tabindex="-1"></a>    Q <span class="ot">=</span> <span class="fu">kronecker</span>(posteior_sigma_test, posterior_V_test)</span>
<span id="cb65-68"><a href="#cb65-68" aria-hidden="true" tabindex="-1"></a>    posterior_prob <span class="ot">=</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fu">array</span>(<span class="dv">0</span>, <span class="at">dim=</span><span class="fu">c</span>(<span class="fu">nrow</span>(A_0_mat_posterior), <span class="fu">ncol</span>(A_0_mat_posterior)))), <span class="at">mean =</span> <span class="fu">c</span>(M), <span class="at">sigma =</span> Q, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb65-69"><a href="#cb65-69" aria-hidden="true" tabindex="-1"></a>    ratio_list[s] <span class="ot">=</span> posterior_prob <span class="sc">-</span> prior_prob</span>
<span id="cb65-70"><a href="#cb65-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb65-71"><a href="#cb65-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ratio_list)</span>
<span id="cb65-72"><a href="#cb65-72" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>bf_ma <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>posterior_samples_A_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">1</span>]]</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>posterior_samples_Sigma_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">2</span>]]</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>posterior_samples_Omega_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">3</span>]]</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>countries_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'CN'</span>, <span class="st">'US'</span>, <span class="st">"JP"</span>, <span class="st">"AU"</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">data.frame</span>(X) <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">make.unique</span>(.), <span class="at">.cols =</span> <span class="fu">names</span>(.)[<span class="fu">duplicated</span>(<span class="fu">names</span>(.))])</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>bayesfactor_MA <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(countries_list), <span class="at">ncol =</span> <span class="fu">length</span>(countries_list), <span class="at">dimnames =</span> <span class="fu">list</span>(countries_list, countries_list))</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">total =</span> <span class="fu">length</span>(countries_list))</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>start <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (country_a <span class="cf">in</span> countries_list){</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (country_b <span class="cf">in</span> countries_list){</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">=</span> i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>      bayesfactor_MA[country_a, country_b] <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(<span class="fu">calc_bayes_factor_MA</span>(country_a, country_b,posterior_samples_A_MA, posterior_samples_Sigma_MA, posterior_samples_Omega_MA, V_prior, S_prior, A_prior, nu_prior, S)))</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gc</span>()</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Running Bayes factor calculation for %d iterations took: %f seconds"</span>, S, start[<span class="st">"elapsed"</span>])) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running Bayes factor calculation for 5000 iterations took: 105.346000 seconds"</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bayesfactor_MA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           CN           US          JP          AU
CN -989.16224    21.381086    51.67024    30.72569
US   38.07576 -1500.305271    48.82996    34.42572
JP    9.74343     3.883998 -1559.50719     4.85254
AU   64.49178    40.120722    79.87182 -2095.26055</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 21%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>China</th>
<th>United States</th>
<th>Japan</th>
<th>Australia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>China</strong></td>
<td>Strong Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="even">
<td><strong>US</strong></td>
<td>No Evidence</td>
<td>Strong Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="odd">
<td><strong>Japan</strong></td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>Strong Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="even">
<td><strong>Australia</strong></td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>Strong Evidence</td>
</tr>
</tbody>
</table>
<p><strong>2. Granger Causality Test for all countries from Q1 1994 to Q1 2020 (Pre-Covid)</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> final_df[final_df<span class="sc">$</span>Time <span class="sc">&lt;=</span> <span class="st">'2020 Q1'</span>, <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(final_df)]</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>) </span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  X     <span class="ot">=</span> <span class="fu">cbind</span>(X, (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)<span class="sc">-</span>i,]))</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">=</span> <span class="fl">1e-4</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>S1 <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>S2 <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>fstart <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>  posterior_samples_MA <span class="ot">=</span> <span class="fu">BVAR_MA_fit</span>(<span class="at">data =</span> data, <span class="at">p =</span> p, <span class="at">S1=</span> S1, <span class="at">S2 =</span> S2, <span class="at">kappa1 =</span> kappa1, <span class="at">kappa2 =</span> kappa2, <span class="at">A_prior =</span> A_prior, <span class="at">V_prior =</span> V_prior, <span class="at">S_prior =</span> S_prior, <span class="at">nu_prior =</span> nu_prior, N)</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "acceptance rate of the Metropolis Hasting Step: "
[1] 0.2836</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Fit MA BVAR on data for %d iterations took: %f seconds"</span>, (S1<span class="sc">+</span>S2), start[<span class="st">"elapsed"</span>])) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fit MA BVAR on data for 10000 iterations took: 105.346000 seconds"</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>posterior_samples_A_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">1</span>]]</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>posterior_samples_Sigma_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">2</span>]]</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>posterior_samples_Omega_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">3</span>]]</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>) </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  X     <span class="ot">=</span> <span class="fu">cbind</span>(X, (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)<span class="sc">-</span>i,]))</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">data.frame</span>(X) <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">make.unique</span>(.), <span class="at">.cols =</span> <span class="fu">names</span>(.)[<span class="fu">duplicated</span>(<span class="fu">names</span>(.))])</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>countries_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'CN'</span>, <span class="st">'US'</span>, <span class="st">"JP"</span>, <span class="st">"AU"</span>)</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>bf_ma <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>bayesfactor_MA <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(countries_list), <span class="at">ncol =</span> <span class="fu">length</span>(countries_list), <span class="at">dimnames =</span> <span class="fu">list</span>(countries_list, countries_list))</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">total =</span> <span class="fu">length</span>(countries_list))</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>start <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb74-17"><a href="#cb74-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (country_a <span class="cf">in</span> countries_list){</span>
<span id="cb74-18"><a href="#cb74-18" aria-hidden="true" tabindex="-1"></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb74-19"><a href="#cb74-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (country_b <span class="cf">in</span> countries_list){</span>
<span id="cb74-20"><a href="#cb74-20" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">=</span> i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb74-21"><a href="#cb74-21" aria-hidden="true" tabindex="-1"></a>      bayesfactor_MA[country_a, country_b] <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(<span class="fu">calc_bayes_factor_MA</span>(country_a, country_b,posterior_samples_A_MA, posterior_samples_Sigma_MA, posterior_samples_Omega_MA, V_prior, S_prior, A_prior, nu_prior, S)))</span>
<span id="cb74-22"><a href="#cb74-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gc</span>()</span>
<span id="cb74-23"><a href="#cb74-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb74-24"><a href="#cb74-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb74-25"><a href="#cb74-25" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb74-26"><a href="#cb74-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Running Bayes factor calculation for %d iterations took: %f seconds"</span>, S, start[<span class="st">"elapsed"</span>])) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running Bayes factor calculation for 5000 iterations took: 98.312000 seconds"</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bayesfactor_MA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            CN           US          JP           AU
CN -1291.25334     4.453871    24.57865     6.792789
US    15.01675 -1330.320131    34.18523    22.083329
JP   -14.20843    -9.545975 -1435.93724   -14.467556
AU    40.69432    24.268737    55.56684 -2010.133978</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 21%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>China</th>
<th>United States</th>
<th>Japan</th>
<th>Australia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>China</strong></td>
<td>Strong Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="even">
<td><strong>US</strong></td>
<td>No Evidence</td>
<td>Strong Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="odd">
<td><strong>Japan</strong></td>
<td>Some evidence</td>
<td>Some evidence</td>
<td>Strong Evidence</td>
<td>Some evidence</td>
</tr>
<tr class="even">
<td><strong>Australia</strong></td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>Strong Evidence</td>
</tr>
</tbody>
</table>
<p><strong>3. Granger Causality Test for all countries from Q1 2007 to Q1 2020 (After China joined the WTO and after Covid)</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> final_df[(final_df<span class="sc">$</span>Time <span class="sc">&gt;=</span> <span class="st">'2007 Q1'</span>) <span class="sc">&amp;</span> (final_df<span class="sc">$</span>Time <span class="sc">&lt;=</span> <span class="st">'2020 Q1'</span>), <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(final_df)]</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="co">#data = final_df[,2:ncol(final_df)]</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>) </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  X     <span class="ot">=</span> <span class="fu">cbind</span>(X, (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)<span class="sc">-</span>i,]))</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N</span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">=</span> <span class="fl">1e-4</span></span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>S1 <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>S2 <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>fstart <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>  posterior_samples_MA <span class="ot">=</span> <span class="fu">BVAR_MA_fit</span>(<span class="at">data =</span> data, <span class="at">p =</span> p, <span class="at">S1=</span> S1, <span class="at">S2 =</span> S2, <span class="at">kappa1 =</span> kappa1, <span class="at">kappa2 =</span> kappa2, <span class="at">A_prior =</span> A_prior, <span class="at">V_prior =</span> V_prior, <span class="at">S_prior =</span> S_prior, <span class="at">nu_prior =</span> nu_prior, N)</span>
<span id="cb78-20"><a href="#cb78-20" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "acceptance rate of the Metropolis Hasting Step: "
[1] 0.4305</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>posterior_samples_A_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">1</span>]]</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>posterior_samples_Sigma_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">2</span>]]</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>posterior_samples_Omega_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">3</span>]]</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">data.frame</span>(X) <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">make.unique</span>(.), <span class="at">.cols =</span> <span class="fu">names</span>(.)[<span class="fu">duplicated</span>(<span class="fu">names</span>(.))])</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>countries_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'CN'</span>, <span class="st">'US'</span>, <span class="st">"JP"</span>, <span class="st">"AU"</span>)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>bf_ma <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>bayesfactor_MA <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(countries_list), <span class="at">ncol =</span> <span class="fu">length</span>(countries_list), <span class="at">dimnames =</span> <span class="fu">list</span>(countries_list, countries_list))</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">total =</span> <span class="fu">length</span>(countries_list))</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>start <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (country_a <span class="cf">in</span> countries_list){</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (country_b <span class="cf">in</span> countries_list){</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">=</span> i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>      bayesfactor_MA[country_a, country_b] <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(<span class="fu">calc_bayes_factor_MA</span>(country_a, country_b,posterior_samples_A_MA, posterior_samples_Sigma_MA, posterior_samples_Omega_MA, v_prior, S_prior, A_prior, nu_prior, S)))</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gc</span>()</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Running Bayes factor calculation for %d iterations took: %f seconds"</span>, S, start[<span class="st">"elapsed"</span>])) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running Bayes factor calculation for 5000 iterations took: 78.299000 seconds"</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bayesfactor_MA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            CN          US         JP          AU
CN -1006.95740    8.628844   27.98486    13.20351
US    12.63275 -615.271480   23.92370    14.99283
JP   -17.18085  -10.491872 -785.93118   -16.30192
AU    32.09303   19.954793   46.70976 -1063.42898</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 13%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 21%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>China</th>
<th>United States</th>
<th>Japan</th>
<th>Australia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>China</strong></td>
<td>Strong Evidence</td>
<td>No Evidence</td>
<td>Weak evidence</td>
<td>No Evidence</td>
</tr>
<tr class="even">
<td><strong>US</strong></td>
<td>No Evidence</td>
<td>Strong Evidence</td>
<td>Strong evidence</td>
<td>No Evidence</td>
</tr>
<tr class="odd">
<td><strong>Japan</strong></td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>Strong Evidence</td>
<td>No Evidence</td>
</tr>
<tr class="even">
<td><strong>Australia</strong></td>
<td>No Evidence</td>
<td>No Evidence</td>
<td>Strong evidence</td>
<td>Strong Evidence</td>
</tr>
</tbody>
</table>
<p><strong>4. Granger Causality Test for all countries from Q1 1994 to Q1 2020 (Pre-Covid)</strong></p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> final_df[<span class="fu">grep</span>(<span class="st">"CN|Time"</span>, <span class="fu">colnames</span>(final_df), <span class="at">value =</span> <span class="cn">TRUE</span>, <span class="at">invert =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">=</span> (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data),])</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>) </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  X     <span class="ot">=</span> <span class="fu">cbind</span>(X, (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)<span class="sc">-</span>i,]))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="fu">ncol</span>(data)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>K <span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>kappa1 <span class="ot">=</span> <span class="fl">0.2</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>kappa2 <span class="ot">=</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>V_prior <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">=</span> <span class="fl">1e-4</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>S1 <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>S2 <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>A_prior     <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="dv">1</span><span class="sc">+</span>p<span class="sc">*</span>N, <span class="at">ncol =</span> N)</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>V_prior     <span class="ot">=</span> <span class="fu">diag</span>(<span class="fu">c</span>(kappa2,kappa1<span class="sc">*</span>((<span class="dv">1</span><span class="sc">:</span>p)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">2</span>))<span class="sc">%x%</span><span class="fu">rep</span>(<span class="dv">1</span>,N)))</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>S_prior     <span class="ot">=</span> <span class="fu">diag</span>(<span class="dv">1</span>, N)</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>nu_prior    <span class="ot">=</span> N<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>fstart <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>  posterior_samples_MA <span class="ot">=</span> <span class="fu">BVAR_MA_fit</span>(<span class="at">data =</span> data, <span class="at">p =</span> p, <span class="at">S1=</span> S1, <span class="at">S2 =</span> S2, <span class="at">kappa1 =</span> kappa1, <span class="at">kappa2 =</span> kappa2, <span class="at">A_prior =</span> A_prior, <span class="at">V_prior =</span> V_prior, <span class="at">S_prior =</span> S_prior, <span class="at">nu_prior =</span> nu_prior, N)</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "acceptance rate of the Metropolis Hasting Step: "
[1] 0.2262</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Fit MA BVAR on data for %d iterations took: %f seconds"</span>, (S1<span class="sc">+</span>S2), start[<span class="st">"elapsed"</span>])) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Fit MA BVAR on data for 10000 iterations took: 78.299000 seconds"</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>posterior_samples_A_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">1</span>]]</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>posterior_samples_Sigma_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">2</span>]]</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>posterior_samples_Omega_MA <span class="ot">=</span> posterior_samples_MA[[<span class="dv">3</span>]]</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(Y),<span class="dv">1</span>) </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p){</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  X     <span class="ot">=</span> <span class="fu">cbind</span>(X, (data[(p<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span><span class="fu">nrow</span>(data)<span class="sc">-</span>i,]))</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="dv">5000</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">data.frame</span>(X) <span class="sc">%&gt;%</span> <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">make.unique</span>(.), <span class="at">.cols =</span> <span class="fu">names</span>(.)[<span class="fu">duplicated</span>(<span class="fu">names</span>(.))])</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>X <span class="ot">=</span> <span class="fu">as.matrix</span>(X)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>countries_list <span class="ot">=</span> <span class="fu">c</span>(<span class="st">'US'</span>, <span class="st">"JP"</span>, <span class="st">"AU"</span>)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>bf_ma <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>bayesfactor_MA <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(countries_list), <span class="at">ncol =</span> <span class="fu">length</span>(countries_list), <span class="at">dimnames =</span> <span class="fu">list</span>(countries_list, countries_list))</span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>pb <span class="ot">&lt;-</span> progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">total =</span> <span class="fu">length</span>(countries_list))</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>start <span class="ot">=</span> <span class="fu">system.time</span>({</span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (country_a <span class="cf">in</span> countries_list){</span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (country_b <span class="cf">in</span> countries_list){</span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>      i <span class="ot">=</span> i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>      bayesfactor_MA[country_a, country_b] <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(<span class="fu">calc_bayes_factor_MA</span>(country_a, country_b,posterior_samples_A_MA, posterior_samples_Sigma_MA, posterior_samples_Omega_MA, V_prior, S_prior, A_prior, nu_prior, S)))</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gc</span>()</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">sprintf</span>(<span class="st">"Running Bayes factor calculation for %d iterations took: %f seconds"</span>, S, start[<span class="st">"elapsed"</span>])) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Running Bayes factor calculation for 5000 iterations took: 43.252000 seconds"</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bayesfactor_MA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>            US          JP        AU
US  -6.2751557    8.003204 -25.04430
JP -19.7414944 -847.093834 -25.07330
AU  -0.6507542  -65.555830 -38.87381</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 24%">
<col style="width: 25%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>United States</th>
<th>Japan</th>
<th>Australia</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>US</strong></td>
<td>Some Evidence</td>
<td>No Evidence</td>
<td>Some Evidence</td>
</tr>
<tr class="even">
<td><strong>Japan</strong></td>
<td>Some Evidence</td>
<td>Strong Evidence</td>
<td>Some Evidence</td>
</tr>
<tr class="odd">
<td><strong>Australia</strong></td>
<td>Some Evidence</td>
<td>No Evidence</td>
<td>Strong Evidence</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>5. Conclusion</h1>
<p>Using the <strong>standard BVAR model</strong> with a Savage-Dickey ratio analysis, our findings suggest some evidence that the macroeconomic indicators of China, the US, and Australia Granger-cause those of Japan over p=5 lags. Additionally, within-country indicators also demonstrate Granger causality. This influence can be partly attributed to the fact that the US, China, and Australia are Japan’s largest trading partners, as noted by World Bank data. Given the relatively smaller size of Japan’s economy compared to the US and China, its impact on these countries is less pronounced. The reasons for Japan’s minimal statistical impact on Australia remain unclear.The model was further applied to pre-COVID (before Q2 2020) and post-COVID periods, yielding consistent results across all analyzed time frames. Analysis extending from Q1 2007 to Q1 2020, which includes five years post-China’s WTO accession and pre-COVID, also corroborated these findings. Moreover, considering potential biases in Chinese economic data, we re-evaluated the model excluding China. Surprisingly, the exclusion did not alter the results, suggesting robustness in the observed causal relationships.</p>
<p>The results from the <strong>BVAR model with MA(1) Gaussian Innovations</strong> are very similar to that of the standard BVAR, except for when we tested for the period after China joined the World Trade Organization and prior to the onset of the Covid-19 Pandemic and after removing China. The over all result suggest a strong Influence of China’s economy. Specifically, across different periods, there is strong evidence that China’s macroeconomic indicators Granger-cause those of Japan, especially post-WTO accession and in the pre-COVID era. This suggests a significant economic influence of China on Japan, which could be due to increased economic interdependencies following China’s integration into the global trade system.The United States shows strong evidence of Granger-causing Japan’s economic indicators during the pre-COVID period, reflecting the close economic ties and possibly the direct impact of U.S. economic policies and market dynamics on Japan. Australia’s influence on Japan is less consistent and only shows strong evidence of Granger-causality in the pre-COVID era. This could indicate that economic ties or shared sectors of significant impact (like resources and commodities) between Australia and Japan are more sensitive to global economic conditions.Interestingly, Japan shows some evidence of influencing the US and strong evidence in the case of Australia during the post-WTO and pre-COVID era. This could be tied to Japan’s role in technology, manufacturing, and investment flows into these countries.Testing the models with and without China’s data provides a nuanced view. The outcomes when excluding China suggest that while China’s data can be impactful, the inaccurate nature of it means including China could mask the trueeconomic relationships and causal influences between the US, Japan, and Australia.</p>
<p>Furthermore, the BVAR model enhanced with MA(1) Gaussian innovations appears to demonstrate an increased sensitivity to subtle trend shifts, particularly in capturing the impact of the COVID-19 pandemic. This refinement in the model’s structure is evident as it identifies distinct Granger causal relationships prior to the pandemic, despite showing no Granger causality across all periods as a whole. This suggests that the MA(1) component is crucial for discerning the dynamic economic interactions that become more pronounced under specific conditions such as those presented by the pandemic. This enhanced detection capability underscores the model’s utility in analyzing periods of economic volatility and change.</p>
<p>In conclusion, we believe that neither the standard BVAR model nor the BVAR model enhanced with MA(1) Gaussian innovations was able to successfully capture the nuanced relationships between the macroeconomic environments of these countries. To address these shortcomings, we propose several extensions to this study: expanding the analysis to include more time periods, incorporating heteroskedastic volatility terms, and employing non-Gaussian distributions for the error terms, such as the Student’s t-distribution or the Laplace distribution. Specifically, a non-Gaussian framework is better suited for modeling the asymmetries in how economies react to positive versus negative shocks. Traditional BVAR models with Gaussian assumptions often fail to capture such nuances, whereas flexible error structures can more accurately represent the varying impacts of shocks of different magnitudes or directions. Given that economic variables frequently exhibit distributions with fat tails and skewness, these enhancements posit to improve the model’s ability to detect and interpret complex economic dynamics.</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Chan_2015" class="csl-entry" role="listitem">
Chan, Joshua C. C. 2015. <span>“Large Bayesian VARs: A Flexible Kronecker Error Covariance Structure.”</span> <em>SSRN Electronic Journal</em>.
</div>
<div id="ref-Chib1995" class="csl-entry" role="listitem">
Chib, Siddhartha, and Edward Greenberg. 1995. <span>“Understanding the Metropolis-Hastings Algorithm.”</span> <em>The American Statistician</em> 49 (4): 327–35.
</div>
<div id="ref-Granger_1969" class="csl-entry" role="listitem">
Granger, C. W. J. 1969. <span>“Investigating Causal Relations by Econometric Models and Cross-Spectral Methods.”</span> <em>Econometrica</em>.
</div>
<div id="ref-wozniakBsvarsBayesianEstimation2022" class="csl-entry" role="listitem">
Woźniak, Tomasz. 2022. <em>Bsvars: Bayesian Estimation of Structural Vector Autoregressive Models</em>. R Package. <a href="https://cran.r-project.org/package=bsvars">https://cran.r-project.org/package=bsvars</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>